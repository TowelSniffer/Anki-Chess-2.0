<script>
    // User Variables
    var userConfig = {
        muteAudio: false,
        fontSize: 18,
        flip: false, // sets whether Puzzle begins from First or second move of PGN
        mirror: false, // card will randomly show up in a mirrored and/or inverted orientation if neither player holds castle rights.
        showDests: true, // Indicate legal moves for clicked piece.
    }
</script>

<iframe id="analysisBoard" style="visibility: hidden"></iframe>

<script data-name="injectScript" data-version="v0.1">
    var background = window.getComputedStyle( document.body ,null).getPropertyValue('background-color');
    {{#textField}}
    // optional user text
    var userText = `{{textField}}`
    userText = encodeURIComponent(userText)
    {{/textField}}

    var errorTrack;
    var mirrorState;
    errorTrack = sessionStorage.getItem("errorTrack");
    mirrorState = sessionStorage.getItem("mirrorState");
    sessionStorage.clear();
    
</script>

<script>
    var PGNtext = `{{text:PGN}}`.replace("[%eval", "[ %eval");
    var PGN = encodeURIComponent(PGNtext);
    var iframe = document.getElementById("analysisBoard");
    iframe.onload = function() { iframe.style.visibility = "visible"; }
    iframe.src = `_chess3.0.html?{{#textField}}userText=` + userText + `&{{/textField}}PGN=` + PGN + `&flip=`+userConfig.flip+`&background=`+background+`&fontSize=`+userConfig.fontSize+`&muteAudio=`+userConfig.muteAudio+`&errorTrack=`+errorTrack+`&mirror=`+userConfig.mirror+`&mirrorState=`+mirrorState+`&showDests=`+userConfig.showDests+`&boardMode=Viewer`;
document.querySelector("#analysisBoard").contentWindow.focus();
</script>
