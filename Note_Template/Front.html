<script>
    // User Variables
    var userConfig = {
        muteAudio: false, // set true to suck the joy out of life.
        handicap: 1, // number of wrong attempts before puzzle advances automatically.
        fontSize: 18,
        strictScoring: false, // puzzle is marked wrong with any mistake.
        acceptVariations: true, // allows for multiple lines for both sides.
        flip: false, // sets whether Puzzle begins from First or second move of PGN
        disableArrows: false, // Disables arrows on front side.
        frontText: true, // show userText on front side.
        mirror: false, // card will randomly show up in a mirrored and/or inverted orientation if neither player holds castle rights.
        showDests: true, // Indicate legal moves for clicked piece.
    }

</script>
<iframe id="Board" style="visibility: hidden"></iframe>
<script>

    {{#textField}}
    // optional user text
    var userText = `{{textField}}`
    userText = encodeURIComponent(userText)
    {{/textField}}

        // note must use var here as variables are remembered when loading new cards/backside
        var background = window.getComputedStyle( document.body ,null).getPropertyValue('background-color');
        var PGN = `{{text:PGN}}`.replace(/\[Puzzle_Length.*?\]/, '').replace(/\[Tactic_line.*?\]/, '').replace("[%", "[ %");
        ; //compatability with chess.com puzzles
        PGN = encodeURIComponent(PGN);
        var iframe = document.getElementById("Board");
        iframe.onload = function() { iframe.style.visibility = "visible"; }
        iframe.src = `_chess3.0.html?{{#textField}}userText=` + userText + `&{{/textField}}PGN=` + PGN + `&flip=`+userConfig.flip+`&handicap=` + userConfig.handicap + `&background=`+background+`&acceptVariations=`+userConfig.acceptVariations+`&disableArrows=`+userConfig.disableArrows+`&frontText=`+userConfig.frontText+`&fontSize=`+userConfig.fontSize+`&muteAudio=`+userConfig.muteAudio+`&mirror=`+userConfig.mirror+`&showDests=`+userConfig.showDests+`&boardMode=Puzzle`;

        var errorTrack;
        var mirrorState;

        if (typeof window.addEventListener != 'undefined') {
                window.addEventListener('message', function(e) {
                    errorTrack = e.data.errorTrack;
                    mirrorState = e.data.mirrorState;
                    sessionStorage.setItem("errorTrack", errorTrack);
                    sessionStorage.setItem("mirrorState", mirrorState);
                }, false);
            }
        }

</script>
