(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))a(l);new MutationObserver(l=>{for(const f of l)if(f.type==="childList")for(const u of f.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&a(u)}).observe(document,{childList:!0,subtree:!0});function n(l){const f={};return l.integrity&&(f.integrity=l.integrity),l.referrerPolicy&&(f.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?f.credentials="include":l.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function a(l){if(l.ep)return;l.ep=!0;const f=n(l);fetch(l.href,f)}})();const qc=!1;var Ac=Array.isArray,z1=Array.prototype.indexOf,xa=Array.from,mc=Object.defineProperty,Cn=Object.getOwnPropertyDescriptor,bc=Object.getOwnPropertyDescriptors,L1=Object.prototype,W1=Array.prototype,Fa=Object.getPrototypeOf,Uf=Object.isExtensible;const Fr=()=>{};function K1(t){for(var r=0;r<t.length;r++)t[r]()}function _c(){var t,r,n=new Promise((a,l)=>{t=a,r=l});return{promise:n,resolve:t,reject:r}}const ut=2,$s=4,Da=8,gr=16,qr=32,ln=64,Cs=128,Qt=512,ft=1024,Mt=2048,Ar=4096,Rt=8192,Dr=16384,Oa=32768,rn=65536,Rf=1<<17,wc=1<<18,Fn=1<<19,j1=1<<20,ai=32768,va=1<<21,Ua=1<<22,Or=1<<23,Zr=Symbol("$state"),V1=Symbol("legacy props"),G1=Symbol(""),yn=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function Ra(t){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function Q1(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function Y1(t){throw new Error("https://svelte.dev/e/effect_in_teardown")}function H1(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function J1(t){throw new Error("https://svelte.dev/e/effect_orphan")}function Z1(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function X1(t){throw new Error("https://svelte.dev/e/props_invalid_value")}function em(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function tm(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function rm(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function nm(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const Ms=1,Es=2,kc=4,im=8,sm=16,am=1,om=4,lm=8,fm=16,cm=1,um=2,lt=Symbol(),hm="http://www.w3.org/1999/xhtml";function pm(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}let dm=!1;function yc(t){return t===this.v}function Na(t,r){return t!=t?r==r:t!==r||t!==null&&typeof t=="object"||typeof t=="function"}function $c(t){return!Na(t,this.v)}let vm=!1,rt=null;function Tn(t){rt=t}function pi(t){return Mc().get(t)}function gm(t,r){return Mc().set(t,r),r}function ar(t,r=!1,n){rt={p:rt,i:!1,c:null,e:null,s:t,x:null,l:null}}function or(t){var r=rt,n=r.e;if(n!==null){r.e=null;for(var a of n)zc(a)}return r.i=!0,rt=r.p,{}}function Cc(){return!0}function Mc(t){return rt===null&&Ra(),rt.c??=new Map(qm(rt)||void 0)}function qm(t){let r=t.p;for(;r!==null;){const n=r.c;if(n!==null)return n;r=r.p}return null}let $n=[];function Am(){var t=$n;$n=[],K1(t)}function Dn(t){if($n.length===0){var r=$n;queueMicrotask(()=>{r===$n&&Am()})}$n.push(t)}function Ec(t){var r=_e;if(r===null)return Ae.f|=Or,t;if((r.f&Oa)===0){if((r.f&Cs)===0)throw t;r.b.error(t)}else Sn(t,r)}function Sn(t,r){for(;r!==null;){if((r.f&Cs)!==0)try{r.b.error(t);return}catch(n){t=n}r=r.parent}throw t}const as=new Set;let Ge=null,Ut=null,Br=[],Ia=null,ga=!1;class tr{committed=!1;current=new Map;previous=new Map;#e=new Set;#t=new Set;#r=0;#n=0;#o=null;#i=[];#l=[];skipped_effects=new Set;is_fork=!1;process(r){Br=[],this.apply();var n={parent:null,effect:null,effects:[],render_effects:[],block_effects:[]};for(const a of r)this.#s(a,n);this.is_fork||this.#f(),this.#n>0||this.is_fork?(this.#a(n.effects),this.#a(n.render_effects),this.#a(n.block_effects)):(Ge=null,Nf(n.render_effects),Nf(n.effects),this.#o?.resolve()),Ut=null}#s(r,n){r.f^=ft;for(var a=r.first;a!==null;){var l=a.f,f=(l&(qr|ln))!==0,u=f&&(l&ft)!==0,d=u||(l&Rt)!==0||this.skipped_effects.has(a);if((a.f&Cs)!==0&&a.b?.is_pending()&&(n={parent:n,effect:a,effects:[],render_effects:[],block_effects:[]}),!d&&a.fn!==null){f?a.f^=ft:(l&$s)!==0?n.effects.push(a):gi(a)&&((a.f&gr)!==0&&n.block_effects.push(a),li(a));var g=a.first;if(g!==null){a=g;continue}}var v=a.parent;for(a=a.next;a===null&&v!==null;)v===n.effect&&(this.#a(n.effects),this.#a(n.render_effects),this.#a(n.block_effects),n=n.parent),a=v.next,v=v.parent}}#a(r){for(const n of r)((n.f&Mt)!==0?this.#i:this.#l).push(n),ct(n,ft)}capture(r,n){this.previous.has(r)||this.previous.set(r,n),(r.f&Or)===0&&(this.current.set(r,r.v),Ut?.set(r,r.v))}activate(){Ge=this,this.apply()}deactivate(){Ge=null,Ut=null}flush(){if(this.activate(),Br.length>0){if(mm(),Ge!==null&&Ge!==this)return}else this.#r===0&&this.process([]);this.deactivate()}discard(){for(const r of this.#t)r(this);this.#t.clear()}#f(){if(this.#n===0){for(const r of this.#e)r();this.#e.clear()}this.#r===0&&this.#c()}#c(){if(as.size>1){this.previous.clear();var r=Ut,n=!0,a={parent:null,effect:null,effects:[],render_effects:[],block_effects:[]};for(const l of as){if(l===this){n=!1;continue}const f=[];for(const[d,g]of this.current){if(l.current.has(d))if(n&&g!==l.current.get(d))l.current.set(d,g);else continue;f.push(d)}if(f.length===0)continue;const u=[...l.current.keys()].filter(d=>!this.current.has(d));if(u.length>0){const d=new Set,g=new Map;for(const v of f)Tc(v,u,d,g);if(Br.length>0){Ge=l,l.apply();for(const v of Br)l.#s(v,a);Br=[],l.deactivate()}}}Ge=null,Ut=r}this.committed=!0,as.delete(this)}increment(r){this.#r+=1,r&&(this.#n+=1)}decrement(r){this.#r-=1,r&&(this.#n-=1),this.revive()}revive(){for(const r of this.#i)ct(r,Mt),nn(r);for(const r of this.#l)ct(r,Ar),nn(r);this.#i=[],this.#l=[],this.flush()}oncommit(r){this.#e.add(r)}ondiscard(r){this.#t.add(r)}settled(){return(this.#o??=_c()).promise}static ensure(){if(Ge===null){const r=Ge=new tr;as.add(Ge),tr.enqueue(()=>{Ge===r&&r.flush()})}return Ge}static enqueue(r){Dn(r)}apply(){}}function mm(){var t=Xr;ga=!0;try{var r=0;for(If(!0);Br.length>0;){var n=tr.ensure();if(r++>1e3){var a,l;bm()}n.process(Br),Ur.clear()}}finally{ga=!1,If(t),Ia=null}}function bm(){try{Z1()}catch(t){Sn(t,Ia)}}let pr=null;function Nf(t){var r=t.length;if(r!==0){for(var n=0;n<r;){var a=t[n++];if((a.f&(Dr|Rt))===0&&gi(a)&&(pr=new Set,li(a),a.deps===null&&a.first===null&&a.nodes_start===null&&(a.teardown===null&&a.ac===null?Vc(a):a.fn=null),pr?.size>0)){Ur.clear();for(const l of pr){if((l.f&(Dr|Rt))!==0)continue;const f=[l];let u=l.parent;for(;u!==null;)pr.has(u)&&(pr.delete(u),f.push(u)),u=u.parent;for(let d=f.length-1;d>=0;d--){const g=f[d];(g.f&(Dr|Rt))===0&&li(g)}}pr.clear()}}pr=null}}function Tc(t,r,n,a){if(!n.has(t)&&(n.add(t),t.reactions!==null))for(const l of t.reactions){const f=l.f;(f&ut)!==0?Tc(l,r,n,a):(f&(Ua|gr))!==0&&(f&Mt)===0&&Sc(l,r,a)&&(ct(l,Mt),nn(l))}}function Sc(t,r,n){const a=n.get(t);if(a!==void 0)return a;if(t.deps!==null)for(const l of t.deps){if(r.includes(l))return!0;if((l.f&ut)!==0&&Sc(l,r,n))return n.set(l,!0),!0}return n.set(t,!1),!1}function nn(t){for(var r=Ia=t;r.parent!==null;){r=r.parent;var n=r.f;if(ga&&r===_e&&(n&gr)!==0&&(n&wc)===0)return;if((n&(ln|qr))!==0){if((n&ft)===0)return;r.f^=ft}}Br.push(r)}function _m(t){let r=0,n=sn(0),a;return()=>{Ss()&&(w(n),Ka(()=>(r===0&&(a=br(()=>t(()=>ii(n)))),r+=1,()=>{Dn(()=>{r-=1,r===0&&(a?.(),a=void 0,ii(n))})})))}}var wm=rn|Fn|Cs;function km(t,r,n){new ym(t,r,n)}class ym{parent;#e=!1;#t;#r=null;#n;#o;#i;#l=null;#s=null;#a=null;#f=null;#c=null;#h=0;#u=0;#d=!1;#p=null;#m=_m(()=>(this.#p=sn(this.#h),()=>{this.#p=null}));constructor(r,n,a){this.#t=r,this.#n=n,this.#o=a,this.parent=_e.b,this.#e=!!this.#n.pending,this.#i=vi(()=>{_e.b=this;{var l=this.#q();try{this.#l=Kt(()=>a(l))}catch(f){this.error(f)}this.#u>0?this.#g():this.#e=!1}return()=>{this.#c?.remove()}},wm)}#b(){try{this.#l=Kt(()=>this.#o(this.#t))}catch(r){this.error(r)}this.#e=!1}#_(){const r=this.#n.pending;r&&(this.#s=Kt(()=>r(this.#t)),tr.enqueue(()=>{var n=this.#q();this.#l=this.#v(()=>(tr.ensure(),Kt(()=>this.#o(n)))),this.#u>0?this.#g():(Mn(this.#s,()=>{this.#s=null}),this.#e=!1)}))}#q(){var r=this.#t;return this.#e&&(this.#c=an(),this.#t.before(this.#c),r=this.#c),r}is_pending(){return this.#e||!!this.parent&&this.parent.is_pending()}has_pending_snippet(){return!!this.#n.pending}#v(r){var n=_e,a=Ae,l=rt;nr(this.#i),Ct(this.#i),Tn(this.#i.ctx);try{return r()}catch(f){return Ec(f),null}finally{nr(n),Ct(a),Tn(l)}}#g(){const r=this.#n.pending;this.#l!==null&&(this.#f=document.createDocumentFragment(),this.#f.append(this.#c),Yc(this.#l,this.#f)),this.#s===null&&(this.#s=Kt(()=>r(this.#t)))}#A(r){if(!this.has_pending_snippet()){this.parent&&this.parent.#A(r);return}this.#u+=r,this.#u===0&&(this.#e=!1,this.#s&&Mn(this.#s,()=>{this.#s=null}),this.#f&&(this.#t.before(this.#f),this.#f=null))}update_pending_count(r){this.#A(r),this.#h+=r,this.#p&&Pn(this.#p,this.#h)}get_effect_pending(){return this.#m(),w(this.#p)}error(r){var n=this.#n.onerror;let a=this.#n.failed;if(this.#d||!n&&!a)throw r;this.#l&&(At(this.#l),this.#l=null),this.#s&&(At(this.#s),this.#s=null),this.#a&&(At(this.#a),this.#a=null);var l=!1,f=!1;const u=()=>{if(l){pm();return}l=!0,f&&nm(),tr.ensure(),this.#h=0,this.#a!==null&&Mn(this.#a,()=>{this.#a=null}),this.#e=this.has_pending_snippet(),this.#l=this.#v(()=>(this.#d=!1,Kt(()=>this.#o(this.#t)))),this.#u>0?this.#g():this.#e=!1};var d=Ae;try{Ct(null),f=!0,n?.(r,u),f=!1}catch(g){Sn(g,this.#i&&this.#i.parent)}finally{Ct(d)}a&&Dn(()=>{this.#a=this.#v(()=>{tr.ensure(),this.#d=!0;try{return Kt(()=>{a(this.#t,()=>r,()=>u)})}catch(g){return Sn(g,this.#i.parent),null}finally{this.#d=!1}})})}}function $m(t,r,n,a){const l=Ts;if(n.length===0&&t.length===0){a(r.map(l));return}var f=Ge,u=_e,d=Cm();function g(){Promise.all(n.map(v=>Mm(v))).then(v=>{d();try{a([...r.map(l),...v])}catch(m){(u.f&Dr)===0&&Sn(m,u)}f?.deactivate(),ds()}).catch(v=>{Sn(v,u)})}t.length>0?Promise.all(t).then(()=>{d();try{return g()}finally{f?.deactivate(),ds()}}):g()}function Cm(){var t=_e,r=Ae,n=rt,a=Ge;return function(f=!0){nr(t),Ct(r),Tn(n),f&&a?.activate()}}function ds(){nr(null),Ct(null),Tn(null)}function Ts(t){var r=ut|Mt,n=Ae!==null&&(Ae.f&ut)!==0?Ae:null;return _e!==null&&(_e.f|=Fn),{ctx:rt,deps:null,effects:null,equals:yc,f:r,fn:t,reactions:null,rv:0,v:lt,wv:0,parent:n??_e,ac:null}}function Mm(t,r){let n=_e;n===null&&Q1();var a=n.b,l=void 0,f=sn(lt),u=!Ae,d=new Map;return Dm(()=>{var g=_c();l=g.promise;try{Promise.resolve(t()).then(g.resolve,g.reject).then(()=>{v===Ge&&v.committed&&v.deactivate(),ds()})}catch(b){g.reject(b),ds()}var v=Ge;if(u){var m=!a.is_pending();a.update_pending_count(1),v.increment(m),d.get(v)?.reject(yn),d.delete(v),d.set(v,g)}const _=(b,$=void 0)=>{if(v.activate(),$)$!==yn&&(f.f|=Or,Pn(f,$));else{(f.f&Or)!==0&&(f.f^=Or),Pn(f,b);for(const[E,T]of d){if(d.delete(E),E===v)break;T.reject(yn)}}u&&(a.update_pending_count(-1),v.decrement(m))};g.promise.then(_,b=>_(null,b||"unknown"))}),Wa(()=>{for(const g of d.values())g.reject(yn)}),new Promise(g=>{function v(m){function _(){m===l?g(f):v(l)}m.then(_,_)}v(l)})}function ye(t){const r=Ts(t);return Hc(r),r}function Pc(t){const r=Ts(t);return r.equals=$c,r}function Bc(t){var r=t.effects;if(r!==null){t.effects=null;for(var n=0;n<r.length;n+=1)At(r[n])}}function Em(t){for(var r=t.parent;r!==null;){if((r.f&ut)===0)return r;r=r.parent}return null}function za(t){var r,n=_e;nr(Em(t));try{t.f&=~ai,Bc(t),r=eu(t)}finally{nr(n)}return r}function xc(t){var r=za(t);if(t.equals(r)||(t.v=r,t.wv=Zc()),!fn)if(Ut!==null)Ss()&&Ut.set(t,t.v);else{var n=(t.f&Qt)===0?Ar:ft;ct(t,n)}}let qa=new Set;const Ur=new Map;let Fc=!1;function sn(t,r){var n={f:0,v:t,reactions:null,equals:yc,rv:0,wv:0};return n}function le(t,r){const n=sn(t);return Hc(n),n}function Dc(t,r=!1,n=!0){const a=sn(t);return r||(a.equals=$c),a}function H(t,r,n=!1){Ae!==null&&(!rr||(Ae.f&Rf)!==0)&&Cc()&&(Ae.f&(ut|gr|Ua|Rf))!==0&&!vr?.includes(t)&&rm();let a=n?Vt(r):r;return Pn(t,a)}function Pn(t,r){if(!t.equals(r)){var n=t.v;fn?Ur.set(t,r):Ur.set(t,n),t.v=r;var a=tr.ensure();a.capture(t,n),(t.f&ut)!==0&&((t.f&Mt)!==0&&za(t),ct(t,(t.f&Qt)!==0?ft:Ar)),t.wv=Zc(),Oc(t,Mt),_e!==null&&(_e.f&ft)!==0&&(_e.f&(qr|ln))===0&&(It===null?Um([t]):It.push(t)),!a.is_fork&&qa.size>0&&!Fc&&Tm()}return r}function Tm(){Fc=!1;const t=Array.from(qa);for(const r of t)(r.f&ft)!==0&&ct(r,Ar),gi(r)&&li(r);qa.clear()}function ii(t){H(t,t.v+1)}function Oc(t,r){var n=t.reactions;if(n!==null)for(var a=n.length,l=0;l<a;l++){var f=n[l],u=f.f,d=(u&Mt)===0;if(d&&ct(f,r),(u&ut)!==0){var g=f;Ut?.delete(g),(u&ai)===0&&(u&Qt&&(f.f|=ai),Oc(g,Ar))}else d&&((u&gr)!==0&&pr!==null&&pr.add(f),nn(f))}}function Vt(t){if(typeof t!="object"||t===null||Zr in t)return t;const r=Fa(t);if(r!==L1&&r!==W1)return t;var n=new Map,a=Ac(t),l=le(0),f=en,u=d=>{if(en===f)return d();var g=Ae,v=en;Ct(null),Lf(f);var m=d();return Ct(g),Lf(v),m};return a&&n.set("length",le(t.length)),new Proxy(t,{defineProperty(d,g,v){(!("value"in v)||v.configurable===!1||v.enumerable===!1||v.writable===!1)&&em();var m=n.get(g);return m===void 0?m=u(()=>{var _=le(v.value);return n.set(g,_),_}):H(m,v.value,!0),!0},deleteProperty(d,g){var v=n.get(g);if(v===void 0){if(g in d){const m=u(()=>le(lt));n.set(g,m),ii(l)}}else H(v,lt),ii(l);return!0},get(d,g,v){if(g===Zr)return t;var m=n.get(g),_=g in d;if(m===void 0&&(!_||Cn(d,g)?.writable)&&(m=u(()=>{var $=Vt(_?d[g]:lt),E=le($);return E}),n.set(g,m)),m!==void 0){var b=w(m);return b===lt?void 0:b}return Reflect.get(d,g,v)},getOwnPropertyDescriptor(d,g){var v=Reflect.getOwnPropertyDescriptor(d,g);if(v&&"value"in v){var m=n.get(g);m&&(v.value=w(m))}else if(v===void 0){var _=n.get(g),b=_?.v;if(_!==void 0&&b!==lt)return{enumerable:!0,configurable:!0,value:b,writable:!0}}return v},has(d,g){if(g===Zr)return!0;var v=n.get(g),m=v!==void 0&&v.v!==lt||Reflect.has(d,g);if(v!==void 0||_e!==null&&(!m||Cn(d,g)?.writable)){v===void 0&&(v=u(()=>{var b=m?Vt(d[g]):lt,$=le(b);return $}),n.set(g,v));var _=w(v);if(_===lt)return!1}return m},set(d,g,v,m){var _=n.get(g),b=g in d;if(a&&g==="length")for(var $=v;$<_.v;$+=1){var E=n.get($+"");E!==void 0?H(E,lt):$ in d&&(E=u(()=>le(lt)),n.set($+"",E))}if(_===void 0)(!b||Cn(d,g)?.writable)&&(_=u(()=>le(void 0)),H(_,Vt(v)),n.set(g,_));else{b=_.v!==lt;var T=u(()=>Vt(v));H(_,T)}var z=Reflect.getOwnPropertyDescriptor(d,g);if(z?.set&&z.set.call(m,v),!b){if(a&&typeof g=="string"){var N=n.get("length"),D=Number(g);Number.isInteger(D)&&D>=N.v&&H(N,D+1)}ii(l)}return!0},ownKeys(d){w(l);var g=Reflect.ownKeys(d).filter(_=>{var b=n.get(_);return b===void 0||b.v!==lt});for(var[v,m]of n)m.v!==lt&&!(v in d)&&g.push(v);return g},setPrototypeOf(){tm()}})}var Aa,Uc,Rc,Nc;function Sm(){if(Aa===void 0){Aa=window,Uc=/Firefox/.test(navigator.userAgent);var t=Element.prototype,r=Node.prototype,n=Text.prototype;Rc=Cn(r,"firstChild").get,Nc=Cn(r,"nextSibling").get,Uf(t)&&(t.__click=void 0,t.__className=void 0,t.__attributes=null,t.__style=void 0,t.__e=void 0),Uf(n)&&(n.__t=void 0)}}function an(t=""){return document.createTextNode(t)}function xr(t){return Rc.call(t)}function di(t){return Nc.call(t)}function J(t,r){return xr(t)}function Pe(t,r=!1){{var n=xr(t);return n instanceof Comment&&n.data===""?di(n):n}}function te(t,r=1,n=!1){let a=t;for(;r--;)a=di(a);return a}function Pm(t){t.textContent=""}function Ic(){return!1}function La(t){var r=Ae,n=_e;Ct(null),nr(null);try{return t()}finally{Ct(r),nr(n)}}function Bm(t){_e===null&&(Ae===null&&J1(),H1()),fn&&Y1()}function xm(t,r){var n=r.last;n===null?r.last=r.first=t:(n.next=t,t.prev=n,r.last=t)}function mr(t,r,n,a=!0){var l=_e;l!==null&&(l.f&Rt)!==0&&(t|=Rt);var f={ctx:rt,deps:null,nodes_start:null,nodes_end:null,f:t|Mt|Qt,first:null,fn:r,last:null,next:null,parent:l,b:l&&l.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(n)try{li(f),f.f|=Oa}catch(g){throw At(f),g}else r!==null&&nn(f);if(a){var u=f;if(n&&u.deps===null&&u.teardown===null&&u.nodes_start===null&&u.first===u.last&&(u.f&Fn)===0&&(u=u.first,(t&gr)!==0&&(t&rn)!==0&&u!==null&&(u.f|=rn)),u!==null&&(u.parent=l,l!==null&&xm(u,l),Ae!==null&&(Ae.f&ut)!==0&&(t&ln)===0)){var d=Ae;(d.effects??=[]).push(u)}}return f}function Ss(){return Ae!==null&&!rr}function Wa(t){const r=mr(Da,null,!1);return ct(r,ft),r.teardown=t,r}function $t(t){Bm();var r=_e.f,n=!Ae&&(r&qr)!==0&&(r&Oa)===0;if(n){var a=rt;(a.e??=[]).push(t)}else return zc(t)}function zc(t){return mr($s|j1,t,!1)}function Fm(t){tr.ensure();const r=mr(ln|Fn,t,!0);return(n={})=>new Promise(a=>{n.outro?Mn(r,()=>{At(r),a(void 0)}):(At(r),a(void 0))})}function Lc(t){return mr($s,t,!1)}function Dm(t){return mr(Ua|Fn,t,!0)}function Ka(t,r=0){return mr(Da|r,t,!0)}function Me(t,r=[],n=[],a=[],l=!1){$m(a,r,n,f=>{mr(l?$s:Da,()=>t(...f.map(w)),!0)})}function vi(t,r=0){var n=mr(gr|r,t,!0);return n}function Kt(t,r=!0){return mr(qr|Fn,t,!0,r)}function Wc(t){var r=t.teardown;if(r!==null){const n=fn,a=Ae;zf(!0),Ct(null);try{r.call(null)}finally{zf(n),Ct(a)}}}function Kc(t,r=!1){var n=t.first;for(t.first=t.last=null;n!==null;){const l=n.ac;l!==null&&La(()=>{l.abort(yn)});var a=n.next;(n.f&ln)!==0?n.parent=null:At(n,r),n=a}}function Om(t){for(var r=t.first;r!==null;){var n=r.next;(r.f&qr)===0&&At(r),r=n}}function At(t,r=!0){var n=!1;(r||(t.f&wc)!==0)&&t.nodes_start!==null&&t.nodes_end!==null&&(jc(t.nodes_start,t.nodes_end),n=!0),Kc(t,r&&!n),vs(t,0),ct(t,Dr);var a=t.transitions;if(a!==null)for(const f of a)f.stop();Wc(t);var l=t.parent;l!==null&&l.first!==null&&Vc(t),t.next=t.prev=t.teardown=t.ctx=t.deps=t.fn=t.nodes_start=t.nodes_end=t.ac=null}function jc(t,r){for(;t!==null;){var n=t===r?null:di(t);t.remove(),t=n}}function Vc(t){var r=t.parent,n=t.prev,a=t.next;n!==null&&(n.next=a),a!==null&&(a.prev=n),r!==null&&(r.first===t&&(r.first=a),r.last===t&&(r.last=n))}function Mn(t,r,n=!0){var a=[];ja(t,a,!0),Gc(a,()=>{n&&At(t),r&&r()})}function Gc(t,r){var n=t.length;if(n>0){var a=()=>--n||r();for(var l of t)l.out(a)}else r()}function ja(t,r,n){if((t.f&Rt)===0){if(t.f^=Rt,t.transitions!==null)for(const u of t.transitions)(u.is_global||n)&&r.push(u);for(var a=t.first;a!==null;){var l=a.next,f=(a.f&rn)!==0||(a.f&qr)!==0&&(t.f&gr)!==0;ja(a,r,f?n:!1),a=l}}}function Va(t){Qc(t,!0)}function Qc(t,r){if((t.f&Rt)!==0){t.f^=Rt,(t.f&ft)===0&&(ct(t,Mt),nn(t));for(var n=t.first;n!==null;){var a=n.next,l=(n.f&rn)!==0||(n.f&qr)!==0;Qc(n,l?r:!1),n=a}if(t.transitions!==null)for(const f of t.transitions)(f.is_global||r)&&f.in()}}function Yc(t,r){for(var n=t.nodes_start,a=t.nodes_end;n!==null;){var l=n===a?null:di(n);r.append(n),n=l}}let Xr=!1;function If(t){Xr=t}let fn=!1;function zf(t){fn=t}let Ae=null,rr=!1;function Ct(t){Ae=t}let _e=null;function nr(t){_e=t}let vr=null;function Hc(t){Ae!==null&&(vr===null?vr=[t]:vr.push(t))}let qt=null,Dt=0,It=null;function Um(t){It=t}let Jc=1,oi=0,en=oi;function Lf(t){en=t}function Zc(){return++Jc}function gi(t){var r=t.f;if((r&Mt)!==0)return!0;if(r&ut&&(t.f&=~ai),(r&Ar)!==0){var n=t.deps;if(n!==null)for(var a=n.length,l=0;l<a;l++){var f=n[l];if(gi(f)&&xc(f),f.wv>t.wv)return!0}(r&Qt)!==0&&Ut===null&&ct(t,ft)}return!1}function Xc(t,r,n=!0){var a=t.reactions;if(a!==null&&!vr?.includes(t))for(var l=0;l<a.length;l++){var f=a[l];(f.f&ut)!==0?Xc(f,r,!1):r===f&&(n?ct(f,Mt):(f.f&ft)!==0&&ct(f,Ar),nn(f))}}function eu(t){var r=qt,n=Dt,a=It,l=Ae,f=vr,u=rt,d=rr,g=en,v=t.f;qt=null,Dt=0,It=null,Ae=(v&(qr|ln))===0?t:null,vr=null,Tn(t.ctx),rr=!1,en=++oi,t.ac!==null&&(La(()=>{t.ac.abort(yn)}),t.ac=null);try{t.f|=va;var m=t.fn,_=m(),b=t.deps;if(qt!==null){var $;if(vs(t,Dt),b!==null&&Dt>0)for(b.length=Dt+qt.length,$=0;$<qt.length;$++)b[Dt+$]=qt[$];else t.deps=b=qt;if(Xr&&Ss()&&(t.f&Qt)!==0)for($=Dt;$<b.length;$++)(b[$].reactions??=[]).push(t)}else b!==null&&Dt<b.length&&(vs(t,Dt),b.length=Dt);if(Cc()&&It!==null&&!rr&&b!==null&&(t.f&(ut|Ar|Mt))===0)for($=0;$<It.length;$++)Xc(It[$],t);return l!==null&&l!==t&&(oi++,It!==null&&(a===null?a=It:a.push(...It))),(t.f&Or)!==0&&(t.f^=Or),_}catch(E){return Ec(E)}finally{t.f^=va,qt=r,Dt=n,It=a,Ae=l,vr=f,Tn(u),rr=d,en=g}}function Rm(t,r){let n=r.reactions;if(n!==null){var a=z1.call(n,t);if(a!==-1){var l=n.length-1;l===0?n=r.reactions=null:(n[a]=n[l],n.pop())}}n===null&&(r.f&ut)!==0&&(qt===null||!qt.includes(r))&&(ct(r,Ar),(r.f&Qt)!==0&&(r.f^=Qt,r.f&=~ai),Bc(r),vs(r,0))}function vs(t,r){var n=t.deps;if(n!==null)for(var a=r;a<n.length;a++)Rm(t,n[a])}function li(t){var r=t.f;if((r&Dr)===0){ct(t,ft);var n=_e,a=Xr;_e=t,Xr=!0;try{(r&gr)!==0?Om(t):Kc(t),Wc(t);var l=eu(t);t.teardown=typeof l=="function"?l:null,t.wv=Jc;var f;qc&&vm&&(t.f&Mt)!==0&&t.deps}finally{Xr=a,_e=n}}}function w(t){var r=t.f,n=(r&ut)!==0;if(Ae!==null&&!rr){var a=_e!==null&&(_e.f&Dr)!==0;if(!a&&!vr?.includes(t)){var l=Ae.deps;if((Ae.f&va)!==0)t.rv<oi&&(t.rv=oi,qt===null&&l!==null&&l[Dt]===t?Dt++:qt===null?qt=[t]:qt.includes(t)||qt.push(t));else{(Ae.deps??=[]).push(t);var f=t.reactions;f===null?t.reactions=[Ae]:f.includes(Ae)||f.push(Ae)}}}if(fn){if(Ur.has(t))return Ur.get(t);if(n){var u=t,d=u.v;return((u.f&ft)===0&&u.reactions!==null||ru(u))&&(d=za(u)),Ur.set(u,d),d}}else if(n){if(u=t,Ut?.has(u))return Ut.get(u);gi(u)&&xc(u),Xr&&Ss()&&(u.f&Qt)===0&&tu(u)}else if(Ut?.has(t))return Ut.get(t);if((t.f&Or)!==0)throw t.v;return t.v}function tu(t){if(t.deps!==null){t.f^=Qt;for(const r of t.deps)(r.reactions??=[]).push(t),(r.f&ut)!==0&&(r.f&Qt)===0&&tu(r)}}function ru(t){if(t.v===lt)return!0;if(t.deps===null)return!1;for(const r of t.deps)if(Ur.has(r)||(r.f&ut)!==0&&ru(r))return!0;return!1}function br(t){var r=rr;try{return rr=!0,t()}finally{rr=r}}const Nm=-7169;function ct(t,r){t.f=t.f&Nm|r}function Im(t){if(!(typeof t!="object"||!t||t instanceof EventTarget)){if(Zr in t)ma(t);else if(!Array.isArray(t))for(let r in t){const n=t[r];typeof n=="object"&&n&&Zr in n&&ma(n)}}}function ma(t,r=new Set){if(typeof t=="object"&&t!==null&&!(t instanceof EventTarget)&&!r.has(t)){r.add(t),t instanceof Date&&t.getTime();for(let a in t)try{ma(t[a],r)}catch{}const n=Fa(t);if(n!==Object.prototype&&n!==Array.prototype&&n!==Map.prototype&&n!==Set.prototype&&n!==Date.prototype){const a=bc(n);for(let l in a){const f=a[l].get;if(f)try{f.call(t)}catch{}}}}}const zm=["touchstart","touchmove"];function Lm(t){return zm.includes(t)}const nu=new Set,ba=new Set;function Wm(t,r,n,a={}){function l(f){if(a.capture||ti.call(r,f),!f.cancelBubble)return La(()=>n?.call(this,f))}return t.startsWith("pointer")||t.startsWith("touch")||t==="wheel"?Dn(()=>{r.addEventListener(t,l,a)}):r.addEventListener(t,l,a),l}function _a(t,r,n,a,l){var f={capture:a,passive:l},u=Wm(t,r,n,f);(r===document.body||r===window||r===document||r instanceof HTMLMediaElement)&&Wa(()=>{r.removeEventListener(t,u,f)})}function On(t){for(var r=0;r<t.length;r++)nu.add(t[r]);for(var n of ba)n(t)}let Wf=null;function ti(t){var r=this,n=r.ownerDocument,a=t.type,l=t.composedPath?.()||[],f=l[0]||t.target;Wf=t;var u=0,d=Wf===t&&t.__root;if(d){var g=l.indexOf(d);if(g!==-1&&(r===document||r===window)){t.__root=r;return}var v=l.indexOf(r);if(v===-1)return;g<=v&&(u=g)}if(f=l[u]||t.target,f!==r){mc(t,"currentTarget",{configurable:!0,get(){return f||n}});var m=Ae,_=_e;Ct(null),nr(null);try{for(var b,$=[];f!==null;){var E=f.assignedSlot||f.parentNode||f.host||null;try{var T=f["__"+a];T!=null&&(!f.disabled||t.target===f)&&T.call(f,t)}catch(z){b?$.push(z):b=z}if(t.cancelBubble||E===r||E===null)break;f=E}if(b){for(let z of $)queueMicrotask(()=>{throw z});throw b}}finally{t.__root=r,delete t.currentTarget,Ct(m),nr(_)}}}function iu(t){var r=document.createElement("template");return r.innerHTML=t.replaceAll("<!>","<!---->"),r.content}function gs(t,r){var n=_e;n.nodes_start===null&&(n.nodes_start=t,n.nodes_end=r)}function re(t,r){var n=(r&cm)!==0,a=(r&um)!==0,l,f=!t.startsWith("<!>");return()=>{l===void 0&&(l=iu(f?t:"<!>"+t),n||(l=xr(l)));var u=a||Uc?document.importNode(l,!0):l.cloneNode(!0);if(n){var d=xr(u),g=u.lastChild;gs(d,g)}else gs(u,u);return u}}function Gt(){var t=document.createDocumentFragment(),r=document.createComment(""),n=an();return t.append(r,n),gs(r,n),t}function Y(t,r){t!==null&&t.before(r)}function xe(t,r){var n=r==null?"":typeof r=="object"?r+"":r;n!==(t.__t??=t.nodeValue)&&(t.__t=n,t.nodeValue=n+"")}function Km(t,r){return jm(t,r)}const bn=new Map;function jm(t,{target:r,anchor:n,props:a={},events:l,context:f,intro:u=!0}){Sm();var d=new Set,g=_=>{for(var b=0;b<_.length;b++){var $=_[b];if(!d.has($)){d.add($);var E=Lm($);r.addEventListener($,ti,{passive:E});var T=bn.get($);T===void 0?(document.addEventListener($,ti,{passive:E}),bn.set($,1)):bn.set($,T+1)}}};g(xa(nu)),ba.add(g);var v=void 0,m=Fm(()=>{var _=n??r.appendChild(an());return km(_,{pending:()=>{}},b=>{if(f){ar({});var $=rt;$.c=f}l&&(a.$$events=l),v=t(b,a)||{},f&&or()}),()=>{for(var b of d){r.removeEventListener(b,ti);var $=bn.get(b);--$===0?(document.removeEventListener(b,ti),bn.delete(b)):bn.set(b,$)}ba.delete(g),_!==n&&_.parentNode?.removeChild(_)}});return wa.set(v,m),v}let wa=new WeakMap;function Vm(t,r){const n=wa.get(t);return n?(wa.delete(t),n(r)):Promise.resolve()}class Ga{anchor;#e=new Map;#t=new Map;#r=new Map;#n=!0;constructor(r,n=!0){this.anchor=r,this.#n=n}#o=()=>{var r=Ge;if(this.#e.has(r)){var n=this.#e.get(r),a=this.#t.get(n);if(a)Va(a);else{var l=this.#r.get(n);l&&(this.#t.set(n,l.effect),this.#r.delete(n),l.fragment.lastChild.remove(),this.anchor.before(l.fragment),a=l.effect)}for(const[f,u]of this.#e){if(this.#e.delete(f),f===r)break;const d=this.#r.get(u);d&&(At(d.effect),this.#r.delete(u))}for(const[f,u]of this.#t){if(f===n)continue;const d=()=>{if(Array.from(this.#e.values()).includes(f)){var v=document.createDocumentFragment();Yc(u,v),v.append(an()),this.#r.set(f,{effect:u,fragment:v})}else At(u);this.#t.delete(f)};this.#n||!a?Mn(u,d,!1):d()}}};#i=r=>{this.#e.delete(r);const n=Array.from(this.#e.values());for(const[a,l]of this.#r)n.includes(a)||(At(l.effect),this.#r.delete(a))};ensure(r,n){var a=Ge,l=Ic();if(n&&!this.#t.has(r)&&!this.#r.has(r))if(l){var f=document.createDocumentFragment(),u=an();f.append(u),this.#r.set(r,{effect:Kt(()=>n(u)),fragment:f})}else this.#t.set(r,Kt(()=>n(this.anchor)));if(this.#e.set(a,r),l){for(const[d,g]of this.#t)d===r?a.skipped_effects.delete(g):a.skipped_effects.add(g);for(const[d,g]of this.#r)d===r?a.skipped_effects.delete(g.effect):a.skipped_effects.add(g.effect);a.oncommit(this.#o),a.ondiscard(this.#i)}else this.#o()}}function he(t,r,n=!1){var a=new Ga(t),l=n?rn:0;function f(u,d){a.ensure(u,d)}vi(()=>{var u=!1;r((d,g=!0)=>{u=!0,f(g,d)}),u||f(!1,null)},l)}function Gm(t,r,n){var a=new Ga(t);vi(()=>{var l=r();a.ensure(l,n)})}function fi(t,r){return r}function Qm(t,r,n){for(var a=t.items,l=[],f=r.length,u=0;u<f;u++)ja(r[u].e,l,!0);var d=f>0&&l.length===0&&n!==null;if(d){var g=n.parentNode;Pm(g),g.append(n),a.clear(),Xt(t,r[0].prev,r[f-1].next)}Gc(l,()=>{for(var v=0;v<f;v++){var m=r[v];d||(a.delete(m.k),Xt(t,m.prev,m.next)),At(m.e,!d)}})}function Bn(t,r,n,a,l,f=null){var u=t,d={flags:r,items:new Map,first:null},g=(r&kc)!==0;if(g){var v=t;u=v.appendChild(an())}var m=null,_=!1,b=new Map,$=Pc(()=>{var N=n();return Ac(N)?N:N==null?[]:xa(N)}),E,T;function z(){Ym(T,E,d,b,u,l,r,a,n),f!==null&&(E.length===0?m?Va(m):m=Kt(()=>f(u)):m!==null&&Mn(m,()=>{m=null}))}vi(()=>{T??=_e,E=w($);var N=E.length;if(!(_&&N===0)){_=N===0;var D,F,W,O;if(Ic()){var p=new Set,R=Ge;for(F=0;F<N;F+=1){W=E[F],O=a(W,F);var i=d.items.get(O)??b.get(O);i?(r&(Ms|Es))!==0&&su(i,W,F,r):(D=au(null,d,null,null,W,O,F,l,r,n,!0),b.set(O,D)),p.add(O)}for(const[I,K]of d.items)p.has(I)||R.skipped_effects.add(K.e);R.oncommit(z)}else z();w($)}})}function Ym(t,r,n,a,l,f,u,d,g){var v=(u&im)!==0,m=(u&(Ms|Es))!==0,_=r.length,b=n.items,$=n.first,E=$,T,z=null,N,D=[],F=[],W,O,p,R;if(v)for(R=0;R<_;R+=1)W=r[R],O=d(W,R),p=b.get(O),p!==void 0&&(p.a?.measure(),(N??=new Set).add(p));for(R=0;R<_;R+=1){if(W=r[R],O=d(W,R),p=b.get(O),p===void 0){var i=a.get(O);if(i!==void 0){a.delete(O),b.set(O,i);var I=z?z.next:E;Xt(n,z,i),Xt(n,i,I),ra(i,I,l),z=i}else{var K=E?E.e.nodes_start:l;z=au(K,n,z,z===null?n.first:z.next,W,O,R,f,u,g)}b.set(O,z),D=[],F=[],E=z.next;continue}if(m&&su(p,W,R,u),(p.e.f&Rt)!==0&&(Va(p.e),v&&(p.a?.unfix(),(N??=new Set).delete(p))),p!==E){if(T!==void 0&&T.has(p)){if(D.length<F.length){var Q=F[0],ie;z=Q.prev;var G=D[0],ue=D[D.length-1];for(ie=0;ie<D.length;ie+=1)ra(D[ie],Q,l);for(ie=0;ie<F.length;ie+=1)T.delete(F[ie]);Xt(n,G.prev,ue.next),Xt(n,z,G),Xt(n,ue,Q),E=Q,z=ue,R-=1,D=[],F=[]}else T.delete(p),ra(p,E,l),Xt(n,p.prev,p.next),Xt(n,p,z===null?n.first:z.next),Xt(n,z,p),z=p;continue}for(D=[],F=[];E!==null&&E.k!==O;)(E.e.f&Rt)===0&&(T??=new Set).add(E),F.push(E),E=E.next;if(E===null)continue;p=E}D.push(p),z=p,E=p.next}if(E!==null||T!==void 0){for(var oe=T===void 0?[]:xa(T);E!==null;)(E.e.f&Rt)===0&&oe.push(E),E=E.next;var fe=oe.length;if(fe>0){var $e=(u&kc)!==0&&_===0?l:null;if(v){for(R=0;R<fe;R+=1)oe[R].a?.measure();for(R=0;R<fe;R+=1)oe[R].a?.fix()}Qm(n,oe,$e)}}v&&Dn(()=>{if(N!==void 0)for(p of N)p.a?.apply()}),t.first=n.first&&n.first.e,t.last=z&&z.e;for(var He of a.values())At(He.e);a.clear()}function su(t,r,n,a){(a&Ms)!==0&&Pn(t.v,r),(a&Es)!==0?Pn(t.i,n):t.i=n}function au(t,r,n,a,l,f,u,d,g,v,m){var _=(g&Ms)!==0,b=(g&sm)===0,$=_?b?Dc(l,!1,!1):sn(l):l,E=(g&Es)===0?u:sn(u),T={i:E,v:$,k:f,a:null,e:null,prev:n,next:a};try{if(t===null){var z=document.createDocumentFragment();z.append(t=an())}return T.e=Kt(()=>d(t,$,E,v),dm),T.e.prev=n&&n.e,T.e.next=a&&a.e,n===null?m||(r.first=T):(n.next=T,n.e.next=T.e),a!==null&&(a.prev=T,a.e.prev=T.e),T}finally{}}function ra(t,r,n){for(var a=t.next?t.next.e.nodes_start:n,l=r?r.e.nodes_start:n,f=t.e.nodes_start;f!==null&&f!==a;){var u=di(f);l.before(f),f=u}}function Xt(t,r,n){r===null?t.first=n:(r.next=n,r.e.next=n&&n.e),n!==null&&(n.prev=r,n.e.prev=r&&r.e)}function Hm(t,r,n=!1,a=!1,l=!1){var f=t,u="";Me(()=>{var d=_e;if(u!==(u=r()??"")&&(d.nodes_start!==null&&(jc(d.nodes_start,d.nodes_end),d.nodes_start=d.nodes_end=null),u!=="")){var g=u+"";n?g=`<svg>${g}</svg>`:a&&(g=`<math>${g}</math>`);var v=iu(g);if((n||a)&&(v=xr(v)),gs(xr(v),v.lastChild),n||a)for(;xr(v);)f.before(xr(v));else f.before(v)}})}function Jm(t,r,...n){var a=new Ga(t);vi(()=>{const l=r()??null;a.ensure(l,l&&(f=>l(f,...n)))},rn)}function Kf(t,r,n){Lc(()=>{var a=br(()=>r(t,n?.())||{});if(n&&a?.update){var l=!1,f={};Ka(()=>{var u=n();Im(u),l&&Na(f,u)&&(f=u,a.update(u))}),l=!0}if(a?.destroy)return()=>a.destroy()})}const jf=[...` 	
\r\fÂ \v\uFEFF`];function Zm(t,r,n){var a=t==null?"":""+t;if(r&&(a=a?a+" "+r:r),n){for(var l in n)if(n[l])a=a?a+" "+l:l;else if(a.length)for(var f=l.length,u=0;(u=a.indexOf(l,u))>=0;){var d=u+f;(u===0||jf.includes(a[u-1]))&&(d===a.length||jf.includes(a[d]))?a=(u===0?"":a.substring(0,u))+a.substring(d+1):u=d}}return a===""?null:a}function Xm(t,r){return t==null?null:String(t)}function Ye(t,r,n,a,l,f){var u=t.__className;if(u!==n||u===void 0){var d=Zm(n,a,f);d==null?t.removeAttribute("class"):t.className=d,t.__className=n}else if(f&&l!==f)for(var g in f){var v=!!f[g];(l==null||v!==!!l[g])&&t.classList.toggle(g,v)}return f}function e2(t,r,n,a){var l=t.__style;if(l!==r){var f=Xm(r);f==null?t.removeAttribute("style"):t.style.cssText=f,t.__style=r}return a}const t2=Symbol("is custom element"),r2=Symbol("is html");function n2(t,r){var n=ou(t);n.checked!==(n.checked=r??void 0)&&(t.checked=r)}function Jr(t,r,n,a){var l=ou(t);l[r]!==(l[r]=n)&&(r==="loading"&&(t[G1]=n),n==null?t.removeAttribute(r):typeof n!="string"&&i2(t).includes(r)?t[r]=n:t.setAttribute(r,n))}function ou(t){return t.__attributes??={[t2]:t.nodeName.includes("-"),[r2]:t.namespaceURI===hm}}var Vf=new Map;function i2(t){var r=t.getAttribute("is")||t.nodeName,n=Vf.get(r);if(n)return n;Vf.set(r,n=[]);for(var a,l=t,f=Element.prototype;f!==l;){a=bc(l);for(var u in a)a[u].set&&n.push(u);l=Fa(l)}return n}const s2=()=>performance.now(),jt={tick:t=>requestAnimationFrame(t),now:()=>s2(),tasks:new Set};function lu(){const t=jt.now();jt.tasks.forEach(r=>{r.c(t)||(jt.tasks.delete(r),r.f())}),jt.tasks.size!==0&&jt.tick(lu)}function a2(t){let r;return jt.tasks.size===0&&jt.tick(lu),{promise:new Promise(n=>{jt.tasks.add(r={c:t,f:n})}),abort(){jt.tasks.delete(r)}}}function Gf(t,r){return t===r||t?.[Zr]===r}function qs(t={},r,n,a){return Lc(()=>{var l,f;return Ka(()=>{l=f,f=[],br(()=>{t!==n(...f)&&(r(t,...f),l&&Gf(n(...l),t)&&r(null,...l))})}),()=>{Dn(()=>{f&&Gf(n(...f),t)&&r(null,...f)})}}),t}function fu(t,r,n){if(t==null)return r(void 0),Fr;const a=br(()=>t.subscribe(r,n));return a.unsubscribe?()=>a.unsubscribe():a}const _n=[];function o2(t,r=Fr){let n=null;const a=new Set;function l(d){if(Na(t,d)&&(t=d,n)){const g=!_n.length;for(const v of a)v[1](),_n.push(v,t);if(g){for(let v=0;v<_n.length;v+=2)_n[v][0](_n[v+1]);_n.length=0}}}function f(d){l(d(t))}function u(d,g=Fr){const v=[d,g];return a.add(v),a.size===1&&(n=r(l,f)||Fr),d(t),()=>{a.delete(v),a.size===0&&n&&(n(),n=null)}}return{set:l,update:f,subscribe:u}}function l2(t){let r;return fu(t,n=>r=n)(),r}let os=!1,ka=Symbol();function f2(t,r,n){const a=n[r]??={store:null,source:Dc(void 0),unsubscribe:Fr};if(a.store!==t&&!(ka in n))if(a.unsubscribe(),a.store=t??null,t==null)a.source.v=void 0,a.unsubscribe=Fr;else{var l=!0;a.unsubscribe=fu(t,f=>{l?a.source.v=f:H(a.source,f)}),l=!1}return t&&ka in n?l2(t):w(a.source)}function c2(){const t={};function r(){Wa(()=>{for(var n in t)t[n].unsubscribe();mc(t,ka,{enumerable:!1,value:!0})})}return[t,r]}function u2(t){var r=os;try{return os=!1,[t(),os]}finally{os=r}}function En(t,r,n,a){var l=(n&lm)!==0,f=(n&fm)!==0,u=a,d=!0,g=()=>(d&&(d=!1,u=f?br(a):a),u),v;if(l){var m=Zr in t||V1 in t;v=Cn(t,r)?.set??(m&&r in t?D=>t[r]=D:void 0)}var _,b=!1;l?[_,b]=u2(()=>t[r]):_=t[r],_===void 0&&a!==void 0&&(_=g(),v&&(X1(),v(_)));var $;if($=()=>{var D=t[r];return D===void 0?g():(d=!0,D)},(n&om)===0)return $;if(v){var E=t.$$legacy;return(function(D,F){return arguments.length>0?((!F||E||b)&&v(F?$():D),D):$()})}var T=!1,z=((n&am)!==0?Ts:Pc)(()=>(T=!1,$()));l&&w(z);var N=_e;return(function(D,F){if(arguments.length>0){const W=F?w(z):l?Vt(D):D;return H(z,W),T=!0,u!==void 0&&(u=W),D}return fn&&T||(N.f&Dr)!==0?z.v:w(z)})}function Qa(t){rt===null&&Ra(),$t(()=>{const r=br(t);if(typeof r=="function")return r})}function h2(t){rt===null&&Ra(),Qa(()=>()=>br(t))}const p2="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(p2);function d2(t){return t!==null?{comment:t,variations:[]}:{variations:[]}}function v2(t,r,n,a,l){const f={move:t,variations:l};return r&&(f.suffix=r),n&&(f.nag=n),a!==null&&(f.comment=a),f}function g2(...t){const[r,...n]=t;let a=r;for(const l of n)l!==null&&(a.variations=[l,...l.variations],l.variations=[],a=l);return r}function q2(t,r){if(r.marker&&r.marker.comment){let n=r.root;for(;;){const a=n.variations[0];if(!a){n.comment=r.marker.comment;break}n=a}}return{headers:t,root:r.root,result:(r.marker&&r.marker.result)??void 0}}function A2(t,r){function n(){this.constructor=t}n.prototype=r.prototype,t.prototype=new n}function xn(t,r,n,a){var l=Error.call(this,t);return Object.setPrototypeOf&&Object.setPrototypeOf(l,xn.prototype),l.expected=r,l.found=n,l.location=a,l.name="SyntaxError",l}A2(xn,Error);function na(t,r,n){return n=n||" ",t.length>r?t:(r-=t.length,n+=n.repeat(r),t+n.slice(0,r))}xn.prototype.format=function(t){var r="Error: "+this.message;if(this.location){var n=null,a;for(a=0;a<t.length;a++)if(t[a].source===this.location.source){n=t[a].text.split(/\r\n|\n|\r/g);break}var l=this.location.start,f=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(l):l,u=this.location.source+":"+f.line+":"+f.column;if(n){var d=this.location.end,g=na("",f.line.toString().length," "),v=n[l.line-1],m=l.line===d.line?d.column:v.length+1,_=m-l.column||1;r+=`
 --> `+u+`
`+g+` |
`+f.line+" | "+v+`
`+g+" | "+na("",l.column-1," ")+na("",_,"^")}else r+=`
 at `+u}return r};xn.buildMessage=function(t,r){var n={literal:function(v){return'"'+l(v.text)+'"'},class:function(v){var m=v.parts.map(function(_){return Array.isArray(_)?f(_[0])+"-"+f(_[1]):f(_)});return"["+(v.inverted?"^":"")+m.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(v){return v.description}};function a(v){return v.charCodeAt(0).toString(16).toUpperCase()}function l(v){return v.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(m){return"\\x0"+a(m)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(m){return"\\x"+a(m)})}function f(v){return v.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(m){return"\\x0"+a(m)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(m){return"\\x"+a(m)})}function u(v){return n[v.type](v)}function d(v){var m=v.map(u),_,b;if(m.sort(),m.length>0){for(_=1,b=1;_<m.length;_++)m[_-1]!==m[_]&&(m[b]=m[_],b++);m.length=b}switch(m.length){case 1:return m[0];case 2:return m[0]+" or "+m[1];default:return m.slice(0,-1).join(", ")+", or "+m[m.length-1]}}function g(v){return v?'"'+l(v)+'"':"end of input"}return"Expected "+d(t)+" but "+g(r)+" found."};function m2(t,r){r=r!==void 0?r:{};var n={},a=r.grammarSource,l={pgn:Ln},f=Ln,u="[",d='"',g="]",v=".",m="O-O-O",_="O-O",b="0-0-0",$="0-0",E="$",T="{",z="}",N=";",D="(",F=")",W="1-0",O="0-1",p="1/2-1/2",R="*",i=/^[a-zA-Z]/,I=/^[^"]/,K=/^[0-9]/,Q=/^[.]/,ie=/^[a-zA-Z1-8\-=]/,G=/^[+#]/,ue=/^[!?]/,oe=/^[^}]/,fe=/^[^\r\n]/,$e=/^[ \t\r\n]/,He=vt("tag pair"),it=Ne("[",!1),Nt=Ne('"',!1),lr=Ne("]",!1),_r=vt("tag name"),Yt=Pt([["a","z"],["A","Z"]],!1,!1),St=vt("tag value"),de=Pt(['"'],!0,!1),Oe=vt("move number"),Fe=Pt([["0","9"]],!1,!1),ht=Ne(".",!1),De=Pt(["."],!1,!1),Ee=vt("standard algebraic notation"),Je=Ne("O-O-O",!1),Ke=Ne("O-O",!1),Ie=Ne("0-0-0",!1),Te=Ne("0-0",!1),ge=Pt([["a","z"],["A","Z"],["1","8"],"-","="],!1,!1),we=Pt(["+","#"],!1,!1),Se=vt("suffix annotation"),Ue=Pt(["!","?"],!1,!1),pt=vt("NAG"),Re=Ne("$",!1),je=vt("brace comment"),st=Ne("{",!1),dt=Pt(["}"],!0,!1),bt=Ne("}",!1),at=vt("rest of line comment"),Be=Ne(";",!1),ze=Pt(["\r",`
`],!0,!1),_t=vt("variation"),fr=Ne("(",!1),Ht=Ne(")",!1),Jt=vt("game termination marker"),cr=Ne("1-0",!1),zr=Ne("0-1",!1),hn=Ne("1/2-1/2",!1),Ai=Ne("*",!1),mi=vt("whitespace"),Nn=Pt([" ","	","\r",`
`],!1,!1),bi=function(M,P){return q2(M,P)},_i=function(M){return Object.fromEntries(M)},wi=function(M,P){return[M,P]},ki=function(M,P){return{root:M,marker:P}},yi=function(M,P){return g2(d2(M),...P.flat())},$i=function(M,P,B,X,ne){return v2(M,P,B,X,ne)},Ci=function(M){return M},Mi=function(M){return M.replace(/[\r\n]+/g," ")},Ei=function(M){return M.trim()},Ti=function(M){return M},Si=function(M,P){return{result:M,comment:P}},S=r.peg$currPos|0,ur=[{line:1,column:1}],wt=S,Lr=r.peg$maxFailExpected||[],j=r.peg$silentFails|0,wr;if(r.startRule){if(!(r.startRule in l))throw new Error(`Can't start parsing from rule "`+r.startRule+'".');f=l[r.startRule]}function Ne(M,P){return{type:"literal",text:M,ignoreCase:P}}function Pt(M,P,B){return{type:"class",parts:M,inverted:P,ignoreCase:B}}function Pi(){return{type:"end"}}function vt(M){return{type:"other",description:M}}function In(M){var P=ur[M],B;if(P)return P;if(M>=ur.length)B=ur.length-1;else for(B=M;!ur[--B];);for(P=ur[B],P={line:P.line,column:P.column};B<M;)t.charCodeAt(B)===10?(P.line++,P.column=1):P.column++,B++;return ur[M]=P,P}function zn(M,P,B){var X=In(M),ne=In(P),me={source:a,start:{offset:M,line:X.line,column:X.column},end:{offset:P,line:ne.line,column:ne.column}};return me}function Z(M){S<wt||(S>wt&&(wt=S,Lr=[]),Lr.push(M))}function Bi(M,P,B){return new xn(xn.buildMessage(M,P),M,P,B)}function Ln(){var M,P,B;return M=S,P=xi(),B=Oi(),M=bi(P,B),M}function xi(){var M,P,B;for(M=S,P=[],B=Wn();B!==n;)P.push(B),B=Wn();return B=Ze(),M=_i(P),M}function Wn(){var M,P,B,X,ne,me,Zt;return j++,M=S,Ze(),t.charCodeAt(S)===91?(P=u,S++):(P=n,j===0&&Z(it)),P!==n?(Ze(),B=Fi(),B!==n?(Ze(),t.charCodeAt(S)===34?(X=d,S++):(X=n,j===0&&Z(Nt)),X!==n?(ne=Di(),t.charCodeAt(S)===34?(me=d,S++):(me=n,j===0&&Z(Nt)),me!==n?(Ze(),t.charCodeAt(S)===93?(Zt=g,S++):(Zt=n,j===0&&Z(lr)),Zt!==n?M=wi(B,ne):(S=M,M=n)):(S=M,M=n)):(S=M,M=n)):(S=M,M=n)):(S=M,M=n),j--,M===n&&j===0&&Z(He),M}function Fi(){var M,P,B;if(j++,M=S,P=[],B=t.charAt(S),i.test(B)?S++:(B=n,j===0&&Z(Yt)),B!==n)for(;B!==n;)P.push(B),B=t.charAt(S),i.test(B)?S++:(B=n,j===0&&Z(Yt));else P=n;return P!==n?M=t.substring(M,S):M=P,j--,M===n&&(P=n,j===0&&Z(_r)),M}function Di(){var M,P,B;for(j++,M=S,P=[],B=t.charAt(S),I.test(B)?S++:(B=n,j===0&&Z(de));B!==n;)P.push(B),B=t.charAt(S),I.test(B)?S++:(B=n,j===0&&Z(de));return M=t.substring(M,S),j--,P=n,j===0&&Z(St),M}function Oi(){var M,P,B;return M=S,P=Kn(),Ze(),B=Li(),B===n&&(B=null),Ze(),M=ki(P,B),M}function Kn(){var M,P,B,X;for(M=S,P=pn(),P===n&&(P=null),B=[],X=jn();X!==n;)B.push(X),X=jn();return M=yi(P,B),M}function jn(){var M,P,B,X,ne,me,Zt,Wr;if(M=S,Ze(),Ui(),Ze(),P=Ri(),P!==n){for(B=Ni(),B===n&&(B=null),X=[],ne=Vn();ne!==n;)X.push(ne),ne=Vn();for(ne=Ze(),me=pn(),me===n&&(me=null),Zt=[],Wr=Gn();Wr!==n;)Zt.push(Wr),Wr=Gn();M=$i(P,B,X,me,Zt)}else S=M,M=n;return M}function Ui(){var M,P,B,X,ne,me;for(j++,M=S,P=[],B=t.charAt(S),K.test(B)?S++:(B=n,j===0&&Z(Fe));B!==n;)P.push(B),B=t.charAt(S),K.test(B)?S++:(B=n,j===0&&Z(Fe));if(t.charCodeAt(S)===46?(B=v,S++):(B=n,j===0&&Z(ht)),B!==n){for(X=Ze(),ne=[],me=t.charAt(S),Q.test(me)?S++:(me=n,j===0&&Z(De));me!==n;)ne.push(me),me=t.charAt(S),Q.test(me)?S++:(me=n,j===0&&Z(De));P=[P,B,X,ne],M=P}else S=M,M=n;return j--,M===n&&(P=n,j===0&&Z(Oe)),M}function Ri(){var M,P,B,X,ne,me;if(j++,M=S,P=S,t.substr(S,5)===m?(B=m,S+=5):(B=n,j===0&&Z(Je)),B===n&&(t.substr(S,3)===_?(B=_,S+=3):(B=n,j===0&&Z(Ke)),B===n&&(t.substr(S,5)===b?(B=b,S+=5):(B=n,j===0&&Z(Ie)),B===n&&(t.substr(S,3)===$?(B=$,S+=3):(B=n,j===0&&Z(Te)),B===n))))if(B=S,X=t.charAt(S),i.test(X)?S++:(X=n,j===0&&Z(Yt)),X!==n){if(ne=[],me=t.charAt(S),ie.test(me)?S++:(me=n,j===0&&Z(ge)),me!==n)for(;me!==n;)ne.push(me),me=t.charAt(S),ie.test(me)?S++:(me=n,j===0&&Z(ge));else ne=n;ne!==n?(X=[X,ne],B=X):(S=B,B=n)}else S=B,B=n;return B!==n?(X=t.charAt(S),G.test(X)?S++:(X=n,j===0&&Z(we)),X===n&&(X=null),B=[B,X],P=B):(S=P,P=n),P!==n?M=t.substring(M,S):M=P,j--,M===n&&(P=n,j===0&&Z(Ee)),M}function Ni(){var M,P,B;for(j++,M=S,P=[],B=t.charAt(S),ue.test(B)?S++:(B=n,j===0&&Z(Ue));B!==n;)P.push(B),P.length>=2?B=n:(B=t.charAt(S),ue.test(B)?S++:(B=n,j===0&&Z(Ue)));return P.length<1?(S=M,M=n):M=P,j--,M===n&&(P=n,j===0&&Z(Se)),M}function Vn(){var M,P,B,X,ne;if(j++,M=S,Ze(),t.charCodeAt(S)===36?(P=E,S++):(P=n,j===0&&Z(Re)),P!==n){if(B=S,X=[],ne=t.charAt(S),K.test(ne)?S++:(ne=n,j===0&&Z(Fe)),ne!==n)for(;ne!==n;)X.push(ne),ne=t.charAt(S),K.test(ne)?S++:(ne=n,j===0&&Z(Fe));else X=n;X!==n?B=t.substring(B,S):B=X,B!==n?M=Ci(B):(S=M,M=n)}else S=M,M=n;return j--,M===n&&j===0&&Z(pt),M}function pn(){var M;return M=Ii(),M===n&&(M=zi()),M}function Ii(){var M,P,B,X,ne;if(j++,M=S,t.charCodeAt(S)===123?(P=T,S++):(P=n,j===0&&Z(st)),P!==n){for(B=S,X=[],ne=t.charAt(S),oe.test(ne)?S++:(ne=n,j===0&&Z(dt));ne!==n;)X.push(ne),ne=t.charAt(S),oe.test(ne)?S++:(ne=n,j===0&&Z(dt));B=t.substring(B,S),t.charCodeAt(S)===125?(X=z,S++):(X=n,j===0&&Z(bt)),X!==n?M=Mi(B):(S=M,M=n)}else S=M,M=n;return j--,M===n&&(P=n,j===0&&Z(je)),M}function zi(){var M,P,B,X,ne;if(j++,M=S,t.charCodeAt(S)===59?(P=N,S++):(P=n,j===0&&Z(Be)),P!==n){for(B=S,X=[],ne=t.charAt(S),fe.test(ne)?S++:(ne=n,j===0&&Z(ze));ne!==n;)X.push(ne),ne=t.charAt(S),fe.test(ne)?S++:(ne=n,j===0&&Z(ze));B=t.substring(B,S),M=Ei(B)}else S=M,M=n;return j--,M===n&&(P=n,j===0&&Z(at)),M}function Gn(){var M,P,B,X;return j++,M=S,Ze(),t.charCodeAt(S)===40?(P=D,S++):(P=n,j===0&&Z(fr)),P!==n?(B=Kn(),B!==n?(Ze(),t.charCodeAt(S)===41?(X=F,S++):(X=n,j===0&&Z(Ht)),X!==n?M=Ti(B):(S=M,M=n)):(S=M,M=n)):(S=M,M=n),j--,M===n&&j===0&&Z(_t),M}function Li(){var M,P,B;return j++,M=S,t.substr(S,3)===W?(P=W,S+=3):(P=n,j===0&&Z(cr)),P===n&&(t.substr(S,3)===O?(P=O,S+=3):(P=n,j===0&&Z(zr)),P===n&&(t.substr(S,7)===p?(P=p,S+=7):(P=n,j===0&&Z(hn)),P===n&&(t.charCodeAt(S)===42?(P=R,S++):(P=n,j===0&&Z(Ai))))),P!==n?(Ze(),B=pn(),B===n&&(B=null),M=Si(P,B)):(S=M,M=n),j--,M===n&&(P=n,j===0&&Z(Jt)),M}function Ze(){var M,P;for(j++,M=[],P=t.charAt(S),$e.test(P)?S++:(P=n,j===0&&Z(Nn));P!==n;)M.push(P),P=t.charAt(S),$e.test(P)?S++:(P=n,j===0&&Z(Nn));return j--,P=n,j===0&&Z(mi),M}if(wr=f(),r.peg$library)return{peg$result:wr,peg$currPos:S,peg$FAILED:n,peg$maxFailExpected:Lr,peg$maxFailPos:wt};if(wr!==n&&S===t.length)return wr;throw wr!==n&&S<t.length&&Z(Pi()),Bi(Lr,wt<t.length?t.charAt(wt):null,wt<t.length?zn(wt,wt+1):zn(wt,wt))}const us=0xffffffffffffffffn;function ia(t,r){return(t<<r|t>>64n-r)&0xffffffffffffffffn}function Qf(t,r){return t*r&us}function b2(t){return function(){let r=BigInt(t&us),n=BigInt(t>>64n&us);const a=Qf(ia(Qf(r,5n),7n),9n);return n^=r,r=(ia(r,24n)^n^n<<16n)&us,n=ia(n,37n),t=n<<64n|r,a}}const Ps=b2(0xa187eb39cdcaed8f31c4b365b102e01en),_2=Array.from({length:2},()=>Array.from({length:6},()=>Array.from({length:128},()=>Ps()))),w2=Array.from({length:8},()=>Ps()),k2=Array.from({length:16},()=>Ps()),sa=Ps(),ot="w",Ft="b",We="p",ya="n",hs="b",ri="r",Pr="q",Ve="k",si="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";class ls{color;from;to;piece;captured;promotion;flags;san;lan;before;after;constructor(r,n){const{color:a,piece:l,from:f,to:u,flags:d,captured:g,promotion:v}=n,m=et(f),_=et(u);this.color=a,this.piece=l,this.from=m,this.to=_,this.san=r._moveToSan(n,r._moves({legal:!0})),this.lan=m+_,this.before=r.fen(),r._makeMove(n),this.after=r.fen(),r._undoMove(),this.flags="";for(const b in ce)ce[b]&d&&(this.flags+=Qr[b]);g&&(this.captured=g),v&&(this.promotion=v,this.lan+=v)}isCapture(){return this.flags.indexOf(Qr.CAPTURE)>-1}isPromotion(){return this.flags.indexOf(Qr.PROMOTION)>-1}isEnPassant(){return this.flags.indexOf(Qr.EP_CAPTURE)>-1}isKingsideCastle(){return this.flags.indexOf(Qr.KSIDE_CASTLE)>-1}isQueensideCastle(){return this.flags.indexOf(Qr.QSIDE_CASTLE)>-1}isBigPawn(){return this.flags.indexOf(Qr.BIG_PAWN)>-1}}const tt=-1,Qr={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q",NULL_MOVE:"-"},cu=["a8","b8","c8","d8","e8","f8","g8","h8","a7","b7","c7","d7","e7","f7","g7","h7","a6","b6","c6","d6","e6","f6","g6","h6","a5","b5","c5","d5","e5","f5","g5","h5","a4","b4","c4","d4","e4","f4","g4","h4","a3","b3","c3","d3","e3","f3","g3","h3","a2","b2","c2","d2","e2","f2","g2","h2","a1","b1","c1","d1","e1","f1","g1","h1"],ce={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64,NULL_MOVE:128},$a={Event:"?",Site:"?",Date:"????.??.??",Round:"?",White:"?",Black:"?",Result:"*"},y2={WhiteTitle:null,BlackTitle:null,WhiteElo:null,BlackElo:null,WhiteUSCF:null,BlackUSCF:null,WhiteNA:null,BlackNA:null,WhiteType:null,BlackType:null,EventDate:null,EventSponsor:null,Section:null,Stage:null,Board:null,Opening:null,Variation:null,SubVariation:null,ECO:null,NIC:null,Time:null,UTCTime:null,UTCDate:null,TimeControl:null,SetUp:null,FEN:null,Termination:null,Annotator:null,Mode:null,PlyCount:null},$2={...$a,...y2},se={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},aa={b:[16,32,17,15],w:[-16,-32,-17,-15]},Yf={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},C2=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],M2=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],E2={p:1,n:2,b:4,r:8,q:16,k:32},T2="pnbrqkPNBRQK",Hf=[ya,hs,ri,Pr],S2=7,P2=6,B2=1,x2=0,fs={[Ve]:ce.KSIDE_CASTLE,[Pr]:ce.QSIDE_CASTLE},Er={w:[{square:se.a1,flag:ce.QSIDE_CASTLE},{square:se.h1,flag:ce.KSIDE_CASTLE}],b:[{square:se.a8,flag:ce.QSIDE_CASTLE},{square:se.h8,flag:ce.KSIDE_CASTLE}]},F2={b:B2,w:P2},oa="--";function tn(t){return t>>4}function ci(t){return t&15}function uu(t){return"0123456789".indexOf(t)!==-1}function et(t){const r=ci(t),n=tn(t);return"abcdefgh".substring(r,r+1)+"87654321".substring(n,n+1)}function Zn(t){return t===ot?Ft:ot}function D2(t){const r=t.split(/\s+/);if(r.length!==6)return{ok:!1,error:"Invalid FEN: must contain six space-delimited fields"};const n=parseInt(r[5],10);if(isNaN(n)||n<=0)return{ok:!1,error:"Invalid FEN: move number must be a positive integer"};const a=parseInt(r[4],10);if(isNaN(a)||a<0)return{ok:!1,error:"Invalid FEN: half move counter number must be a non-negative integer"};if(!/^(-|[abcdefgh][36])$/.test(r[3]))return{ok:!1,error:"Invalid FEN: en-passant square is invalid"};if(/[^kKqQ-]/.test(r[2]))return{ok:!1,error:"Invalid FEN: castling availability is invalid"};if(!/^(w|b)$/.test(r[1]))return{ok:!1,error:"Invalid FEN: side-to-move is invalid"};const l=r[0].split("/");if(l.length!==8)return{ok:!1,error:"Invalid FEN: piece data does not contain 8 '/'-delimited rows"};for(let u=0;u<l.length;u++){let d=0,g=!1;for(let v=0;v<l[u].length;v++)if(uu(l[u][v])){if(g)return{ok:!1,error:"Invalid FEN: piece data is invalid (consecutive number)"};d+=parseInt(l[u][v],10),g=!0}else{if(!/^[prnbqkPRNBQK]$/.test(l[u][v]))return{ok:!1,error:"Invalid FEN: piece data is invalid (invalid piece)"};d+=1,g=!1}if(d!==8)return{ok:!1,error:"Invalid FEN: piece data is invalid (too many squares in rank)"}}if(r[3][1]=="3"&&r[1]=="w"||r[3][1]=="6"&&r[1]=="b")return{ok:!1,error:"Invalid FEN: illegal en-passant square"};const f=[{color:"white",regex:/K/g},{color:"black",regex:/k/g}];for(const{color:u,regex:d}of f){if(!d.test(r[0]))return{ok:!1,error:`Invalid FEN: missing ${u} king`};if((r[0].match(d)||[]).length>1)return{ok:!1,error:`Invalid FEN: too many ${u} kings`}}return Array.from(l[0]+l[7]).some(u=>u.toUpperCase()==="P")?{ok:!1,error:"Invalid FEN: some pawns are on the edge rows"}:{ok:!0}}function O2(t,r){const n=t.from,a=t.to,l=t.piece;let f=0,u=0,d=0;for(let g=0,v=r.length;g<v;g++){const m=r[g].from,_=r[g].to,b=r[g].piece;l===b&&n!==m&&a===_&&(f++,tn(n)===tn(m)&&u++,ci(n)===ci(m)&&d++)}return f>0?u>0&&d>0?et(n):d>0?et(n).charAt(1):et(n).charAt(0):""}function Tr(t,r,n,a,l,f=void 0,u=ce.NORMAL){const d=tn(a);if(l===We&&(d===S2||d===x2))for(let g=0;g<Hf.length;g++){const v=Hf[g];t.push({color:r,from:n,to:a,piece:l,captured:f,promotion:v,flags:u|ce.PROMOTION})}else t.push({color:r,from:n,to:a,piece:l,captured:f,flags:u})}function Jf(t){let r=t.charAt(0);return r>="a"&&r<="h"?t.match(/[a-h]\d.*[a-h]\d/)?void 0:We:(r=r.toLowerCase(),r==="o"?Ve:r)}function la(t){return t.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}class Un{_board=new Array(128);_turn=ot;_header={};_kings={w:tt,b:tt};_epSquare=-1;_halfMoves=0;_moveNumber=0;_history=[];_comments={};_castling={w:0,b:0};_hash=0n;_positionCount=new Map;constructor(r=si,{skipValidation:n=!1}={}){this.load(r,{skipValidation:n})}clear({preserveHeaders:r=!1}={}){this._board=new Array(128),this._kings={w:tt,b:tt},this._turn=ot,this._castling={w:0,b:0},this._epSquare=tt,this._halfMoves=0,this._moveNumber=1,this._history=[],this._comments={},this._header=r?this._header:{...$2},this._hash=this._computeHash(),this._positionCount=new Map,this._header.SetUp=null,this._header.FEN=null}load(r,{skipValidation:n=!1,preserveHeaders:a=!1}={}){let l=r.split(/\s+/);if(l.length>=2&&l.length<6){const d=["-","-","0","1"];r=l.concat(d.slice(-(6-l.length))).join(" ")}if(l=r.split(/\s+/),!n){const{ok:d,error:g}=D2(r);if(!d)throw new Error(g)}const f=l[0];let u=0;this.clear({preserveHeaders:a});for(let d=0;d<f.length;d++){const g=f.charAt(d);if(g==="/")u+=8;else if(uu(g))u+=parseInt(g,10);else{const v=g<"a"?ot:Ft;this._put({type:g.toLowerCase(),color:v},et(u)),u++}}this._turn=l[1],l[2].indexOf("K")>-1&&(this._castling.w|=ce.KSIDE_CASTLE),l[2].indexOf("Q")>-1&&(this._castling.w|=ce.QSIDE_CASTLE),l[2].indexOf("k")>-1&&(this._castling.b|=ce.KSIDE_CASTLE),l[2].indexOf("q")>-1&&(this._castling.b|=ce.QSIDE_CASTLE),this._epSquare=l[3]==="-"?tt:se[l[3]],this._halfMoves=parseInt(l[4],10),this._moveNumber=parseInt(l[5],10),this._hash=this._computeHash(),this._updateSetup(r),this._incPositionCount()}fen({forceEnpassantSquare:r=!1}={}){let n=0,a="";for(let u=se.a8;u<=se.h1;u++){if(this._board[u]){n>0&&(a+=n,n=0);const{color:d,type:g}=this._board[u];a+=d===ot?g.toUpperCase():g.toLowerCase()}else n++;u+1&136&&(n>0&&(a+=n),u!==se.h1&&(a+="/"),n=0,u+=8)}let l="";this._castling[ot]&ce.KSIDE_CASTLE&&(l+="K"),this._castling[ot]&ce.QSIDE_CASTLE&&(l+="Q"),this._castling[Ft]&ce.KSIDE_CASTLE&&(l+="k"),this._castling[Ft]&ce.QSIDE_CASTLE&&(l+="q"),l=l||"-";let f="-";if(this._epSquare!==tt)if(r)f=et(this._epSquare);else{const u=this._epSquare+(this._turn===ot?16:-16),d=[u+1,u-1];for(const g of d){if(g&136)continue;const v=this._turn;if(this._board[g]?.color===v&&this._board[g]?.type===We){this._makeMove({color:v,from:g,to:this._epSquare,piece:We,captured:We,flags:ce.EP_CAPTURE});const m=!this._isKingAttacked(v);if(this._undoMove(),m){f=et(this._epSquare);break}}}}return[a,this._turn,l,f,this._halfMoves,this._moveNumber].join(" ")}_pieceKey(r){if(!this._board[r])return 0n;const{color:n,type:a}=this._board[r],l={w:0,b:1}[n],f={p:0,n:1,b:2,r:3,q:4,k:5}[a];return _2[l][f][r]}_epKey(){return this._epSquare===tt?0n:w2[this._epSquare&7]}_castlingKey(){const r=this._castling.w>>5|this._castling.b>>3;return k2[r]}_computeHash(){let r=0n;for(let n=se.a8;n<=se.h1;n++){if(n&136){n+=7;continue}this._board[n]&&(r^=this._pieceKey(n))}return r^=this._epKey(),r^=this._castlingKey(),this._turn==="b"&&(r^=sa),r}_updateSetup(r){this._history.length>0||(r!==si?(this._header.SetUp="1",this._header.FEN=r):(this._header.SetUp=null,this._header.FEN=null))}reset(){this.load(si)}get(r){return this._board[se[r]]}findPiece(r){const n=[];for(let a=se.a8;a<=se.h1;a++){if(a&136){a+=7;continue}!this._board[a]||this._board[a]?.color!==r.color||this._board[a].color===r.color&&this._board[a].type===r.type&&n.push(et(a))}return n}put({type:r,color:n},a){return this._put({type:r,color:n},a)?(this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),!0):!1}_set(r,n){this._hash^=this._pieceKey(r),this._board[r]=n,this._hash^=this._pieceKey(r)}_put({type:r,color:n},a){if(T2.indexOf(r.toLowerCase())===-1||!(a in se))return!1;const l=se[a];if(r==Ve&&!(this._kings[n]==tt||this._kings[n]==l))return!1;const f=this._board[l];return f&&f.type===Ve&&(this._kings[f.color]=tt),this._set(l,{type:r,color:n}),r===Ve&&(this._kings[n]=l),!0}_clear(r){this._hash^=this._pieceKey(r),delete this._board[r]}remove(r){const n=this.get(r);return this._clear(se[r]),n&&n.type===Ve&&(this._kings[n.color]=tt),this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),n}_updateCastlingRights(){this._hash^=this._castlingKey();const r=this._board[se.e1]?.type===Ve&&this._board[se.e1]?.color===ot,n=this._board[se.e8]?.type===Ve&&this._board[se.e8]?.color===Ft;(!r||this._board[se.a1]?.type!==ri||this._board[se.a1]?.color!==ot)&&(this._castling.w&=-65),(!r||this._board[se.h1]?.type!==ri||this._board[se.h1]?.color!==ot)&&(this._castling.w&=-33),(!n||this._board[se.a8]?.type!==ri||this._board[se.a8]?.color!==Ft)&&(this._castling.b&=-65),(!n||this._board[se.h8]?.type!==ri||this._board[se.h8]?.color!==Ft)&&(this._castling.b&=-33),this._hash^=this._castlingKey()}_updateEnPassantSquare(){if(this._epSquare===tt)return;const r=this._epSquare+(this._turn===ot?-16:16),n=this._epSquare+(this._turn===ot?16:-16),a=[n+1,n-1];if(this._board[r]!==null||this._board[this._epSquare]!==null||this._board[n]?.color!==Zn(this._turn)||this._board[n]?.type!==We){this._hash^=this._epKey(),this._epSquare=tt;return}const l=f=>!(f&136)&&this._board[f]?.color===this._turn&&this._board[f]?.type===We;a.some(l)||(this._hash^=this._epKey(),this._epSquare=tt)}_attacked(r,n,a){const l=[];for(let f=se.a8;f<=se.h1;f++){if(f&136){f+=7;continue}if(this._board[f]===void 0||this._board[f].color!==r)continue;const u=this._board[f],d=f-n;if(d===0)continue;const g=d+119;if(C2[g]&E2[u.type]){if(u.type===We){if(d>0&&u.color===ot||d<=0&&u.color===Ft)if(a)l.push(et(f));else return!0;continue}if(u.type==="n"||u.type==="k")if(a){l.push(et(f));continue}else return!0;const v=M2[g];let m=f+v,_=!1;for(;m!==n;){if(this._board[m]!=null){_=!0;break}m+=v}if(!_)if(a){l.push(et(f));continue}else return!0}}return a?l:!1}attackers(r,n){return n?this._attacked(n,se[r],!0):this._attacked(this._turn,se[r],!0)}_isKingAttacked(r){const n=this._kings[r];return n===-1?!1:this._attacked(Zn(r),n)}hash(){return this._hash.toString(16)}isAttacked(r,n){return this._attacked(n,se[r])}isCheck(){return this._isKingAttacked(this._turn)}inCheck(){return this.isCheck()}isCheckmate(){return this.isCheck()&&this._moves().length===0}isStalemate(){return!this.isCheck()&&this._moves().length===0}isInsufficientMaterial(){const r={b:0,n:0,r:0,q:0,k:0,p:0},n=[];let a=0,l=0;for(let f=se.a8;f<=se.h1;f++){if(l=(l+1)%2,f&136){f+=7;continue}const u=this._board[f];u&&(r[u.type]=u.type in r?r[u.type]+1:1,u.type===hs&&n.push(l),a++)}if(a===2)return!0;if(a===3&&(r[hs]===1||r[ya]===1))return!0;if(a===r[hs]+2){let f=0;const u=n.length;for(let d=0;d<u;d++)f+=n[d];if(f===0||f===u)return!0}return!1}isThreefoldRepetition(){return this._getPositionCount(this._hash)>=3}isDrawByFiftyMoves(){return this._halfMoves>=100}isDraw(){return this.isDrawByFiftyMoves()||this.isStalemate()||this.isInsufficientMaterial()||this.isThreefoldRepetition()}isGameOver(){return this.isCheckmate()||this.isDraw()}moves({verbose:r=!1,square:n=void 0,piece:a=void 0}={}){const l=this._moves({square:n,piece:a});return r?l.map(f=>new ls(this,f)):l.map(f=>this._moveToSan(f,l))}_moves({legal:r=!0,piece:n=void 0,square:a=void 0}={}){const l=a?a.toLowerCase():void 0,f=n?.toLowerCase(),u=[],d=this._turn,g=Zn(d);let v=se.a8,m=se.h1,_=!1;if(l)if(l in se)v=m=se[l],_=!0;else return[];for(let $=v;$<=m;$++){if($&136){$+=7;continue}if(!this._board[$]||this._board[$].color===g)continue;const{type:E}=this._board[$];let T;if(E===We){if(f&&f!==E)continue;T=$+aa[d][0],this._board[T]||(Tr(u,d,$,T,We),T=$+aa[d][1],F2[d]===tn($)&&!this._board[T]&&Tr(u,d,$,T,We,void 0,ce.BIG_PAWN));for(let z=2;z<4;z++)T=$+aa[d][z],!(T&136)&&(this._board[T]?.color===g?Tr(u,d,$,T,We,this._board[T].type,ce.CAPTURE):T===this._epSquare&&Tr(u,d,$,T,We,We,ce.EP_CAPTURE))}else{if(f&&f!==E)continue;for(let z=0,N=Yf[E].length;z<N;z++){const D=Yf[E][z];for(T=$;T+=D,!(T&136);){if(!this._board[T])Tr(u,d,$,T,E);else{if(this._board[T].color===d)break;Tr(u,d,$,T,E,this._board[T].type,ce.CAPTURE);break}if(E===ya||E===Ve)break}}}}if((f===void 0||f===Ve)&&(!_||m===this._kings[d])){if(this._castling[d]&ce.KSIDE_CASTLE){const $=this._kings[d],E=$+2;!this._board[$+1]&&!this._board[E]&&!this._attacked(g,this._kings[d])&&!this._attacked(g,$+1)&&!this._attacked(g,E)&&Tr(u,d,this._kings[d],E,Ve,void 0,ce.KSIDE_CASTLE)}if(this._castling[d]&ce.QSIDE_CASTLE){const $=this._kings[d],E=$-2;!this._board[$-1]&&!this._board[$-2]&&!this._board[$-3]&&!this._attacked(g,this._kings[d])&&!this._attacked(g,$-1)&&!this._attacked(g,E)&&Tr(u,d,this._kings[d],E,Ve,void 0,ce.QSIDE_CASTLE)}}if(!r||this._kings[d]===-1)return u;const b=[];for(let $=0,E=u.length;$<E;$++)this._makeMove(u[$]),this._isKingAttacked(d)||b.push(u[$]),this._undoMove();return b}move(r,{strict:n=!1}={}){let a=null;if(typeof r=="string")a=this._moveFromSan(r,n);else if(r===null)a=this._moveFromSan(oa,n);else if(typeof r=="object"){const f=this._moves();for(let u=0,d=f.length;u<d;u++)if(r.from===et(f[u].from)&&r.to===et(f[u].to)&&(!("promotion"in f[u])||r.promotion===f[u].promotion)){a=f[u];break}}if(!a)throw typeof r=="string"?new Error(`Invalid move: ${r}`):new Error(`Invalid move: ${JSON.stringify(r)}`);if(this.isCheck()&&a.flags&ce.NULL_MOVE)throw new Error("Null move not allowed when in check");const l=new ls(this,a);return this._makeMove(a),this._incPositionCount(),l}_push(r){this._history.push({move:r,kings:{b:this._kings.b,w:this._kings.w},turn:this._turn,castling:{b:this._castling.b,w:this._castling.w},epSquare:this._epSquare,halfMoves:this._halfMoves,moveNumber:this._moveNumber})}_movePiece(r,n){this._hash^=this._pieceKey(r),this._board[n]=this._board[r],delete this._board[r],this._hash^=this._pieceKey(n)}_makeMove(r){const n=this._turn,a=Zn(n);if(this._push(r),r.flags&ce.NULL_MOVE){n===Ft&&this._moveNumber++,this._halfMoves++,this._turn=a,this._epSquare=tt;return}if(this._hash^=this._epKey(),this._hash^=this._castlingKey(),r.captured&&(this._hash^=this._pieceKey(r.to)),this._movePiece(r.from,r.to),r.flags&ce.EP_CAPTURE&&(this._turn===Ft?this._clear(r.to-16):this._clear(r.to+16)),r.promotion&&(this._clear(r.to),this._set(r.to,{type:r.promotion,color:n})),this._board[r.to].type===Ve){if(this._kings[n]=r.to,r.flags&ce.KSIDE_CASTLE){const l=r.to-1,f=r.to+1;this._movePiece(f,l)}else if(r.flags&ce.QSIDE_CASTLE){const l=r.to+1,f=r.to-2;this._movePiece(f,l)}this._castling[n]=0}if(this._castling[n]){for(let l=0,f=Er[n].length;l<f;l++)if(r.from===Er[n][l].square&&this._castling[n]&Er[n][l].flag){this._castling[n]^=Er[n][l].flag;break}}if(this._castling[a]){for(let l=0,f=Er[a].length;l<f;l++)if(r.to===Er[a][l].square&&this._castling[a]&Er[a][l].flag){this._castling[a]^=Er[a][l].flag;break}}if(this._hash^=this._castlingKey(),r.flags&ce.BIG_PAWN){let l;n===Ft?l=r.to-16:l=r.to+16,!(r.to-1&136)&&this._board[r.to-1]?.type===We&&this._board[r.to-1]?.color===a||!(r.to+1&136)&&this._board[r.to+1]?.type===We&&this._board[r.to+1]?.color===a?(this._epSquare=l,this._hash^=this._epKey()):this._epSquare=tt}else this._epSquare=tt;r.piece===We?this._halfMoves=0:r.flags&(ce.CAPTURE|ce.EP_CAPTURE)?this._halfMoves=0:this._halfMoves++,n===Ft&&this._moveNumber++,this._turn=a,this._hash^=sa}undo(){const r=this._hash,n=this._undoMove();if(n){const a=new ls(this,n);return this._decPositionCount(r),a}return null}_undoMove(){const r=this._history.pop();if(r===void 0)return null;this._hash^=this._epKey(),this._hash^=this._castlingKey();const n=r.move;this._kings=r.kings,this._turn=r.turn,this._castling=r.castling,this._epSquare=r.epSquare,this._halfMoves=r.halfMoves,this._moveNumber=r.moveNumber,this._hash^=this._epKey(),this._hash^=this._castlingKey(),this._hash^=sa;const a=this._turn,l=Zn(a);if(n.flags&ce.NULL_MOVE)return n;if(this._movePiece(n.to,n.from),n.piece&&(this._clear(n.from),this._set(n.from,{type:n.piece,color:a})),n.captured)if(n.flags&ce.EP_CAPTURE){let f;a===Ft?f=n.to-16:f=n.to+16,this._set(f,{type:We,color:l})}else this._set(n.to,{type:n.captured,color:l});if(n.flags&(ce.KSIDE_CASTLE|ce.QSIDE_CASTLE)){let f,u;n.flags&ce.KSIDE_CASTLE?(f=n.to+1,u=n.to-1):(f=n.to-2,u=n.to+1),this._movePiece(u,f)}return n}pgn({newline:r=`
`,maxWidth:n=0}={}){const a=[];let l=!1;for(const b in this._header)this._header[b]&&a.push(`[${b} "${this._header[b]}"]`+r),l=!0;l&&this._history.length&&a.push(r);const f=b=>{const $=this._comments[this.fen()];if(typeof $<"u"){const E=b.length>0?" ":"";b=`${b}${E}{${$}}`}return b},u=[];for(;this._history.length>0;)u.push(this._undoMove());const d=[];let g="";for(u.length===0&&d.push(f(""));u.length>0;){g=f(g);const b=u.pop();if(!b)break;if(!this._history.length&&b.color==="b"){const $=`${this._moveNumber}. ...`;g=g?`${g} ${$}`:$}else b.color==="w"&&(g.length&&d.push(g),g=this._moveNumber+".");g=g+" "+this._moveToSan(b,this._moves({legal:!0})),this._makeMove(b)}if(g.length&&d.push(f(g)),d.push(this._header.Result||"*"),n===0)return a.join("")+d.join(" ");const v=function(){return a.length>0&&a[a.length-1]===" "?(a.pop(),!0):!1},m=function(b,$){for(const E of $.split(" "))if(E){if(b+E.length>n){for(;v();)b--;a.push(r),b=0}a.push(E),b+=E.length,a.push(" "),b++}return v()&&b--,b};let _=0;for(let b=0;b<d.length;b++){if(_+d[b].length>n&&d[b].includes("{")){_=m(_,d[b]);continue}_+d[b].length>n&&b!==0?(a[a.length-1]===" "&&a.pop(),a.push(r),_=0):b!==0&&(a.push(" "),_++),a.push(d[b]),_+=d[b].length}return a.join("")}header(...r){for(let n=0;n<r.length;n+=2)typeof r[n]=="string"&&typeof r[n+1]=="string"&&(this._header[r[n]]=r[n+1]);return this._header}setHeader(r,n){return this._header[r]=n??$a[r]??null,this.getHeaders()}removeHeader(r){return r in this._header?(this._header[r]=$a[r]||null,!0):!1}getHeaders(){const r={};for(const[n,a]of Object.entries(this._header))a!==null&&(r[n]=a);return r}loadPgn(r,{strict:n=!1,newlineChar:a=`\r?
`}={}){a!==`\r?
`&&(r=r.replace(new RegExp(a,"g"),`
`));const l=m2(r);this.reset();const f=l.headers;let u="";for(const v in f)v.toLowerCase()==="fen"&&(u=f[v]),this.header(v,f[v]);if(!n)u&&this.load(u,{preserveHeaders:!0});else if(f.SetUp==="1"){if(!("FEN"in f))throw new Error("Invalid PGN: FEN tag must be supplied with SetUp tag");this.load(f.FEN,{preserveHeaders:!0})}let d=l.root;for(;d;){if(d.move){const v=this._moveFromSan(d.move,n);if(v==null)throw new Error(`Invalid move in PGN: ${d.move}`);this._makeMove(v),this._incPositionCount()}d.comment!==void 0&&(this._comments[this.fen()]=d.comment),d=d.variations[0]}const g=l.result;g&&Object.keys(this._header).length&&this._header.Result!==g&&this.setHeader("Result",g)}_moveToSan(r,n){let a="";if(r.flags&ce.KSIDE_CASTLE)a="O-O";else if(r.flags&ce.QSIDE_CASTLE)a="O-O-O";else{if(r.flags&ce.NULL_MOVE)return oa;if(r.piece!==We){const l=O2(r,n);a+=r.piece.toUpperCase()+l}r.flags&(ce.CAPTURE|ce.EP_CAPTURE)&&(r.piece===We&&(a+=et(r.from)[0]),a+="x"),a+=et(r.to),r.promotion&&(a+="="+r.promotion.toUpperCase())}return this._makeMove(r),this.isCheck()&&(this.isCheckmate()?a+="#":a+="+"),this._undoMove(),a}_moveFromSan(r,n=!1){let a=la(r);if(n||(a==="0-0"?a="O-O":a==="0-0-0"&&(a="O-O-O")),a==oa)return{color:this._turn,from:0,to:0,piece:"k",flags:ce.NULL_MOVE};let l=Jf(a),f=this._moves({legal:!0,piece:l});for(let b=0,$=f.length;b<$;b++)if(a===la(this._moveToSan(f[b],f)))return f[b];if(n)return null;let u,d,g,v,m,_=!1;if(d=a.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/),d?(u=d[1],g=d[2],v=d[3],m=d[4],g.length==1&&(_=!0)):(d=a.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/),d&&(u=d[1],g=d[2],v=d[3],m=d[4],g.length==1&&(_=!0))),l=Jf(a),f=this._moves({legal:!0,piece:u||l}),!v)return null;for(let b=0,$=f.length;b<$;b++)if(g){if((!u||u.toLowerCase()==f[b].piece)&&se[g]==f[b].from&&se[v]==f[b].to&&(!m||m.toLowerCase()==f[b].promotion))return f[b];if(_){const E=et(f[b].from);if((!u||u.toLowerCase()==f[b].piece)&&se[v]==f[b].to&&(g==E[0]||g==E[1])&&(!m||m.toLowerCase()==f[b].promotion))return f[b]}}else if(a===la(this._moveToSan(f[b],f)).replace("x",""))return f[b];return null}ascii(){let r=`   +------------------------+
`;for(let n=se.a8;n<=se.h1;n++){if(ci(n)===0&&(r+=" "+"87654321"[tn(n)]+" |"),this._board[n]){const a=this._board[n].type,f=this._board[n].color===ot?a.toUpperCase():a.toLowerCase();r+=" "+f+" "}else r+=" . ";n+1&136&&(r+=`|
`,n+=8)}return r+=`   +------------------------+
`,r+="     a  b  c  d  e  f  g  h",r}perft(r){const n=this._moves({legal:!1});let a=0;const l=this._turn;for(let f=0,u=n.length;f<u;f++)this._makeMove(n[f]),this._isKingAttacked(l)||(r-1>0?a+=this.perft(r-1):a++),this._undoMove();return a}setTurn(r){return this._turn==r?!1:(this.move("--"),!0)}turn(){return this._turn}board(){const r=[];let n=[];for(let a=se.a8;a<=se.h1;a++)this._board[a]==null?n.push(null):n.push({square:et(a),type:this._board[a].type,color:this._board[a].color}),a+1&136&&(r.push(n),n=[],a+=8);return r}squareColor(r){if(r in se){const n=se[r];return(tn(n)+ci(n))%2===0?"light":"dark"}return null}history({verbose:r=!1}={}){const n=[],a=[];for(;this._history.length>0;)n.push(this._undoMove());for(;;){const l=n.pop();if(!l)break;r?a.push(new ls(this,l)):a.push(this._moveToSan(l,this._moves())),this._makeMove(l)}return a}_getPositionCount(r){return this._positionCount.get(r)??0}_incPositionCount(){this._positionCount.set(this._hash,(this._positionCount.get(this._hash)??0)+1)}_decPositionCount(r){const n=this._positionCount.get(r)??0;n===1?this._positionCount.delete(r):this._positionCount.set(r,n-1)}_pruneComments(){const r=[],n={},a=l=>{l in this._comments&&(n[l]=this._comments[l])};for(;this._history.length>0;)r.push(this._undoMove());for(a(this.fen());;){const l=r.pop();if(!l)break;this._makeMove(l),a(this.fen())}this._comments=n}getComment(){return this._comments[this.fen()]}setComment(r){this._comments[this.fen()]=r.replace("{","[").replace("}","]")}deleteComment(){return this.removeComment()}removeComment(){const r=this._comments[this.fen()];return delete this._comments[this.fen()],r}getComments(){return this._pruneComments(),Object.keys(this._comments).map(r=>({fen:r,comment:this._comments[r]}))}deleteComments(){return this.removeComments()}removeComments(){return this._pruneComments(),Object.keys(this._comments).map(r=>{const n=this._comments[r];return delete this._comments[r],{fen:r,comment:n}})}setCastlingRights(r,n){for(const l of[Ve,Pr])n[l]!==void 0&&(n[l]?this._castling[r]|=fs[l]:this._castling[r]&=~fs[l]);this._updateCastlingRights();const a=this.getCastlingRights(r);return(n[Ve]===void 0||n[Ve]===a[Ve])&&(n[Pr]===void 0||n[Pr]===a[Pr])}getCastlingRights(r){return{[Ve]:(this._castling[r]&fs[Ve])!==0,[Pr]:(this._castling[r]&fs[Pr])!==0}}moveNumber(){return this._moveNumber}}const U2=["white","black"],As=["a","b","c","d","e","f","g","h"],ms=["1","2","3","4","5","6","7","8"],R2=[...ms].reverse(),Bs=As.flatMap(t=>ms.map(r=>t+r)),ir=t=>t.every(r=>r>=0&&r<=7)?Bs[8*t[0]+t[1]]:void 0,Yr=t=>ir(t),be=t=>[t.charCodeAt(0)-97,t.charCodeAt(1)-49],hu=Bs.map(be),N2=Bs.map((t,r)=>({key:t,pos:hu[r]}));function pu(t){let r;const n=()=>(r===void 0&&(r=t()),r);return n.clear=()=>{r=void 0},n}const I2=()=>{let t;return{start(){t=performance.now()},cancel(){t=void 0},stop(){if(!t)return 0;const r=performance.now()-t;return t=void 0,r}}},xs=t=>t==="white"?"black":"white",ui=(t,r)=>(t[0]-r[0])**2+(t[1]-r[1])**2,bs=(t,r)=>t.role===r.role&&t.color===r.color,z2=(t,r)=>t[0]===r[0]&&t[1]===r[1],qi=t=>(r,n)=>[(n?r[0]:7-r[0])*t.width/8,(n?7-r[1]:r[1])*t.height/8],er=(t,r)=>{t.style.transform=`translate(${r[0]}px,${r[1]}px)`},du=(t,r,n=1)=>{t.style.transform=`translate(${r[0]}px,${r[1]}px) scale(${n})`},Ya=(t,r)=>{t.style.visibility=r?"visible":"hidden"},cn=t=>{if(t.clientX||t.clientX===0)return[t.clientX,t.clientY];if(t.targetTouches?.[0])return[t.targetTouches[0].clientX,t.targetTouches[0].clientY]},L2=pu(()=>!("ontouchstart"in window)&&["macintosh","firefox"].every(t=>navigator.userAgent.toLowerCase().includes(t))),vu=t=>t.button===2&&!(t.ctrlKey&&L2()),dr=(t,r)=>{const n=document.createElement(t);return r&&(n.className=r),n};function gu(t,r,n){const a=be(t);return r||(a[0]=7-a[0],a[1]=7-a[1]),[n.left+n.width*a[0]/8+n.width/16,n.top+n.height*(7-a[1])/8+n.height/16]}const sr=(t,r)=>Math.abs(t-r),Ha=(t,r,n,a)=>sr(t,n)*sr(r,a)===2,Ja=(t,r,n,a)=>t===n!=(r===a),Za=(t,r,n,a)=>sr(t,n)===sr(r,a)&&t!==n,qu=(t,r,n,a)=>Ja(t,r,n,a)||Za(t,r,n,a),Au=(t,r,n,a)=>Math.max(sr(t,n),sr(r,a))===1,mu=(t,r,n,a,l)=>sr(t,n)===1&&a===r+(l?1:-1),bu=(t,r,n,a,l)=>{const f=l?1:-1;return t===n&&(a===r+f||a===r+2*f&&(l?r<=1:r>=6))},Fs=(t,r,n,a)=>{const l=n-t,f=a-r;if(l&&f&&Math.abs(l)!==Math.abs(f))return[];const u=Math.sign(l),d=Math.sign(f),g=[];let v=t+u,m=r+d;for(;v!==n||m!==a;)g.push([v,m]),v+=u,m+=d;return g.map(ir).filter(_=>_!==void 0)},W2=t=>{const r=be(t),n=[];return r[0]>0&&n.push([r[0]-1,r[1]]),r[0]<7&&n.push([r[0]+1,r[1]]),n.map(ir).filter(a=>a!==void 0)},_s=(t,r)=>{const n=be(t);return n[1]+=r,ir(n)},Rn=t=>t.friendlies.has(t.dest.key),K2=t=>t.enemies.has(t.dest.key),_u=(t,r,n)=>Fs(...t,...r).some(a=>n.has(a)),wu=(t,r,n)=>{const a=n.enemies.get(t);if(a?.role!=="pawn")return!1;const l=a.color==="white"?1:-1,f=be(t),u=be(r);return bu(...f,...u,a.color==="white")&&!_u(f,[u[0],u[1]+l],n.allPieces)},j2=(t,r,n)=>{const a=n.enemies.get(t);return a?.role==="pawn"&&mu(...be(t),...be(r),a.color==="white")&&(n.friendlies.has(r)||Os(_s(r,a.color==="white"?-1:1),n.friendlies,n.enemies,n.lastMove))},V2=t=>[...t.enemies.keys()].some(r=>wu(r,t.dest.key,t)),Ca=(t,r)=>{const n=t.dest.pos;return[...t.enemies].some(([a,l])=>{const f=be(a);return!r?.includes(l.role)&&(l.role==="pawn"&&mu(...f,...n,l.color==="white")||l.role==="knight"&&Ha(...f,...n)||l.role==="bishop"&&Za(...f,...n)||l.role==="rook"&&Ja(...f,...n)||l.role==="queen"&&qu(...f,...n)||l.role==="king"&&Au(...f,...n))&&(!["bishop","rook","queen"].includes(l.role)||!_u(f,n,t.allPieces))})},Ds=t=>Rn(t)&&(Os(t.dest.key,t.friendlies,t.enemies,t.lastMove)||Ca(t)),Os=(t,r,n,a)=>{if(!t||a&&t!==a[1])return!1;const l=be(t),f=r.get(t);return f?.role==="pawn"&&l[1]===(f.color==="white"?3:4)&&(!a||sr(be(a[0])[1],l[1])===2)&&[1,-1].some(u=>{const d=ir([l[0]+u,l[1]]);return!!d&&n.get(d)?.role==="pawn"})},G2=(t,r)=>{if(t.unrestrictedPremoves)return!0;const n=Fs(...t.orig.pos,...t.dest.pos);r&&n.push(t.dest.key);const a=n.filter(u=>t.friendlies.has(u));if(!a.length)return!0;const l=a[0],f=_s(l,t.color==="white"?-1:1);return a.length===1&&Os(l,t.friendlies,t.enemies,t.lastMove)&&!!f&&!n.includes(f)},Q2=(t,r)=>{if(t.unrestrictedPremoves)return!0;const n=Fs(...t.orig.pos,...t.dest.pos);r&&n.push(t.dest.key);const a=n.filter(m=>t.enemies.has(m));if(a.length>1)return!1;if(!a.length)return!0;const l=a[0],f=t.enemies.get(l);if(!f||f.role!=="pawn")return!0;const u=f.color==="white"?1:-1,d=_s(l,u),g=d?[...W2(d).filter(m=>j2(l,m,t)),...[d,_s(d,u)].filter(m=>!!m).filter(m=>wu(l,m,t))]:[],v=[...n,t.orig.key];return g.some(m=>!v.includes(m))},Xa=(t,r)=>G2(t,r)&&Q2(t,r),Y2=t=>{const r=t.color==="white"?1:-1;return sr(t.orig.pos[0],t.dest.pos[0])>1?!1:sr(t.orig.pos[0],t.dest.pos[0])?t.dest.pos[1]!==t.orig.pos[1]+r?!1:t.unrestrictedPremoves||K2(t)?!0:Rn(t)?Ca(t):V2(t)||Os(ir([t.dest.pos[0],t.dest.pos[1]+r]),t.friendlies,t.enemies,t.lastMove)||Ca(t,["pawn"]):bu(...t.orig.pos,...t.dest.pos,t.color==="white")&&Xa(t,!0)},H2=t=>Ha(...t.orig.pos,...t.dest.pos)&&(t.unrestrictedPremoves||!Rn(t)||Ds(t)),ku=t=>Za(...t.orig.pos,...t.dest.pos)&&Xa(t,!1)&&(t.unrestrictedPremoves||!Rn(t)||Ds(t)),yu=t=>Ja(...t.orig.pos,...t.dest.pos)&&Xa(t,!1)&&(t.unrestrictedPremoves||!Rn(t)||Ds(t)),J2=t=>ku(t)||yu(t),Z2=t=>Au(...t.orig.pos,...t.dest.pos)&&(t.unrestrictedPremoves||!Rn(t)||Ds(t))||t.canCastle&&t.orig.pos[1]===t.dest.pos[1]&&t.orig.pos[1]===(t.color==="white"?0:7)&&(t.orig.pos[0]===4&&(t.dest.pos[0]===2&&t.rookFilesFriendlies.includes(0)||t.dest.pos[0]===6&&t.rookFilesFriendlies.includes(7))||t.rookFilesFriendlies.includes(t.dest.pos[0]))&&(t.unrestrictedPremoves||Fs(...t.orig.pos,t.dest.pos[0]>t.orig.pos[0]?7:1,t.dest.pos[1]).map(r=>t.allPieces.get(r)).every(r=>!r||bs(r,{role:"rook",color:t.color}))),X2={pawn:Y2,knight:H2,bishop:ku,rook:yu,queen:J2,king:Z2};function $u(t,r){const n=t.pieces,a=t.premovable.castle,l=!!t.premovable.unrestrictedPremoves,f=n.get(r);if(!f||f.color===t.turnColor)return[];const u=f.color,d=new Map([...n].filter(([b,$])=>$.color===u)),g=new Map([...n].filter(([b,$])=>$.color===xs(u))),v={key:r,pos:be(r)},m=b=>X2[f.role](b)&&t.premovable.additionalPremoveRequirements(b),_={orig:v,role:f.role,allPieces:n,friendlies:d,enemies:g,unrestrictedPremoves:l,color:u,canCastle:a,rookFilesFriendlies:Array.from(n).filter(([b,$])=>b[1]===(u==="white"?"1":"8")&&$.color===u&&$.role==="rook").map(([b])=>be(b)[0]),lastMove:t.lastMove};return N2.filter(b=>m({..._,dest:b})).map(b=>b.key)}function Et(t,...r){t&&setTimeout(()=>t(...r),1)}function eb(t){t.orientation=xs(t.orientation),t.animation.current=t.draggable.current=t.selected=void 0}function tb(t,r){for(const[n,a]of r)a?t.pieces.set(n,a):t.pieces.delete(n)}function rb(t,r){if(t.check=void 0,r===!0&&(r=t.turnColor),r)for(const[n,a]of t.pieces)a.role==="king"&&a.color===r&&(t.check=n)}function nb(t,r,n,a){Ir(t),t.premovable.current=[r,n],Et(t.premovable.events.set,r,n,a)}function Nr(t){t.premovable.current&&(t.premovable.current=void 0,Et(t.premovable.events.unset))}function ib(t,r,n){Nr(t),t.predroppable.current={role:r,key:n},Et(t.predroppable.events.set,r,n)}function Ir(t){const r=t.predroppable;r.current&&(r.current=void 0,Et(r.events.unset))}function sb(t,r,n){if(!t.autoCastle)return!1;const a=t.pieces.get(r);if(!a||a.role!=="king")return!1;const l=be(r),f=be(n);if(l[1]!==0&&l[1]!==7||l[1]!==f[1])return!1;l[0]===4&&!t.pieces.has(n)&&(f[0]===6?n=Yr([7,f[1]]):f[0]===2&&(n=Yr([0,f[1]])));const u=t.pieces.get(n);return!u||u.color!==a.color||u.role!=="rook"?!1:(t.pieces.delete(r),t.pieces.delete(n),l[0]<f[0]?(t.pieces.set(Yr([6,f[1]]),a),t.pieces.set(Yr([5,f[1]]),u)):(t.pieces.set(Yr([2,f[1]]),a),t.pieces.set(Yr([3,f[1]]),u)),!0)}function Cu(t,r,n){const a=t.pieces.get(r),l=t.pieces.get(n);if(r===n||!a)return!1;const f=l&&l.color!==a.color?l:void 0;return n===t.selected&&zt(t),Et(t.events.move,r,n,f),sb(t,r,n)||(t.pieces.set(n,a),t.pieces.delete(r)),t.lastMove=[r,n],t.check=void 0,Et(t.events.change),f||!0}function eo(t,r,n,a){if(t.pieces.has(n))if(a)t.pieces.delete(n);else return!1;return Et(t.events.dropNewPiece,r,n),t.pieces.set(n,r),t.lastMove=[n],t.check=void 0,Et(t.events.change),t.movable.dests=void 0,t.turnColor=xs(t.turnColor),!0}function Mu(t,r,n){const a=Cu(t,r,n);return a&&(t.movable.dests=void 0,t.turnColor=xs(t.turnColor),t.animation.current=void 0),a}function Eu(t,r,n){if(to(t,r,n)){const a=Mu(t,r,n);if(a){const l=t.hold.stop();zt(t);const f={premove:!1,ctrlKey:t.stats.ctrlKey,holdTime:l};return a!==!0&&(f.captured=a),Et(t.movable.events.after,r,n,f),!0}}else if(ob(t,r,n))return nb(t,r,n,{ctrlKey:t.stats.ctrlKey}),zt(t),!0;return zt(t),!1}function Tu(t,r,n,a){const l=t.pieces.get(r);l&&(ab(t,r,n)||a)?(t.pieces.delete(r),eo(t,l,n,a),Et(t.movable.events.afterNewPiece,l.role,n,{premove:!1,predrop:!1})):l&&lb(t,r,n)?ib(t,l.role,n):(Nr(t),Ir(t)),t.pieces.delete(r),zt(t)}function Ma(t,r,n){if(Et(t.events.select,r),t.selected){if(t.selected===r&&!t.draggable.enabled){zt(t),t.hold.cancel();return}else if((t.selectable.enabled||n)&&t.selected!==r&&Eu(t,t.selected,r)){t.stats.dragged=!1;return}}(t.selectable.enabled||t.draggable.enabled)&&(Pu(t,r)||ro(t,r))&&(Su(t,r),t.hold.start())}function Su(t,r){t.selected=r,ro(t,r)?t.premovable.customDests||(t.premovable.dests=$u(t,r)):t.premovable.dests=void 0}function zt(t){t.selected=void 0,t.premovable.dests=void 0,t.hold.cancel()}function Pu(t,r){const n=t.pieces.get(r);return!!n&&(t.movable.color==="both"||t.movable.color===n.color&&t.turnColor===n.color)}const to=(t,r,n)=>r!==n&&Pu(t,r)&&(t.movable.free||!!t.movable.dests?.get(r)?.includes(n));function ab(t,r,n){const a=t.pieces.get(r);return!!a&&(r===n||!t.pieces.has(n))&&(t.movable.color==="both"||t.movable.color===a.color&&t.turnColor===a.color)}function ro(t,r){const n=t.pieces.get(r);return!!n&&t.premovable.enabled&&t.movable.color===n.color&&t.turnColor!==n.color}const ob=(t,r,n)=>r!==n&&ro(t,r)&&(t.premovable.customDests?.get(r)??$u(t,r)).includes(n);function lb(t,r,n){const a=t.pieces.get(r),l=t.pieces.get(n);return!!a&&(!l||l.color!==t.movable.color)&&t.predroppable.enabled&&(a.role!=="pawn"||n[1]!=="1"&&n[1]!=="8")&&t.movable.color===a.color&&t.turnColor!==a.color}function fb(t,r){const n=t.pieces.get(r);return!!n&&t.draggable.enabled&&(t.movable.color==="both"||t.movable.color===n.color&&(t.turnColor===n.color||t.premovable.enabled))}function cb(t){const r=t.premovable.current;if(!r)return!1;const n=r[0],a=r[1];let l=!1;if(to(t,n,a)){const f=Mu(t,n,a);if(f){const u={premove:!0};f!==!0&&(u.captured=f),Et(t.movable.events.after,n,a,u),l=!0}}return Nr(t),l}function ub(t,r){const n=t.predroppable.current;let a=!1;if(!n)return!1;if(r(n)){const l={role:n.role,color:t.movable.color};eo(t,l,n.key)&&(Et(t.movable.events.afterNewPiece,n.role,n.key,{premove:!1,predrop:!0}),a=!0)}return Ir(t),a}function no(t){Nr(t),Ir(t),zt(t)}function Zf(t){t.movable.color=t.movable.dests=t.animation.current=void 0,no(t)}function un(t,r,n){let a=Math.floor(8*(t[0]-n.left)/n.width);r||(a=7-a);let l=7-Math.floor(8*(t[1]-n.top)/n.height);return r||(l=7-l),a>=0&&a<8&&l>=0&&l<8?ir([a,l]):void 0}function hb(t,r,n,a){const l=be(t),f=hu.filter(v=>z2(l,v)||qu(l[0],l[1],v[0],v[1])||Ha(l[0],l[1],v[0],v[1])),d=f.map(v=>gu(Yr(v),n,a)).map(v=>ui(r,v)),[,g]=d.reduce((v,m,_)=>v[0]<m?v:[m,_],[d[0],0]);return ir(f[g])}const Tt=t=>t.orientation==="white",Bu="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",pb={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},db={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};function xu(t){t==="start"&&(t=Bu);const r=new Map;let n=7,a=0;for(const l of t)switch(l){case" ":case"[":return r;case"/":if(--n,n<0)return r;a=0;break;case"~":{const f=ir([a-1,n]),u=f&&r.get(f);u&&(u.promoted=!0);break}default:{const f=l.charCodeAt(0);if(f<57)a+=f-48;else{const u=l.toLowerCase(),d=ir([a,n]);d&&r.set(d,{role:pb[u],color:l===u?"black":"white"}),++a}}}return r}function vb(t){return R2.map(r=>As.map(n=>{const a=t.get(n+r);if(a){let l=db[a.role];return a.color==="white"&&(l=l.toUpperCase()),a.promoted&&(l+="~"),l}else return"1"}).join("")).join("/").replace(/1{2,}/g,r=>r.length.toString())}function Fu(t,r){r.animation&&(io(t.animation,r.animation),(t.animation.duration||0)<70&&(t.animation.enabled=!1))}function Du(t,r){if(r.movable?.dests&&(t.movable.dests=void 0),r.drawable?.autoShapes&&(t.drawable.autoShapes=[]),io(t,r),r.fen&&(t.pieces=xu(r.fen),t.drawable.shapes=r.drawable?.shapes||[]),"check"in r&&rb(t,r.check||!1),"lastMove"in r&&!r.lastMove?t.lastMove=void 0:r.lastMove&&(t.lastMove=r.lastMove),t.selected&&Su(t,t.selected),Fu(t,r),!t.movable.rookCastle&&t.movable.dests){const n=t.movable.color==="white"?"1":"8",a="e"+n,l=t.movable.dests.get(a),f=t.pieces.get(a);if(!l||!f||f.role!=="king")return;t.movable.dests.set(a,l.filter(u=>!(u==="a"+n&&l.includes("c"+n))&&!(u==="h"+n&&l.includes("g"+n))))}}function io(t,r){for(const n in r)n==="__proto__"||n==="constructor"||!Object.prototype.hasOwnProperty.call(r,n)||(Object.prototype.hasOwnProperty.call(t,n)&&Xf(t[n])&&Xf(r[n])?io(t[n],r[n]):t[n]=r[n])}function Xf(t){if(typeof t!="object"||t===null)return!1;const r=Object.getPrototypeOf(t);return r===Object.prototype||r===null}const Hr=(t,r)=>r.animation.enabled?Ab(t,r):Sr(t,r);function Sr(t,r){const n=t(r);return r.dom.redraw(),n}const fa=(t,r)=>({key:t,pos:be(t),piece:r}),gb=(t,r)=>r.sort((n,a)=>ui(t.pos,n.pos)-ui(t.pos,a.pos))[0];function qb(t,r){const n=new Map,a=[],l=new Map,f=[],u=[],d=new Map;let g,v,m;for(const[_,b]of t)d.set(_,fa(_,b));for(const _ of Bs)g=r.pieces.get(_),v=d.get(_),g?v?bs(g,v.piece)||(f.push(v),u.push(fa(_,g))):u.push(fa(_,g)):v&&f.push(v);for(const _ of u)v=gb(_,f.filter(b=>bs(_.piece,b.piece))),v&&(m=[v.pos[0]-_.pos[0],v.pos[1]-_.pos[1]],n.set(_.key,m.concat(m)),a.push(v.key));for(const _ of f)a.includes(_.key)||l.set(_.key,_.piece);return{anims:n,fadings:l}}function Ou(t,r){const n=t.animation.current;if(n===void 0){t.dom.destroyed||t.dom.redrawNow();return}const a=1-(r-n.start)*n.frequency;if(a<=0)t.animation.current=void 0,t.dom.redrawNow();else{const l=mb(a);for(const f of n.plan.anims.values())f[2]=f[0]*l,f[3]=f[1]*l;t.dom.redrawNow(!0),requestAnimationFrame((f=performance.now())=>Ou(t,f))}}function Ab(t,r){const n=new Map(r.pieces),a=t(r),l=qb(n,r);if(l.anims.size||l.fadings.size){const f=r.animation.current&&r.animation.current.start;r.animation.current={start:performance.now(),frequency:1/r.animation.duration,plan:l},f||Ou(r,performance.now())}else r.dom.redraw();return a}const mb=t=>t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1,bb=["green","red","blue","yellow"];function _b(t,r){if(r.touches&&r.touches.length>1)return;r.stopPropagation(),r.preventDefault(),r.ctrlKey?zt(t):no(t);const n=cn(r),a=un(n,Tt(t),t.dom.bounds());a&&(t.drawable.current={orig:a,pos:n,brush:$b(r),snapToValidMove:t.drawable.defaultSnapToValidMove},Uu(t))}function Uu(t){requestAnimationFrame(()=>{const r=t.drawable.current;if(r){const n=un(r.pos,Tt(t),t.dom.bounds());n||(r.snapToValidMove=!1);const a=r.snapToValidMove?hb(r.orig,r.pos,Tt(t),t.dom.bounds()):n;a!==r.mouseSq&&(r.mouseSq=a,r.dest=a!==r.orig?a:void 0,t.dom.redrawNow()),Uu(t)}})}function wb(t,r){t.drawable.current&&(t.drawable.current.pos=cn(r))}function kb(t){const r=t.drawable.current;r&&(r.mouseSq&&Cb(t.drawable,r),Ru(t))}function Ru(t){t.drawable.current&&(t.drawable.current=void 0,t.dom.redraw())}function yb(t){t.drawable.shapes.length&&(t.drawable.shapes=[],t.dom.redraw(),Iu(t.drawable))}const Ea=(t,r)=>t.orig===r.orig&&t.dest===r.dest,Nu=(t,r)=>t.brush===r.brush;function $b(t){const r=(t.shiftKey||t.ctrlKey)&&vu(t),n=t.altKey||t.metaKey||t.getModifierState?.("AltGraph");return bb[(r?1:0)+(n?2:0)]}function Cb(t,r){const n=t.shapes.find(a=>Ea(a,r));n&&(t.shapes=t.shapes.filter(a=>!Ea(a,r))),(!n||!Nu(n,r))&&t.shapes.push({orig:r.orig,dest:r.dest,brush:r.brush}),Iu(t)}function Iu(t){t.onChange&&t.onChange(t.shapes)}function Mb(t,r){if(!(t.trustAllEvents||r.isTrusted)||r.buttons!==void 0&&r.buttons>1||r.touches&&r.touches.length>1)return;const n=t.dom.bounds(),a=cn(r),l=un(a,Tt(t),n);if(!l)return;const f=t.pieces.get(l),u=t.selected;if(!u&&t.drawable.enabled&&(t.drawable.eraseOnMovablePieceClick||!f||f.color!==t.turnColor)&&yb(t),r.cancelable!==!1&&(!r.touches||t.blockTouchScroll||f||u||Eb(t,a)))r.preventDefault();else if(r.touches)return;const d=!!t.premovable.current,g=!!t.predroppable.current;t.stats.ctrlKey=r.ctrlKey,t.selected&&to(t,t.selected,l)?Hr(_=>Ma(_,l),t):Ma(t,l);const v=t.selected===l,m=Lu(t,l);if(f&&m&&v&&fb(t,l)){t.draggable.current={orig:l,piece:f,origPos:a,pos:a,started:t.draggable.autoDistance&&t.stats.dragged,element:m,previouslySelected:u,originTarget:r.target,keyHasChanged:!1},m.cgDragging=!0,m.classList.add("dragging");const _=t.dom.elements.ghost;_&&(_.className=`ghost ${f.color} ${f.role}`,er(_,qi(n)(be(l),Tt(t))),Ya(_,!0)),so(t)}else d&&Nr(t),g&&Ir(t);t.dom.redraw()}function Eb(t,r){const n=Tt(t),a=t.dom.bounds(),l=Math.pow(t.touchIgnoreRadius*a.width/16,2)*2;for(const f of t.pieces.keys()){const u=gu(f,n,a);if(ui(u,r)<=l)return!0}return!1}function Tb(t,r,n,a){t.pieces.set("a0",r),t.dom.redraw();const f=cn(n);t.draggable.current={orig:"a0",piece:r,origPos:f,pos:f,started:!0,element:()=>Lu(t,"a0"),originTarget:n.target,newPiece:!0,force:!!a,keyHasChanged:!1},so(t)}function so(t){requestAnimationFrame(()=>{const r=t.draggable.current;if(!r)return;t.animation.current?.plan.anims.has(r.orig)&&(t.animation.current=void 0);const n=t.pieces.get(r.orig);if(!n||!bs(n,r.piece))ws(t);else if(!r.started&&ui(r.pos,r.origPos)>=Math.pow(t.draggable.distance,2)&&(r.started=!0),r.started){if(typeof r.element=="function"){const l=r.element();if(!l)return;l.cgDragging=!0,l.classList.add("dragging"),r.element=l}const a=t.dom.bounds();er(r.element,[r.pos[0]-a.left-a.width/16,r.pos[1]-a.top-a.height/16]),r.keyHasChanged||(r.keyHasChanged=r.orig!==un(r.pos,Tt(t),a))}so(t)})}function Sb(t,r){t.draggable.current&&(!r.touches||r.touches.length<2)&&(t.draggable.current.pos=cn(r))}function Pb(t,r){const n=t.draggable.current;if(!n)return;if(r.type==="touchend"&&r.cancelable!==!1&&r.preventDefault(),r.type==="touchend"&&n.originTarget!==r.target&&!n.newPiece){t.draggable.current=void 0;return}Nr(t),Ir(t);const a=cn(r)||n.pos,l=un(a,Tt(t),t.dom.bounds());l&&n.started&&n.orig!==l?n.newPiece?Tu(t,n.orig,l,n.force):(t.stats.ctrlKey=r.ctrlKey,Eu(t,n.orig,l)&&(t.stats.dragged=!0)):n.newPiece?t.pieces.delete(n.orig):t.draggable.deleteOnDropOff&&!l&&(t.pieces.delete(n.orig),Et(t.events.change)),(n.orig===n.previouslySelected||n.keyHasChanged)&&(n.orig===l||!l)?zt(t):t.selectable.enabled||zt(t),zu(t),t.draggable.current=void 0,t.dom.redraw()}function ws(t){const r=t.draggable.current;r&&(r.newPiece&&t.pieces.delete(r.orig),t.draggable.current=void 0,zt(t),zu(t),t.dom.redraw())}function zu(t){const r=t.dom.elements;r.ghost&&Ya(r.ghost,!1)}function Lu(t,r){let n=t.dom.elements.board.firstChild;for(;n;){if(n.cgKey===r&&n.tagName==="PIECE")return n;n=n.nextSibling}}function Bb(t,r){t.exploding={stage:1,keys:r},t.dom.redraw(),setTimeout(()=>{ec(t,2),setTimeout(()=>ec(t,void 0),120)},120)}function ec(t,r){t.exploding&&(r?t.exploding.stage=r:t.exploding=void 0,t.dom.redraw())}function xb(t,r){function n(){eb(t),r()}return{set(a){a.orientation&&a.orientation!==t.orientation&&n(),Fu(t,a),(a.fen?Hr:Sr)(l=>Du(l,a),t)},state:t,getFen:()=>vb(t.pieces),toggleOrientation:n,setPieces(a){Hr(l=>tb(l,a),t)},selectSquare(a,l){a?Hr(f=>Ma(f,a,l),t):t.selected&&(zt(t),t.dom.redraw())},move(a,l){Hr(f=>Cu(f,a,l),t)},newPiece(a,l){Hr(f=>eo(f,a,l),t)},playPremove(){if(t.premovable.current){if(Hr(cb,t))return!0;t.dom.redraw()}return!1},playPredrop(a){if(t.predroppable.current){const l=ub(t,a);return t.dom.redraw(),l}return!1},cancelPremove(){Sr(Nr,t)},cancelPredrop(){Sr(Ir,t)},cancelMove(){Sr(a=>{no(a),ws(a)},t)},stop(){Sr(a=>{Zf(a),ws(a)},t)},explode(a){Bb(t,a)},setAutoShapes(a){Sr(l=>l.drawable.autoShapes=a,t)},setShapes(a){Sr(l=>l.drawable.shapes=a.slice(),t)},getKeyAtDomPos(a){return un(a,Tt(t),t.dom.bounds())},redrawAll:r,dragNewPiece(a,l,f){Tb(t,a,l,f)},destroy(){Zf(t),t.dom.unbind&&t.dom.unbind(),t.dom.destroyed=!0}}}function Fb(){return{pieces:xu(Bu),orientation:"white",turnColor:"white",coordinates:!0,coordinatesOnSquares:!1,ranksPosition:"right",autoCastle:!0,viewOnly:!1,disableContextMenu:!1,addPieceZIndex:!1,blockTouchScroll:!1,touchIgnoreRadius:1,pieceKey:!1,trustAllEvents:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,additionalPremoveRequirements:t=>!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnMovablePieceClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15},purple:{key:"purple",color:"#68217a",opacity:.65,lineWidth:10},pink:{key:"pink",color:"#ee2080",opacity:.5,lineWidth:10},white:{key:"white",color:"white",opacity:1,lineWidth:10},paleWhite:{key:"pwhite",color:"white",opacity:.6,lineWidth:10}},prevSvgHash:""},hold:I2()}}function Db(){const t=nt("defs"),r=mt(nt("filter"),{id:"cg-filter-blur"});return r.appendChild(mt(nt("feGaussianBlur"),{stdDeviation:"0.013"})),t.appendChild(r),t}function Ob(t,r){const n=t.drawable,a=n.current,l=a&&a.mouseSq?a:void 0,f=new Map,u=t.dom.bounds(),d=n.autoShapes.filter(_=>!_.piece);for(const _ of n.shapes.concat(d).concat(l?[l]:[])){if(!_.dest)continue;const b=f.get(_.dest)??new Set,$=ys(ks(be(_.orig),t.orientation),u),E=ys(ks(be(_.dest),t.orientation),u);b.add(Sa($,E)),f.set(_.dest,b)}const g=[],v=l?n.shapes.findIndex(_=>Ea(_,l)&&Nu(_,l)):-1;for(const[_,b]of n.shapes.concat(d).entries()){const $=v!==-1&&v===_;g.push({shape:b,current:!1,pendingErase:$,hash:tc(b,Ta(b.dest,f),!1,u,$)})}l&&v===-1&&g.push({shape:l,current:!0,hash:tc(l,Ta(l.dest,f),!0,u,!1),pendingErase:!1});const m=g.map(_=>_.hash).join(";");m!==t.drawable.prevSvgHash&&(t.drawable.prevSvgHash=m,Ub(n,g,r),Rb(g,r,_=>zb(t,_,n.brushes,f,u)))}function Ub(t,r,n){for(const a of[n.shapes,n.shapesBelow]){const l=a.querySelector("defs"),f=r.filter(v=>a===n.shapesBelow==!!v.shape.below),u=new Map;for(const v of f.filter(m=>m.shape.dest&&m.shape.brush)){const m=Wu(t.brushes[v.shape.brush],v.shape.modifiers),{key:_,color:b}=Ku(v.shape);_&&b&&u.set(_,{key:_,color:b,opacity:1,lineWidth:1}),u.set(m.key,m)}const d=new Set;let g=l.firstElementChild;for(;g;)d.add(g.getAttribute("cgKey")),g=g.nextElementSibling;for(const[v,m]of u.entries())d.has(v)||l.appendChild(Kb(m))}}function Rb(t,r,n){for(const[a,l]of[[r.shapes,r.custom],[r.shapesBelow,r.customBelow]]){const[f,u]=[a,l].map(v=>v.querySelector("g")),d=t.filter(v=>a===r.shapesBelow==!!v.shape.below),g=new Map;for(const v of d)g.set(v.hash,!1);for(const v of[f,u]){const m=[];let _=v.firstElementChild,b;for(;_;)b=_.getAttribute("cgHash"),g.has(b)?g.set(b,!0):m.push(_),_=_.nextElementSibling;for(const $ of m)v.removeChild($)}for(const v of d.filter(m=>!g.get(m.hash)))for(const m of n(v))m.isCustom?u.appendChild(m.el):f.appendChild(m.el)}}function tc({orig:t,dest:r,brush:n,piece:a,modifiers:l,customSvg:f,label:u,below:d},g,v,m,_){return[m.width,m.height,v,_&&"pendingErase",t,r,n,g&&"-",a&&Nb(a),l&&Ib(l),f&&`custom-${rc(f.html)},${f.center?.[0]??"o"}`,u&&`label-${rc(u.text)}`,d&&"below"].filter(b=>b).join(",")}function Nb(t){return[t.color,t.role,t.scale].filter(r=>r).join(",")}function Ib(t){return[t.lineWidth,t.hilite].filter(r=>r).join(",")}function rc(t){let r=0;for(let n=0;n<t.length;n++)r=(r<<5)-r+t.charCodeAt(n)>>>0;return r.toString()}function zb(t,{shape:r,current:n,pendingErase:a,hash:l},f,u,d){const g=ys(ks(be(r.orig),t.orientation),d),v=r.dest?ys(ks(be(r.dest),t.orientation),d):g,m=r.brush&&Wu(f[r.brush],r.modifiers),_=u.get(r.dest),b=[];if(m){const $=mt(nt("g"),{cgHash:l});b.push({el:$}),g[0]!==v[0]||g[1]!==v[1]?$.appendChild(Wb(r,m,g,v,n,Ta(r.dest,u),a)):$.appendChild(Lb(f[r.brush],g,n,d,a))}if(r.label){const $=r.label;$.fill??($.fill=r.brush&&f[r.brush].color);const E=r.brush?void 0:"tr";b.push({el:jb($,l,g,v,_,E),isCustom:!0})}if(r.customSvg){const $=r.customSvg.center??"orig",[E,T]=$==="label"?Vu(g,v,_).map(N=>N-.5):$==="dest"?v:g,z=mt(nt("g"),{transform:`translate(${E},${T})`,cgHash:l});z.innerHTML=`<svg width="1" height="1" viewBox="0 0 100 100">${r.customSvg.html}</svg>`,b.push({el:z,isCustom:!0})}return b}function Lb(t,r,n,a,l){const f=Vb(),u=(a.width+a.height)/(4*Math.max(a.width,a.height));return mt(nt("circle"),{stroke:t.color,"stroke-width":f[n?0:1],fill:"none",opacity:ju(t,n,l),cx:r[0],cy:r[1],r:u-f[1]/2})}function Wb(t,r,n,a,l,f,u){function d(m){const _=Qb(f&&!l),b=a[0]-n[0],$=a[1]-n[1],E=Math.atan2($,b),T=Math.cos(E)*_,z=Math.sin(E)*_,N=Ku(t);return mt(nt("line"),{stroke:m?N.color:r.color,"stroke-width":Gb(r,l)*(m?1.14:1),"stroke-linecap":"round","marker-end":`url(#arrowhead-${m?N.key:r.key})`,opacity:t.modifiers?.hilite&&!u?1:ju(r,l,u),x1:n[0],y1:n[1],x2:a[0]-T,y2:a[1]-z})}if(!t.modifiers?.hilite)return d(!1);const g=mt(nt("g"),{opacity:r.opacity}),v=mt(nt("g"),{filter:"url(#cg-filter-blur)"});return v.appendChild(Yb(n,a)),v.appendChild(d(!0)),g.appendChild(v),g.appendChild(d(!1)),g}function Kb(t){const r=mt(nt("marker"),{id:"arrowhead-"+t.key,orient:"auto",overflow:"visible",markerWidth:4,markerHeight:4,refX:t.key.startsWith("hilite")?1.86:2.05,refY:2});return r.appendChild(mt(nt("path"),{d:"M0,0 V4 L3,2 Z",fill:t.color})),r.setAttribute("cgKey",t.key),r}function jb(t,r,n,a,l,f){const d=.4*.75**t.text.length,g=Vu(n,a,l),v=f==="tr"?.4:0,m=mt(nt("g"),{transform:`translate(${g[0]+v},${g[1]-v})`,cgHash:r});m.appendChild(mt(nt("circle"),{r:.4/2,"fill-opacity":f?1:.8,"stroke-opacity":f?1:.7,"stroke-width":.03,fill:t.fill??"#666",stroke:"white"}));const _=mt(nt("text"),{"font-size":d,"font-family":"Noto Sans","text-anchor":"middle",fill:"white",y:.13*.75**t.text.length});return _.innerHTML=t.text,m.appendChild(_),m}function ks(t,r){return r==="white"?t:[7-t[0],7-t[1]]}function Ta(t,r){return(t&&r.has(t)&&r.get(t).size>1)===!0}function nt(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function mt(t,r){for(const n in r)Object.prototype.hasOwnProperty.call(r,n)&&t.setAttribute(n,r[n]);return t}function Wu(t,r){return r?{color:t.color,opacity:Math.round(t.opacity*10)/10,lineWidth:Math.round(r.lineWidth||t.lineWidth),key:[t.key,r.lineWidth].filter(n=>n).join("")}:t}function Vb(){return[3/64,4/64]}function Gb(t,r){return(t.lineWidth||10)*(r?.85:1)/64}function Ku(t){const r=t.modifiers?.hilite;return{key:r&&`hilite-${r.replace("#","")}`,color:r}}function ju(t,r,n){return(t.opacity||1)*(n?.6:r?.9:1)}function Qb(t){return(t?20:10)/64}function ys(t,r){const n=Math.min(1,r.width/r.height),a=Math.min(1,r.height/r.width);return[(t[0]-3.5)*n,(3.5-t[1])*a]}function Yb(t,r){const n={from:[Math.floor(Math.min(t[0],r[0])),Math.floor(Math.min(t[1],r[1]))],to:[Math.ceil(Math.max(t[0],r[0])),Math.ceil(Math.max(t[1],r[1]))]};return mt(nt("rect"),{x:n.from[0],y:n.from[1],width:n.to[0]-n.from[0],height:n.to[1]-n.from[1],fill:"none",stroke:"none"})}function Sa(t,r,n=!0){const a=Math.atan2(r[1]-t[1],r[0]-t[0])+Math.PI;return n?(Math.round(a*8/Math.PI)+16)%16:a}function Hb(t,r){return Math.sqrt([t[0]-r[0],t[1]-r[1]].reduce((n,a)=>n+a*a,0))}function Vu(t,r,n){let a=Hb(t,r);const l=Sa(t,r,!1);if(n&&(a-=33/64,n.size>1)){a-=10/64;const f=Sa(t,r);(n.has((f+1)%16)||n.has((f+15)%16))&&f&1&&(a-=.4)}return[t[0]-Math.cos(l)*a,t[1]-Math.sin(l)*a].map(f=>f+.5)}function Jb(t,r){t.innerHTML="",t.classList.add("cg-wrap");for(const m of U2)t.classList.toggle("orientation-"+m,r.orientation===m);t.classList.toggle("manipulable",!r.viewOnly);const n=dr("cg-container");t.appendChild(n);const a=dr("cg-board");n.appendChild(a);let l,f,u,d,g;if(r.drawable.visible&&([l,f]=["cg-shapes-below","cg-shapes"].map(m=>nc(m,!0)),[u,d]=["cg-custom-below","cg-custom-svgs"].map(m=>nc(m,!1)),g=dr("cg-auto-pieces"),n.appendChild(l),n.appendChild(u),n.appendChild(f),n.appendChild(d),n.appendChild(g)),r.coordinates){const m=r.orientation==="black"?" black":"",_=r.ranksPosition==="left"?" left":"";if(r.coordinatesOnSquares){const b=r.orientation==="white"?$=>$+1:$=>8-$;As.forEach(($,E)=>n.appendChild(ca(ms.map(T=>$+T),"squares rank"+b(E)+m+_)))}else n.appendChild(ca(ms,"ranks"+m+_)),n.appendChild(ca(As,"files"+m))}let v;return r.draggable.enabled&&r.draggable.showGhost&&(v=dr("piece","ghost"),Ya(v,!1),n.appendChild(v)),{board:a,container:n,wrap:t,ghost:v,shapes:f,shapesBelow:l,custom:d,customBelow:u,autoPieces:g}}function nc(t,r){const n=mt(nt("svg"),{class:t,viewBox:r?"-4 -4 8 8":"-3.5 -3.5 8 8",preserveAspectRatio:"xMidYMid slice"});return r&&n.appendChild(Db()),n.appendChild(nt("g")),n}function ca(t,r){const n=dr("coords",r);let a;for(const l of t)a=dr("coord"),a.textContent=l,n.appendChild(a);return n}function Zb(t,r){if(!t.dropmode.active)return;Nr(t),Ir(t);const n=t.dropmode.piece;if(n){t.pieces.set("a0",n);const a=cn(r),l=a&&un(a,Tt(t),t.dom.bounds());l&&Tu(t,"a0",l)}t.dom.redraw()}function Xb(t,r){const n=t.dom.elements.board;if("ResizeObserver"in window&&new ResizeObserver(r).observe(t.dom.elements.wrap),(t.disableContextMenu||t.drawable.enabled)&&n.addEventListener("contextmenu",l=>l.preventDefault()),t.viewOnly)return;const a=t_(t);n.addEventListener("touchstart",a,{passive:!1}),n.addEventListener("mousedown",a,{passive:!1})}function e_(t,r){const n=[];if("ResizeObserver"in window||n.push(Xn(document.body,"chessground.resize",r)),!t.viewOnly){const a=ic(t,Sb,wb),l=ic(t,Pb,kb);for(const u of["touchmove","mousemove"])n.push(Xn(document,u,a));for(const u of["touchend","mouseup"])n.push(Xn(document,u,l));const f=()=>t.dom.bounds.clear();n.push(Xn(document,"scroll",f,{capture:!0,passive:!0})),n.push(Xn(window,"resize",f,{passive:!0}))}return()=>n.forEach(a=>a())}function Xn(t,r,n,a){return t.addEventListener(r,n,a),()=>t.removeEventListener(r,n,a)}const t_=t=>r=>{t.draggable.current?ws(t):t.drawable.current?Ru(t):r.shiftKey||vu(r)?t.drawable.enabled&&_b(t,r):t.viewOnly||(t.dropmode.active?Zb(t,r):Mb(t,r))},ic=(t,r,n)=>a=>{t.drawable.current?t.drawable.enabled&&n(t,a):t.viewOnly||r(t,a)};function r_(t){const r=Tt(t),n=qi(t.dom.bounds()),a=t.dom.elements.board,l=t.pieces,f=t.animation.current,u=f?f.plan.anims:new Map,d=f?f.plan.fadings:new Map,g=t.draggable.current,v=i_(t),m=new Set,_=new Set,b=new Map,$=new Map;let E,T,z,N,D,F,W,O,p,R;for(T=a.firstChild;T;){if(E=T.cgKey,Gu(T))if(z=l.get(E),D=u.get(E),F=d.get(E),N=T.cgPiece,T.cgDragging&&(!g||g.orig!==E)&&(T.classList.remove("dragging"),er(T,n(be(E),r)),T.cgDragging=!1),!F&&T.cgFading&&(T.cgFading=!1,T.classList.remove("fading")),z){if(D&&T.cgAnimating&&N===ei(z)){const i=be(E);i[0]+=D[2],i[1]+=D[3],T.classList.add("anim"),er(T,n(i,r))}else T.cgAnimating&&(T.cgAnimating=!1,T.classList.remove("anim"),er(T,n(be(E),r)),t.addPieceZIndex&&(T.style.zIndex=ua(be(E),r)));N===ei(z)&&(!F||!T.cgFading)?m.add(E):F&&N===ei(F)?(T.classList.add("fading"),T.cgFading=!0):ha(b,N,T)}else ha(b,N,T);else if(Qu(T)){const i=T.className;v.get(E)===i?_.add(E):ha($,i,T)}T=T.nextSibling}for(const[i,I]of v)if(!_.has(i)){p=$.get(I),R=p&&p.pop();const K=n(be(i),r);if(R)R.cgKey=i,er(R,K);else{const Q=dr("square",I);Q.cgKey=i,er(Q,K),a.insertBefore(Q,a.firstChild)}}for(const[i,I]of l)if(D=u.get(i),!m.has(i))if(W=b.get(ei(I)),O=W&&W.pop(),O){O.cgKey=i,O.cgFading&&(O.classList.remove("fading"),O.cgFading=!1);const K=be(i);t.addPieceZIndex&&(O.style.zIndex=ua(K,r)),D&&(O.cgAnimating=!0,O.classList.add("anim"),K[0]+=D[2],K[1]+=D[3]),er(O,n(K,r))}else{const K=ei(I),Q=dr("piece",K),ie=be(i);Q.cgPiece=K,Q.cgKey=i,D&&(Q.cgAnimating=!0,ie[0]+=D[2],ie[1]+=D[3]),er(Q,n(ie,r)),t.addPieceZIndex&&(Q.style.zIndex=ua(ie,r)),a.appendChild(Q)}for(const i of b.values())ac(t,i);for(const i of $.values())ac(t,i)}function n_(t){const r=Tt(t),n=qi(t.dom.bounds());let a=t.dom.elements.board.firstChild;for(;a;)(Gu(a)&&!a.cgAnimating||Qu(a))&&er(a,n(be(a.cgKey),r)),a=a.nextSibling}function sc(t){const r=t.dom.elements.wrap.getBoundingClientRect(),n=t.dom.elements.container,a=r.height/r.width,l=Math.floor(r.width*window.devicePixelRatio/8)*8/window.devicePixelRatio,f=l*a;n.style.width=l+"px",n.style.height=f+"px",t.dom.bounds.clear(),t.addDimensionsCssVarsTo?.style.setProperty("---cg-width",l+"px"),t.addDimensionsCssVarsTo?.style.setProperty("---cg-height",f+"px")}const Gu=t=>t.tagName==="PIECE",Qu=t=>t.tagName==="SQUARE";function ac(t,r){for(const n of r)t.dom.elements.board.removeChild(n)}function ua(t,r){const a=t[1];return`${r?10-a:3+a}`}const ei=t=>`${t.color} ${t.role}`;function i_(t){const r=new Map;if(t.lastMove&&t.highlight.lastMove)for(const l of t.lastMove)hr(r,l,"last-move");if(t.check&&t.highlight.check&&hr(r,t.check,"check"),t.selected&&(hr(r,t.selected,"selected"),t.movable.showDests)){const l=t.movable.dests?.get(t.selected);if(l)for(const u of l)hr(r,u,"move-dest"+(t.pieces.has(u)?" oc":""));const f=t.premovable.customDests?.get(t.selected)??t.premovable.dests;if(f)for(const u of f)hr(r,u,"premove-dest"+(t.pieces.has(u)?" oc":""))}const n=t.premovable.current;if(n)for(const l of n)hr(r,l,"current-premove");else t.predroppable.current&&hr(r,t.predroppable.current.key,"current-premove");const a=t.exploding;if(a)for(const l of a.keys)hr(r,l,"exploding"+a.stage);return t.highlight.custom&&t.highlight.custom.forEach((l,f)=>{hr(r,f,l)}),r}function hr(t,r,n){const a=t.get(r);a?t.set(r,`${a} ${n}`):t.set(r,n)}function ha(t,r,n){const a=t.get(r);a?a.push(n):t.set(r,[n])}function s_(t,r,n){const a=new Map,l=[];for(const d of t)a.set(d.hash,!1);let f=r.firstElementChild,u;for(;f;)u=f.getAttribute("cgHash"),a.has(u)?a.set(u,!0):l.push(f),f=f.nextElementSibling;for(const d of l)r.removeChild(d);for(const d of t)a.get(d.hash)||r.appendChild(n(d))}function a_(t,r){const a=t.drawable.autoShapes.filter(l=>l.piece).map(l=>({shape:l,hash:f_(l),current:!1,pendingErase:!1}));s_(a,r,l=>l_(t,l,t.dom.bounds()))}function o_(t){const r=Tt(t),n=qi(t.dom.bounds());let a=t.dom.elements.autoPieces?.firstChild;for(;a;)du(a,n(be(a.cgKey),r),a.cgScale),a=a.nextSibling}function l_(t,{shape:r,hash:n},a){const l=r.orig,f=r.piece?.role,u=r.piece?.color,d=r.piece?.scale,g=dr("piece",`${f} ${u}`);return g.setAttribute("cgHash",n),g.cgKey=l,g.cgScale=d,du(g,qi(a)(be(l),Tt(t)),d),g}const f_=t=>[t.orig,t.piece?.role,t.piece?.color,t.piece?.scale].join(",");function c_(t,r){const n=Fb();Du(n,r||{});function a(){const l="dom"in n?n.dom.unbind:void 0,f=Jb(t,n),u=pu(()=>f.board.getBoundingClientRect()),d=m=>{r_(v),f.autoPieces&&a_(v,f.autoPieces),!m&&f.shapes&&Ob(v,f)},g=()=>{sc(v),n_(v),f.autoPieces&&o_(v)},v=n;return v.dom={elements:f,bounds:u,redraw:u_(d),redrawNow:d,unbind:l},v.drawable.prevSvgHash="",sc(v),d(!1),Xb(v,g),l||(v.dom.unbind=e_(v,g)),v.events.insert&&v.events.insert(f),v}return xb(a(),a)}function u_(t){let r=!1;return()=>{r||(r=!0,requestAnimationFrame(()=>{t(),r=!1}))}}var ni={exports:{}},h_=ni.exports,oc;function p_(){return oc||(oc=1,(function(t,r){(function(n,a){a(r)})(h_,(function(n){function a(N){return N&&N.__esModule&&Object.prototype.hasOwnProperty.call(N,"default")?N.default:N}var l={exports:{}},f=l.exports,u;function d(){return u||(u=1,(function(N){(function(D,F){N.exports&&(N.exports=F())})(f,function(){function D(p,R){function i(){this.constructor=p}i.prototype=R.prototype,p.prototype=new i}function F(p,R,i,I){var K=Error.call(this,p);return Object.setPrototypeOf&&Object.setPrototypeOf(K,F.prototype),K.expected=R,K.found=i,K.location=I,K.name="SyntaxError",K}D(F,Error);function W(p,R,i){return i=i||" ",p.length>R?p:(R-=p.length,i+=i.repeat(R),p+i.slice(0,R))}F.prototype.format=function(p){var R="Error: "+this.message;if(this.location){var i=null,I;for(I=0;I<p.length;I++)if(p[I].source===this.location.source){i=p[I].text.split(/\r\n|\n|\r/g);break}var K=this.location.start,Q=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(K):K,ie=this.location.source+":"+Q.line+":"+Q.column;if(i){var G=this.location.end,ue=W("",Q.line.toString().length," "),oe=i[K.line-1],fe=K.line===G.line?G.column:oe.length+1,$e=fe-K.column||1;R+=`
 --> `+ie+`
`+ue+` |
`+Q.line+" | "+oe+`
`+ue+" | "+W("",K.column-1," ")+W("",$e,"^")}else R+=`
 at `+ie}return R},F.buildMessage=function(p,R){var i={literal:function(oe){return'"'+K(oe.text)+'"'},class:function(oe){var fe=oe.parts.map(function($e){return Array.isArray($e)?Q($e[0])+"-"+Q($e[1]):Q($e)});return"["+(oe.inverted?"^":"")+fe.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(oe){return oe.description}};function I(oe){return oe.charCodeAt(0).toString(16).toUpperCase()}function K(oe){return oe.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(fe){return"\\x0"+I(fe)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(fe){return"\\x"+I(fe)})}function Q(oe){return oe.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(fe){return"\\x0"+I(fe)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(fe){return"\\x"+I(fe)})}function ie(oe){return i[oe.type](oe)}function G(oe){var fe=oe.map(ie),$e,He;if(fe.sort(),fe.length>0){for($e=1,He=1;$e<fe.length;$e++)fe[$e-1]!==fe[$e]&&(fe[He]=fe[$e],He++);fe.length=He}switch(fe.length){case 1:return fe[0];case 2:return fe[0]+" or "+fe[1];default:return fe.slice(0,-1).join(", ")+", or "+fe[fe.length-1]}}function ue(oe){return oe?'"'+K(oe)+'"':"end of input"}return"Expected "+G(p)+" but "+ue(R)+" found."};function O(p,R){R=R!==void 0?R:{};var i={},I=R.grammarSource,K={pgn:Hn,tags:Hl,game:es,games:UA},Q=Hn,ie="\uFEFF",G="Event",ue="event",oe="Site",fe="site",$e="Date",He="date",it="Round",Nt="round",lr="White",_r="white",Yt="Black",St="black",de="Result",Oe="result",Fe="WhiteTitle",ht="Whitetitle",De="whitetitle",Ee="whiteTitle",Je="BlackTitle",Ke="Blacktitle",Ie="blacktitle",Te="blackTitle",ge="WhiteELO",we="WhiteElo",Se="Whiteelo",Ue="whiteelo",pt="whiteElo",Re="BlackELO",je="BlackElo",st="Blackelo",dt="blackelo",bt="blackElo",at="WhiteUSCF",Be="WhiteUscf",ze="Whiteuscf",_t="whiteuscf",fr="whiteUscf",Ht="BlackUSCF",Jt="BlackUscf",cr="Blackuscf",zr="blackuscf",hn="blackUscf",Ai="WhiteNA",mi="WhiteNa",Nn="Whitena",bi="whitena",_i="whiteNa",wi="whiteNA",ki="BlackNA",yi="BlackNa",$i="Blackna",Ci="blackna",Mi="blackNA",Ei="blackNa",Ti="WhiteType",Si="Whitetype",S="whitetype",ur="whiteType",wt="BlackType",Lr="Blacktype",j="blacktype",wr="blackType",Ne="EventDate",Pt="Eventdate",Pi="eventdate",vt="eventDate",In="EventSponsor",zn="Eventsponsor",Z="eventsponsor",Bi="eventSponsor",Ln="Section",xi="section",Wn="Stage",Fi="stage",Di="Board",Oi="board",Kn="Opening",jn="opening",Ui="Variation",Ri="variation",Ni="SubVariation",Vn="Subvariation",pn="subvariation",Ii="subVariation",zi="ECO",Gn="Eco",Li="eco",Ze="NIC",M="Nic",P="nic",B="Time",X="time",ne="UTCTime",me="UTCtime",Zt="UtcTime",Wr="Utctime",fo="utctime",co="utcTime",uo="UTCDate",ho="UTCdate",po="UtcDate",vo="Utcdate",go="utcdate",qo="utcDate",Ao="TimeControl",mo="Timecontrol",bo="timecontrol",_o="timeControl",wo="SetUp",ko="Setup",yo="setup",$o="setUp",Co="FEN",Mo="Fen",Eo="fen",To="Termination",So="termination",Po="Annotator",Bo="annotator",xo="Mode",Fo="mode",Do="PlyCount",Oo="Plycount",Uo="plycount",Ro="plyCount",No="Variant",Io="variant",zo="WhiteRatingDiff",Lo="BlackRatingDiff",Wo="WhiteFideId",Ko="BlackFideId",jo="WhiteTeam",Vo="BlackTeam",Go="Clock",Qo="WhiteClock",Yo="BlackClock",Wi='"',Ho="\\",Ki=".",dn=":",Us="/",Jo="?",ji="-",Rs="+",Zo="*",Xo="1-0",el="0-1",tl="1/2-1/2",rl="1/2",nl="=",il="%csl",sl="%cal",Ns="%",al="%eval",ol="[%",ll="}",Vi=",",rh="Y",nh="G",ih="R",sh="B",ah="O",oh="C",lh="{",fh="[",ch="]",uh=";",fl="clk",cl="egt",ul="emt",hl="mct",hh="(",ph=")",pl=" ",dh="e.p.",dl="O-O-O",vl="O-O",vh="@",gl="Z0",Gi="+-",ql="$$$",gh="#",qh="$",Al="!!",ml="??",bl="!?",_l="?!",Ah="!",mh="â¼",bh="â",_h="â",wh="â",kh="â¡",yh="â",$h="â©²",Ch="â©±",Mh="Â±",Eh="â",wl="-+",Th="â¨",Sh="â³",Ph="â",Bh="â",xh="â",Fh="D",Dh="x",vn=/^[ \t\n\r]/,kl=/^[\n\r]/,yl=/^[\-a-zA-Z0-9_.]/,Oh=/^[^"\\\r\n]/,kr=/^[0-9?]/,Bt=/^[0-9]/,Uh=/^[BNW]/,$l=/^[^\n\r]/,Rh=/^[1-8a-h]/,Nh=/^[RNBQKP]/,Ih=/^[RNBQ]/,zh=/^[a-h]/,Lh=/^[1-8]/,Wh=/^[\-x]/,Kh=k("\uFEFF",!1),jh=k("Event",!1),Vh=k("event",!1),Gh=k("Site",!1),Qh=k("site",!1),Yh=k("Date",!1),Hh=k("date",!1),Jh=k("Round",!1),Zh=k("round",!1),Xh=k("White",!1),ep=k("white",!1),tp=k("Black",!1),rp=k("black",!1),np=k("Result",!1),ip=k("result",!1),sp=k("WhiteTitle",!1),ap=k("Whitetitle",!1),op=k("whitetitle",!1),lp=k("whiteTitle",!1),fp=k("BlackTitle",!1),cp=k("Blacktitle",!1),up=k("blacktitle",!1),hp=k("blackTitle",!1),pp=k("WhiteELO",!1),dp=k("WhiteElo",!1),vp=k("Whiteelo",!1),gp=k("whiteelo",!1),qp=k("whiteElo",!1),Ap=k("BlackELO",!1),mp=k("BlackElo",!1),bp=k("Blackelo",!1),_p=k("blackelo",!1),wp=k("blackElo",!1),kp=k("WhiteUSCF",!1),yp=k("WhiteUscf",!1),$p=k("Whiteuscf",!1),Cp=k("whiteuscf",!1),Mp=k("whiteUscf",!1),Ep=k("BlackUSCF",!1),Tp=k("BlackUscf",!1),Sp=k("Blackuscf",!1),Pp=k("blackuscf",!1),Bp=k("blackUscf",!1),xp=k("WhiteNA",!1),Fp=k("WhiteNa",!1),Dp=k("Whitena",!1),Op=k("whitena",!1),Up=k("whiteNa",!1),Rp=k("whiteNA",!1),Np=k("BlackNA",!1),Ip=k("BlackNa",!1),zp=k("Blackna",!1),Lp=k("blackna",!1),Wp=k("blackNA",!1),Kp=k("blackNa",!1),jp=k("WhiteType",!1),Vp=k("Whitetype",!1),Gp=k("whitetype",!1),Qp=k("whiteType",!1),Yp=k("BlackType",!1),Hp=k("Blacktype",!1),Jp=k("blacktype",!1),Zp=k("blackType",!1),Xp=k("EventDate",!1),ed=k("Eventdate",!1),td=k("eventdate",!1),rd=k("eventDate",!1),nd=k("EventSponsor",!1),id=k("Eventsponsor",!1),sd=k("eventsponsor",!1),ad=k("eventSponsor",!1),od=k("Section",!1),ld=k("section",!1),fd=k("Stage",!1),cd=k("stage",!1),ud=k("Board",!1),hd=k("board",!1),pd=k("Opening",!1),dd=k("opening",!1),vd=k("Variation",!1),gd=k("variation",!1),qd=k("SubVariation",!1),Ad=k("Subvariation",!1),md=k("subvariation",!1),bd=k("subVariation",!1),_d=k("ECO",!1),wd=k("Eco",!1),kd=k("eco",!1),yd=k("NIC",!1),$d=k("Nic",!1),Cd=k("nic",!1),Md=k("Time",!1),Ed=k("time",!1),Td=k("UTCTime",!1),Sd=k("UTCtime",!1),Pd=k("UtcTime",!1),Bd=k("Utctime",!1),xd=k("utctime",!1),Fd=k("utcTime",!1),Dd=k("UTCDate",!1),Od=k("UTCdate",!1),Ud=k("UtcDate",!1),Rd=k("Utcdate",!1),Nd=k("utcdate",!1),Id=k("utcDate",!1),zd=k("TimeControl",!1),Ld=k("Timecontrol",!1),Wd=k("timecontrol",!1),Kd=k("timeControl",!1),jd=k("SetUp",!1),Vd=k("Setup",!1),Gd=k("setup",!1),Qd=k("setUp",!1),Yd=k("FEN",!1),Hd=k("Fen",!1),Jd=k("fen",!1),Zd=k("Termination",!1),Xd=k("termination",!1),ev=k("Annotator",!1),tv=k("annotator",!1),rv=k("Mode",!1),nv=k("mode",!1),iv=k("PlyCount",!1),sv=k("Plycount",!1),av=k("plycount",!1),ov=k("plyCount",!1),lv=k("Variant",!1),fv=k("variant",!1),cv=k("WhiteRatingDiff",!1),uv=k("BlackRatingDiff",!1),hv=k("WhiteFideId",!1),pv=k("BlackFideId",!1),dv=k("WhiteTeam",!1),vv=k("BlackTeam",!1),gv=k("Clock",!1),qv=k("WhiteClock",!1),Av=k("BlackClock",!1),Cl=Ql("whitespace"),gn=kt([" ","	",`
`,"\r"],!1,!1),Ml=kt([`
`,"\r"],!1,!1),El=kt(["-",["a","z"],["A","Z"],["0","9"],"_","."],!1,!1),Qi=k('"',!1),mv=kt(['"',"\\","\r",`
`],!0,!1),Tl=k("\\",!1),yr=kt([["0","9"],"?"],!1,!1),Yi=k(".",!1),xt=kt([["0","9"]],!1,!1),qn=k(":",!1),Is=k("/",!1),bv=kt(["B","N","W"],!1,!1),Sl=k("?",!1),Hi=k("-",!1),zs=k("+",!1),Pl=k("*",!1),_v=k("1-0",!1),wv=k("0-1",!1),kv=k("1/2-1/2",!1),yv=k("1/2",!1),Ls=k("=",!1),$v=k("%csl",!1),Cv=k("%cal",!1),Ws=k("%",!1),Mv=k("%eval",!1),Ev=k("[%",!1),Bl=k("}",!1),xl=FA(),Fl=kt([`
`,"\r"],!0,!1),Ji=k(",",!1),Tv=k("Y",!1),Sv=k("G",!1),Pv=k("R",!1),Bv=k("B",!1),xv=k("O",!1),Fv=k("C",!1),Dv=k("{",!1),Ov=k("[",!1),Uv=k("]",!1),Rv=k(";",!1),Nv=k("clk",!1),Iv=k("egt",!1),zv=k("emt",!1),Lv=k("mct",!1),Wv=k("(",!1),Kv=k(")",!1),jv=Ql("integer"),Dl=k(" ",!1),Vv=k("e.p.",!1),Gv=k("O-O-O",!1),Qv=k("O-O",!1),Yv=k("@",!1),Hv=k("Z0",!1),Ol=k("+-",!1),Jv=k("$$$",!1),Zv=k("#",!1),Xv=k("$",!1),eg=k("!!",!1),tg=k("??",!1),rg=k("!?",!1),ng=k("?!",!1),ig=k("!",!1),sg=k("â¼",!1),ag=k("â",!1),og=k("â",!1),lg=k("â",!1),fg=k("â¡",!1),cg=k("â",!1),ug=k("â©²",!1),hg=k("â©±",!1),pg=k("Â±",!1),dg=k("â",!1),vg=k("-+",!1),gg=k("â¨",!1),qg=k("â³",!1),Ag=k("â",!1),mg=k("â",!1),bg=k("â",!1),_g=k("D",!1),wg=kt([["1","8"],["a","h"]],!1,!1),kg=kt(["R","N","B","Q","K","P"],!1,!1),yg=kt(["R","N","B","Q"],!1,!1),$g=kt([["a","h"]],!1,!1),Cg=kt([["1","8"]],!1,!1),Mg=k("x",!1),Eg=kt(["-","x"],!1,!1),Ul=function(e,o){return o},Tg=function(e,o){return[e].concat(o)},Sg=function(e){return e},Pg=function(e,o,h){var c=ss;return ss=[],{tags:e,gameComment:o,moves:h,messages:c}},Rl=function(e,o){return o},Bg=function(e,o){var h={};return[e].concat(o).forEach(function(c){h[c.name]=c.value}),h},xg=function(e){return e===null?{}:(e.messages=ss,e)},Fg=function(e){return e},Dg=function(e){return{name:"Event",value:e}},Og=function(e){return{name:"Site",value:e}},Ug=function(e){return{name:"Date",value:e}},Rg=function(e){return{name:"Round",value:e}},Ng=function(e){return{name:"WhiteTitle",value:e}},Ig=function(e){return{name:"BlackTitle",value:e}},zg=function(e){return{name:"WhiteElo",value:e}},Lg=function(e){return{name:"BlackElo",value:e}},Wg=function(e){return{name:"WhiteUSCF",value:e}},Kg=function(e){return{name:"BlackUSCF",value:e}},jg=function(e){return{name:"WhiteNA",value:e}},Vg=function(e){return{name:"BlackNA",value:e}},Gg=function(e){return{name:"WhiteType",value:e}},Qg=function(e){return{name:"BlackType",value:e}},Yg=function(e){return{name:"White",value:e}},Hg=function(e){return{name:"Black",value:e}},Jg=function(e){return{name:"Result",value:e}},Zg=function(e){return{name:"EventDate",value:e}},Xg=function(e){return{name:"EventSponsor",value:e}},eq=function(e){return{name:"Section",value:e}},tq=function(e){return{name:"Stage",value:e}},rq=function(e){return{name:"Board",value:e}},nq=function(e){return{name:"Opening",value:e}},iq=function(e){return{name:"Variation",value:e}},sq=function(e){return{name:"SubVariation",value:e}},aq=function(e){return{name:"ECO",value:e}},oq=function(e){return{name:"NIC",value:e}},lq=function(e){return{name:"Time",value:e}},fq=function(e){return{name:"UTCTime",value:e}},cq=function(e){return{name:"UTCDate",value:e}},uq=function(e){return{name:"TimeControl",value:e}},hq=function(e){return{name:"SetUp",value:e}},pq=function(e){return{name:"FEN",value:e}},dq=function(e){return{name:"Termination",value:e}},vq=function(e){return{name:"Annotator",value:e}},gq=function(e){return{name:"Mode",value:e}},qq=function(e){return{name:"PlyCount",value:e}},Aq=function(e){return{name:"Variant",value:e}},mq=function(e){return{name:"WhiteRatingDiff",value:e}},bq=function(e){return{name:"BlackRatingDiff",value:e}},_q=function(e){return{name:"WhiteFideId",value:e}},wq=function(e){return{name:"BlackFideId",value:e}},kq=function(e){return{name:"WhiteTeam",value:e}},yq=function(e){return{name:"BlackTeam",value:e}},$q=function(e){return{name:"Clock",value:e}},Cq=function(e){return{name:"WhiteClock",value:e}},Mq=function(e){return{name:"BlackClock",value:e}},Eq=function(e,o){return yt({key:e,value:o,message:`Format of tag: "${e}" not correct: "${o}"`}),{name:e,value:o}},Tq=function(e,o){return yt({key:e,value:o,message:`Tag: "${e}" not known: "${o}"`}),{name:e,value:o}},Sq=function(e){return e.join("")},Pq=function(e){return e.map(o=>o.char||o).join("")},Bq=function(){return{type:"char",char:"\\"}},xq=function(){return{type:"char",char:'"'}},Fq=function(e){return e},Dq=function(e,o,h){return{value:""+e.join("")+"."+o.join("")+"."+h.join(""),year:Gr(e),month:Gr(o),day:Gr(h)}},Oq=function(e,o,h,c){let y=e.join("")+":"+o.join("")+":"+h.join(""),x=0;return c&&(y=y+"."+c,yt({message:`Unusual use of millis in time: ${y}`}),Gr(c)),{value:y,hour:Gr(e),minute:Gr(o),second:Gr(h),millis:x}},Uq=function(e){return e.join("")},Rq=function(e){return e},Nq=function(e,o){return e+"/"+o},Iq=function(e){return e},zq=function(e){return e},Lq=function(e){return e||(yt({message:"Tag TimeControl has to have a value"}),"")},Nl=function(e,o){return o},Wq=function(e,o){let h=[e].concat(o);return h.value=h.map(c=>c.value).join(":"),h},Kq=function(e){return e},jq=function(){return{kind:"unknown",value:"?"}},Vq=function(){return{kind:"unlimited",value:"-"}},Gq=function(e,o,h){return{kind:"movesInSecondsIncrement",moves:e,seconds:o,increment:h,value:""+e+"/"+o+"+"+h}},Qq=function(e,o){return{kind:"movesInSeconds",moves:e,seconds:o,value:""+e+"/"+o}},Yq=function(e,o){return{kind:"increment",seconds:e,increment:o,value:""+e+"+"+o}},Hq=function(e){return{kind:"suddenDeath",seconds:e,value:""+e}},Jq=function(e){return{kind:"hourglass",seconds:e,value:"*"+e}},Zq=function(e){return e},Xq=function(e){return e},e0=function(e){return e},t0=function(e){return e},r0=function(){return"1/2-1/2"},n0=function(e){return e},i0=function(e){return e},s0=function(){return 0},a0=function(){return yt({message:'Use "-" for an unknown value'}),0},o0=function(e){return ta(e)},l0=function(e,o,h,c,y,x,U,V){var pe=V||[],Ce={};return Ce.moveNumber=o,Ce.notation=h,x&&(Ce.commentAfter=x.comment),e&&(Ce.commentMove=e.comment),y&&(Ce.drawOffer=!0),Ce.variations=U||[],Ce.nag=c||null,pe.unshift(Ce),Ce.commentDiag=x,pe},f0=function(e){return e},c0=function(e){return[e]},Il=function(e,o){return o},u0=function(e,o){return Mr([e].concat(o))},h0=function(){},p0=function(e){return e},d0=function(e){return{comment:e}},zl=function(e,o){return o},v0=function(e,o){return Mr([{colorFields:e}].concat(o[0]))},Ll=function(e,o){return o},g0=function(e,o){return Mr([{colorArrows:e}].concat(o[0]))},Wl=function(e,o,h){return h},q0=function(e,o,h){var c={};return c[e]=o,Mr([c].concat(h[0]))},Kl=function(e,o,h){return h},A0=function(e,o,h){var c={};return c[e]=o,Mr([c].concat(h[0]))},jl=function(e,o){return o},m0=function(e,o){var h={};return h.eval=parseFloat(e),Mr([h].concat(o[0]))},Vl=function(e,o,h){return h},b0=function(e,o,h){var c={};return c[e]=o.join(""),Mr([c].concat(h[0]))},Gl=function(e,o){return o},_0=function(e,o){return o.length>0?Mr([{comment:Of(e.join(""))}].concat(Df(o[0]))):{comment:e.join("")}},w0=function(e){return e},k0=function(e){return e},y0=function(e){return e.join("")},$0=function(e,o){var h=[];h.push(e);for(var c=0;c<o.length;c++)h.push(o[c][2]);return h},C0=function(e,o){return e+o},M0=function(e,o){var h=[];h.push(e);for(var c=0;c<o.length;c++)h.push(o[c][2]);return h},E0=function(e,o,h){return e+o+h},T0=function(){return"Y"},S0=function(){return"G"},P0=function(){return"R"},B0=function(){return"B"},x0=function(){return"O"},F0=function(){return"C"},D0=function(e,o){return e+o},O0=function(){return"clk"},U0=function(){return"egt"},R0=function(){return"emt"},N0=function(){return"mct"},I0=function(e,o,h,c){let y=o;return e?y=e+y:yt({message:"Hours and minutes missing"}),e&&(e.match(/:/g)||[]).length==2&&e.search(":")==2&&yt({message:"Only 1 digit for hours normally used"}),h?y+=h:yt({message:"Only 2 digit for seconds normally used"}),c&&(yt({message:"Unusual use of millis in clock value"}),y+="."+c),y},z0=function(e,o,h){let c=o;return e?c=e+c:yt({message:"Hours and minutes missing"}),e&&(e.match(/:/g)||[]).length==2&&e.search(":")==1&&yt({message:"Only 2 digits for hours normally used"}),h?c+=h:yt({message:"Only 2 digit for seconds normally used"}),c},L0=function(e,o){return o?e+o:(yt({message:"No hours found"}),e)},W0=function(e,o){let h=e;return o?h+=o+":":h+=":",h},K0=function(e,o){let h=e;return o?h+=o+":":(h+=":",yt({message:"Only 2 digits for minutes normally used"})),h},j0=function(e){return e},V0=function(e,o){var h=o||[];return h.unshift(e),h},G0=function(e){return e},Q0=function(e){return ta(e)},Y0=function(){return""},H0=function(e,o,h,c,y,x,U){var V={};return V.fig=e||null,V.disc=o||null,V.strike=h||null,V.col=c,V.row=y,V.check=U||null,V.promotion=x,V.notation=(e||"")+(o||"")+(h||"")+c+y+(x||"")+(U||""),V},J0=function(e,o,h,c,y,x,U,V){var pe={};return pe.fig=e||null,pe.strike=c=="x"?c:null,pe.col=y,pe.row=x,pe.notation=(e&&e!=="P"?e:"")+o+h+(c=="x"?c:"-")+y+x+(U||"")+(V||""),pe.check=V||null,pe.promotion=U,pe},Z0=function(e,o,h,c,y,x){var U={};return U.fig=e||null,U.strike=o||null,U.col=h,U.row=c,U.check=x||null,U.promotion=y,U.notation=(e||"")+(o||"")+h+c+(y||"")+(x||""),U},X0=function(e){var o={};return o.notation="O-O-O"+(e||""),o.check=e||null,o},eA=function(e){var o={};return o.notation="O-O"+(e||""),o.check=e||null,o},tA=function(e,o,h){var c={};return c.fig=e,c.drop=!0,c.col=o,c.row=h,c.notation=e+"@"+o+h,c},rA=function(){var e={};return e.notation="Z0",e},nA=function(e){return e[1]},iA=function(e){return e[1]},sA=function(e){return"="+e},aA=function(e,o){var h=o||[];return h.unshift(e),h},oA=function(e){return"$"+e},lA=function(){return"$3"},fA=function(){return"$4"},cA=function(){return"$5"},uA=function(){return"$6"},hA=function(){return"$1"},pA=function(){return"$2"},dA=function(){return"$3"},vA=function(){return"$4"},gA=function(){return"$5"},qA=function(){return"$6"},AA=function(){return"$7"},mA=function(){return"$10"},bA=function(){return"$13"},_A=function(){return"$14"},wA=function(){return"$15"},kA=function(){return"$16"},yA=function(){return"$17"},$A=function(){return"$18"},CA=function(){return"$19"},MA=function(){return"$22"},EA=function(){return"$32"},TA=function(){return"$36"},SA=function(){return"$40"},PA=function(){return"$132"},BA=function(){return"$220"},s=R.peg$currPos|0,C=s,An=[{line:1,column:1}],Lt=s,Zi=R.peg$maxFailExpected||[],q=R.peg$silentFails|0,Qn;if(R.startRule){if(!(R.startRule in K))throw new Error(`Can't start parsing from rule "`+R.startRule+'".');Q=K[R.startRule]}function xA(){return Ks(C,s)}function k(e,o){return{type:"literal",text:e,ignoreCase:o}}function kt(e,o,h){return{type:"class",parts:e,inverted:o,ignoreCase:h}}function FA(){return{type:"any"}}function DA(){return{type:"end"}}function Ql(e){return{type:"other",description:e}}function Yl(e){var o=An[e],h;if(o)return o;if(e>=An.length)h=An.length-1;else for(h=e;!An[--h];);for(o=An[h],o={line:o.line,column:o.column};h<e;)p.charCodeAt(h)===10?(o.line++,o.column=1):o.column++,h++;return An[e]=o,o}function Ks(e,o,h){var c=Yl(e),y=Yl(o),x={source:I,start:{offset:e,line:c.line,column:c.column},end:{offset:o,line:y.line,column:y.column}};return x}function A(e){s<Lt||(s>Lt&&(Lt=s,Zi=[]),Zi.push(e))}function OA(e,o,h){return new F(F.buildMessage(e,o),e,o,h)}function Xi(){var e;return p.charCodeAt(s)===65279?(e=ie,s++):(e=i,q===0&&A(Kh)),e}function UA(){var e,o,h,c,y,x;if(e=s,Xi(),L(),o=s,h=es(),h!==i){for(c=[],y=s,L(),x=es(),x!==i?(C=y,y=Ul(h,x)):(s=y,y=i);y!==i;)c.push(y),y=s,L(),x=es(),x!==i?(C=y,y=Ul(h,x)):(s=y,y=i);C=o,o=Tg(h,c)}else s=o,o=i;return o===i&&(o=null),C=e,e=Sg(o),e}function es(){var e,o,h,c;return e=s,Xi(),o=Hl(),h=Qs(),h===i&&(h=null),c=Hn(),c!==i?(C=e,e=Pg(o,h,c)):(s=e,e=i),e}function Hl(){var e,o,h,c,y,x;if(e=s,Xi(),L(),o=s,h=js(),h!==i){for(c=[],y=s,L(),x=js(),x!==i?(C=y,y=Rl(h,x)):(s=y,y=i);y!==i;)c.push(y),y=s,L(),x=js(),x!==i?(C=y,y=Rl(h,x)):(s=y,y=i);C=o,o=Bg(h,c)}else s=o,o=i;return o===i&&(o=null),h=L(),C=e,e=xg(o),e}function js(){var e,o,h,c;return e=s,o=Kr(),o!==i?(L(),h=RA(),h!==i?(L(),c=$r(),c!==i?(C=e,e=Fg(h)):(s=e,e=i)):(s=e,e=i)):(s=e,e=i),e}function RA(){var e,o,h,c,y;return e=s,o=NA(),o!==i?(h=L(),c=qe(),c!==i?(C=e,e=Dg(c)):(s=e,e=i)):(s=e,e=i),e===i&&(e=s,o=IA(),o!==i?(h=L(),c=qe(),c!==i?(C=e,e=Og(c)):(s=e,e=i)):(s=e,e=i),e===i&&(e=s,o=Zl(),o!==i?(h=L(),c=Vs(),c!==i?(C=e,e=Ug(c)):(s=e,e=i)):(s=e,e=i),e===i&&(e=s,o=zA(),o!==i?(h=L(),c=qe(),c!==i?(C=e,e=Rg(c)):(s=e,e=i)):(s=e,e=i),e===i&&(e=s,o=KA(),o!==i?(h=L(),c=qe(),c!==i?(C=e,e=Ng(c)):(s=e,e=i)):(s=e,e=i),e===i&&(e=s,o=jA(),o!==i?(h=L(),c=qe(),c!==i?(C=e,e=Ig(c)):(s=e,e=i)):(s=e,e=i),e===i&&(e=s,o=ef(),o!==i?(h=L(),c=wf(),c!==i?(C=e,e=zg(c)):(s=e,e=i)):(s=e,e=i),e===i&&(e=s,o=tf(),o!==i?(h=L(),c=wf(),c!==i?(C=e,e=Lg(c)):(s=e,e=i)):(s=e,e=i),e===i&&(e=s,o=rf(),o!==i?(h=L(),c=Yn(),c!==i?(C=e,e=Wg(c)):(s=e,e=i)):(s=e,e=i),e===i&&(e=s,o=nf(),o!==i?(h=L(),c=Yn(),c!==i?(C=e,e=Kg(c)):(s=e,e=i)):(s=e,e=i),e===i&&(e=s,o=VA(),o!==i?(h=L(),c=qe(),c!==i?(C=e,e=jg(c)):(s=e,e=i)):(s=e,e=i),e===i&&(e=s,o=GA(),o!==i?(h=L(),c=qe(),c!==i?(C=e,e=Vg(c)):(s=e,e=i)):(s=e,e=i),e===i&&(e=s,o=QA(),o!==i?(h=L(),c=qe(),c!==i?(C=e,e=Gg(c)):(s=e,e=i)):(s=e,e=i),e===i&&(e=s,o=YA(),o!==i?(h=L(),c=qe(),c!==i?(C=e,e=Qg(c)):(s=e,e=i)):(s=e,e=i),e===i&&(e=s,o=LA(),o!==i?(h=L(),c=qe(),c!==i?(C=e,e=Yg(c)):(s=e,e=i)):(s=e,e=i),e===i&&(e=s,o=WA(),o!==i?(h=L(),c=qe(),c!==i?(C=e,e=Hg(c)):(s=e,e=i)):(s=e,e=i),e===i&&(e=s,o=Xl(),o!==i?(h=L(),c=k1(),c!==i?(C=e,e=Jg(c)):(s=e,e=i)):(s=e,e=i),e===i&&(e=s,o=sf(),o!==i?(h=L(),c=Vs(),c!==i?(C=e,e=Zg(c)):(s=e,e=i)):(s=e,e=i),e===i&&(e=s,o=HA(),o!==i?(h=L(),c=qe(),c!==i?(C=e,e=Xg(c)):(s=e,e=i)):(s=e,e=i),e===i&&(e=s,o=JA(),o!==i?(h=L(),c=qe(),c!==i?(C=e,e=eq(c)):(s=e,e=i)):(s=e,e=i),e===i&&(e=s,o=ZA(),o!==i?(h=L(),c=qe(),c!==i?(C=e,e=tq(c)):(s=e,e=i)):(s=e,e=i),e===i&&(e=s,o=af(),o!==i?(h=L(),c=Yn(),c!==i?(C=e,e=rq(c)):(s=e,e=i)):(s=e,e=i),e===i&&(e=s,o=XA(),o!==i?(h=L(),c=qe(),c!==i?(C=e,e=nq(c)):(s=e,e=i)):(s=e,e=i),e===i&&(e=s,o=e1(),o!==i?(h=L(),c=qe(),c!==i?(C=e,e=iq(c)):(s=e,e=i)):(s=e,e=i),e===i&&(e=s,o=t1(),o!==i?(h=L(),c=qe(),c!==i?(C=e,e=sq(c)):(s=e,e=i)):(s=e,e=i),e===i&&(e=s,o=r1(),o!==i?(h=L(),c=qe(),c!==i?(C=e,e=aq(c)):(s=e,e=i)):(s=e,e=i),e===i&&(e=s,o=n1(),o!==i?(h=L(),c=qe(),c!==i?(C=e,e=oq(c)):(s=e,e=i)):(s=e,e=i),e===i&&(e=s,o=of(),o!==i?(h=L(),c=qf(),c!==i?(C=e,e=lq(c)):(s=e,e=i)):(s=e,e=i),e===i&&(e=s,o=lf(),o!==i?(h=L(),c=qf(),c!==i?(C=e,e=fq(c)):(s=e,e=i)):(s=e,e=i),e===i&&(e=s,o=ff(),o!==i?(h=L(),c=Vs(),c!==i?(C=e,e=cq(c)):(s=e,e=i)):(s=e,e=i),e===i&&(e=s,o=cf(),o!==i?(h=L(),c=_1(),c!==i?(C=e,e=uq(c)):(s=e,e=i)):(s=e,e=i),e===i&&(e=s,o=i1(),o!==i?(h=L(),c=qe(),c!==i?(C=e,e=hq(c)):(s=e,e=i)):(s=e,e=i),e===i&&(e=s,o=s1(),o!==i?(h=L(),c=qe(),c!==i?(C=e,e=pq(c)):(s=e,e=i)):(s=e,e=i),e===i&&(e=s,o=a1(),o!==i?(h=L(),c=qe(),c!==i?(C=e,e=dq(c)):(s=e,e=i)):(s=e,e=i),e===i&&(e=s,o=o1(),o!==i?(h=L(),c=qe(),c!==i?(C=e,e=vq(c)):(s=e,e=i)):(s=e,e=i),e===i&&(e=s,o=l1(),o!==i?(h=L(),c=qe(),c!==i?(C=e,e=gq(c)):(s=e,e=i)):(s=e,e=i),e===i&&(e=s,o=uf(),o!==i?(h=L(),c=Yn(),c!==i?(C=e,e=qq(c)):(s=e,e=i)):(s=e,e=i),e===i&&(e=s,o=f1(),o!==i?(h=L(),c=qe(),c!==i?(C=e,e=Aq(c)):(s=e,e=i)):(s=e,e=i),e===i&&(e=s,o=c1(),o!==i?(h=L(),c=qe(),c!==i?(C=e,e=mq(c)):(s=e,e=i)):(s=e,e=i),e===i&&(e=s,o=u1(),o!==i?(h=L(),c=qe(),c!==i?(C=e,e=bq(c)):(s=e,e=i)):(s=e,e=i),e===i&&(e=s,o=h1(),o!==i?(h=L(),c=qe(),c!==i?(C=e,e=_q(c)):(s=e,e=i)):(s=e,e=i),e===i&&(e=s,o=p1(),o!==i?(h=L(),c=qe(),c!==i?(C=e,e=wq(c)):(s=e,e=i)):(s=e,e=i),e===i&&(e=s,o=d1(),o!==i?(h=L(),c=qe(),c!==i?(C=e,e=kq(c)):(s=e,e=i)):(s=e,e=i),e===i&&(e=s,o=v1(),o!==i?(h=L(),c=qe(),c!==i?(C=e,e=yq(c)):(s=e,e=i)):(s=e,e=i),e===i&&(e=s,o=hf(),o!==i?(h=L(),c=A1(),c!==i?(C=e,e=$q(c)):(s=e,e=i)):(s=e,e=i),e===i&&(e=s,o=pf(),o!==i?(h=L(),c=mf(),c!==i?(C=e,e=Cq(c)):(s=e,e=i)):(s=e,e=i),e===i&&(e=s,o=df(),o!==i?(h=L(),c=mf(),c!==i?(C=e,e=Mq(c)):(s=e,e=i)):(s=e,e=i),e===i&&(e=s,o=s,q++,h=Jl(),q--,h!==i?(s=o,o=void 0):o=i,o!==i?(h=ts(),c=L(),y=qe(),y!==i?(C=e,e=Eq(h,y)):(s=e,e=i)):(s=e,e=i),e===i&&(e=s,o=s,q++,h=Jl(),q--,h===i?o=void 0:(s=o,o=i),o!==i?(h=ts(),c=L(),y=qe(),y!==i?(C=e,e=Tq(h,y)):(s=e,e=i)):(s=e,e=i))))))))))))))))))))))))))))))))))))))))))))))))),e}function Jl(){var e;return e=Zl(),e===i&&(e=ef(),e===i&&(e=tf(),e===i&&(e=rf(),e===i&&(e=nf(),e===i&&(e=Xl(),e===i&&(e=sf(),e===i&&(e=af(),e===i&&(e=of(),e===i&&(e=lf(),e===i&&(e=ff(),e===i&&(e=cf(),e===i&&(e=uf(),e===i&&(e=hf(),e===i&&(e=pf(),e===i&&(e=df()))))))))))))))),e}function NA(){var e;return p.substr(s,5)===G?(e=G,s+=5):(e=i,q===0&&A(jh)),e===i&&(p.substr(s,5)===ue?(e=ue,s+=5):(e=i,q===0&&A(Vh))),e}function IA(){var e;return p.substr(s,4)===oe?(e=oe,s+=4):(e=i,q===0&&A(Gh)),e===i&&(p.substr(s,4)===fe?(e=fe,s+=4):(e=i,q===0&&A(Qh))),e}function Zl(){var e;return p.substr(s,4)===$e?(e=$e,s+=4):(e=i,q===0&&A(Yh)),e===i&&(p.substr(s,4)===He?(e=He,s+=4):(e=i,q===0&&A(Hh))),e}function zA(){var e;return p.substr(s,5)===it?(e=it,s+=5):(e=i,q===0&&A(Jh)),e===i&&(p.substr(s,5)===Nt?(e=Nt,s+=5):(e=i,q===0&&A(Zh))),e}function LA(){var e;return p.substr(s,5)===lr?(e=lr,s+=5):(e=i,q===0&&A(Xh)),e===i&&(p.substr(s,5)===_r?(e=_r,s+=5):(e=i,q===0&&A(ep))),e}function WA(){var e;return p.substr(s,5)===Yt?(e=Yt,s+=5):(e=i,q===0&&A(tp)),e===i&&(p.substr(s,5)===St?(e=St,s+=5):(e=i,q===0&&A(rp))),e}function Xl(){var e;return p.substr(s,6)===de?(e=de,s+=6):(e=i,q===0&&A(np)),e===i&&(p.substr(s,6)===Oe?(e=Oe,s+=6):(e=i,q===0&&A(ip))),e}function KA(){var e;return p.substr(s,10)===Fe?(e=Fe,s+=10):(e=i,q===0&&A(sp)),e===i&&(p.substr(s,10)===ht?(e=ht,s+=10):(e=i,q===0&&A(ap)),e===i&&(p.substr(s,10)===De?(e=De,s+=10):(e=i,q===0&&A(op)),e===i&&(p.substr(s,10)===Ee?(e=Ee,s+=10):(e=i,q===0&&A(lp))))),e}function jA(){var e;return p.substr(s,10)===Je?(e=Je,s+=10):(e=i,q===0&&A(fp)),e===i&&(p.substr(s,10)===Ke?(e=Ke,s+=10):(e=i,q===0&&A(cp)),e===i&&(p.substr(s,10)===Ie?(e=Ie,s+=10):(e=i,q===0&&A(up)),e===i&&(p.substr(s,10)===Te?(e=Te,s+=10):(e=i,q===0&&A(hp))))),e}function ef(){var e;return p.substr(s,8)===ge?(e=ge,s+=8):(e=i,q===0&&A(pp)),e===i&&(p.substr(s,8)===we?(e=we,s+=8):(e=i,q===0&&A(dp)),e===i&&(p.substr(s,8)===Se?(e=Se,s+=8):(e=i,q===0&&A(vp)),e===i&&(p.substr(s,8)===Ue?(e=Ue,s+=8):(e=i,q===0&&A(gp)),e===i&&(p.substr(s,8)===pt?(e=pt,s+=8):(e=i,q===0&&A(qp)))))),e}function tf(){var e;return p.substr(s,8)===Re?(e=Re,s+=8):(e=i,q===0&&A(Ap)),e===i&&(p.substr(s,8)===je?(e=je,s+=8):(e=i,q===0&&A(mp)),e===i&&(p.substr(s,8)===st?(e=st,s+=8):(e=i,q===0&&A(bp)),e===i&&(p.substr(s,8)===dt?(e=dt,s+=8):(e=i,q===0&&A(_p)),e===i&&(p.substr(s,8)===bt?(e=bt,s+=8):(e=i,q===0&&A(wp)))))),e}function rf(){var e;return p.substr(s,9)===at?(e=at,s+=9):(e=i,q===0&&A(kp)),e===i&&(p.substr(s,9)===Be?(e=Be,s+=9):(e=i,q===0&&A(yp)),e===i&&(p.substr(s,9)===ze?(e=ze,s+=9):(e=i,q===0&&A($p)),e===i&&(p.substr(s,9)===_t?(e=_t,s+=9):(e=i,q===0&&A(Cp)),e===i&&(p.substr(s,9)===fr?(e=fr,s+=9):(e=i,q===0&&A(Mp)))))),e}function nf(){var e;return p.substr(s,9)===Ht?(e=Ht,s+=9):(e=i,q===0&&A(Ep)),e===i&&(p.substr(s,9)===Jt?(e=Jt,s+=9):(e=i,q===0&&A(Tp)),e===i&&(p.substr(s,9)===cr?(e=cr,s+=9):(e=i,q===0&&A(Sp)),e===i&&(p.substr(s,9)===zr?(e=zr,s+=9):(e=i,q===0&&A(Pp)),e===i&&(p.substr(s,9)===hn?(e=hn,s+=9):(e=i,q===0&&A(Bp)))))),e}function VA(){var e;return p.substr(s,7)===Ai?(e=Ai,s+=7):(e=i,q===0&&A(xp)),e===i&&(p.substr(s,7)===mi?(e=mi,s+=7):(e=i,q===0&&A(Fp)),e===i&&(p.substr(s,7)===Nn?(e=Nn,s+=7):(e=i,q===0&&A(Dp)),e===i&&(p.substr(s,7)===bi?(e=bi,s+=7):(e=i,q===0&&A(Op)),e===i&&(p.substr(s,7)===_i?(e=_i,s+=7):(e=i,q===0&&A(Up)),e===i&&(p.substr(s,7)===wi?(e=wi,s+=7):(e=i,q===0&&A(Rp))))))),e}function GA(){var e;return p.substr(s,7)===ki?(e=ki,s+=7):(e=i,q===0&&A(Np)),e===i&&(p.substr(s,7)===yi?(e=yi,s+=7):(e=i,q===0&&A(Ip)),e===i&&(p.substr(s,7)===$i?(e=$i,s+=7):(e=i,q===0&&A(zp)),e===i&&(p.substr(s,7)===Ci?(e=Ci,s+=7):(e=i,q===0&&A(Lp)),e===i&&(p.substr(s,7)===Mi?(e=Mi,s+=7):(e=i,q===0&&A(Wp)),e===i&&(p.substr(s,7)===Ei?(e=Ei,s+=7):(e=i,q===0&&A(Kp))))))),e}function QA(){var e;return p.substr(s,9)===Ti?(e=Ti,s+=9):(e=i,q===0&&A(jp)),e===i&&(p.substr(s,9)===Si?(e=Si,s+=9):(e=i,q===0&&A(Vp)),e===i&&(p.substr(s,9)===S?(e=S,s+=9):(e=i,q===0&&A(Gp)),e===i&&(p.substr(s,9)===ur?(e=ur,s+=9):(e=i,q===0&&A(Qp))))),e}function YA(){var e;return p.substr(s,9)===wt?(e=wt,s+=9):(e=i,q===0&&A(Yp)),e===i&&(p.substr(s,9)===Lr?(e=Lr,s+=9):(e=i,q===0&&A(Hp)),e===i&&(p.substr(s,9)===j?(e=j,s+=9):(e=i,q===0&&A(Jp)),e===i&&(p.substr(s,9)===wr?(e=wr,s+=9):(e=i,q===0&&A(Zp))))),e}function sf(){var e;return p.substr(s,9)===Ne?(e=Ne,s+=9):(e=i,q===0&&A(Xp)),e===i&&(p.substr(s,9)===Pt?(e=Pt,s+=9):(e=i,q===0&&A(ed)),e===i&&(p.substr(s,9)===Pi?(e=Pi,s+=9):(e=i,q===0&&A(td)),e===i&&(p.substr(s,9)===vt?(e=vt,s+=9):(e=i,q===0&&A(rd))))),e}function HA(){var e;return p.substr(s,12)===In?(e=In,s+=12):(e=i,q===0&&A(nd)),e===i&&(p.substr(s,12)===zn?(e=zn,s+=12):(e=i,q===0&&A(id)),e===i&&(p.substr(s,12)===Z?(e=Z,s+=12):(e=i,q===0&&A(sd)),e===i&&(p.substr(s,12)===Bi?(e=Bi,s+=12):(e=i,q===0&&A(ad))))),e}function JA(){var e;return p.substr(s,7)===Ln?(e=Ln,s+=7):(e=i,q===0&&A(od)),e===i&&(p.substr(s,7)===xi?(e=xi,s+=7):(e=i,q===0&&A(ld))),e}function ZA(){var e;return p.substr(s,5)===Wn?(e=Wn,s+=5):(e=i,q===0&&A(fd)),e===i&&(p.substr(s,5)===Fi?(e=Fi,s+=5):(e=i,q===0&&A(cd))),e}function af(){var e;return p.substr(s,5)===Di?(e=Di,s+=5):(e=i,q===0&&A(ud)),e===i&&(p.substr(s,5)===Oi?(e=Oi,s+=5):(e=i,q===0&&A(hd))),e}function XA(){var e;return p.substr(s,7)===Kn?(e=Kn,s+=7):(e=i,q===0&&A(pd)),e===i&&(p.substr(s,7)===jn?(e=jn,s+=7):(e=i,q===0&&A(dd))),e}function e1(){var e;return p.substr(s,9)===Ui?(e=Ui,s+=9):(e=i,q===0&&A(vd)),e===i&&(p.substr(s,9)===Ri?(e=Ri,s+=9):(e=i,q===0&&A(gd))),e}function t1(){var e;return p.substr(s,12)===Ni?(e=Ni,s+=12):(e=i,q===0&&A(qd)),e===i&&(p.substr(s,12)===Vn?(e=Vn,s+=12):(e=i,q===0&&A(Ad)),e===i&&(p.substr(s,12)===pn?(e=pn,s+=12):(e=i,q===0&&A(md)),e===i&&(p.substr(s,12)===Ii?(e=Ii,s+=12):(e=i,q===0&&A(bd))))),e}function r1(){var e;return p.substr(s,3)===zi?(e=zi,s+=3):(e=i,q===0&&A(_d)),e===i&&(p.substr(s,3)===Gn?(e=Gn,s+=3):(e=i,q===0&&A(wd)),e===i&&(p.substr(s,3)===Li?(e=Li,s+=3):(e=i,q===0&&A(kd)))),e}function n1(){var e;return p.substr(s,3)===Ze?(e=Ze,s+=3):(e=i,q===0&&A(yd)),e===i&&(p.substr(s,3)===M?(e=M,s+=3):(e=i,q===0&&A($d)),e===i&&(p.substr(s,3)===P?(e=P,s+=3):(e=i,q===0&&A(Cd)))),e}function of(){var e;return p.substr(s,4)===B?(e=B,s+=4):(e=i,q===0&&A(Md)),e===i&&(p.substr(s,4)===X?(e=X,s+=4):(e=i,q===0&&A(Ed))),e}function lf(){var e;return p.substr(s,7)===ne?(e=ne,s+=7):(e=i,q===0&&A(Td)),e===i&&(p.substr(s,7)===me?(e=me,s+=7):(e=i,q===0&&A(Sd)),e===i&&(p.substr(s,7)===Zt?(e=Zt,s+=7):(e=i,q===0&&A(Pd)),e===i&&(p.substr(s,7)===Wr?(e=Wr,s+=7):(e=i,q===0&&A(Bd)),e===i&&(p.substr(s,7)===fo?(e=fo,s+=7):(e=i,q===0&&A(xd)),e===i&&(p.substr(s,7)===co?(e=co,s+=7):(e=i,q===0&&A(Fd))))))),e}function ff(){var e;return p.substr(s,7)===uo?(e=uo,s+=7):(e=i,q===0&&A(Dd)),e===i&&(p.substr(s,7)===ho?(e=ho,s+=7):(e=i,q===0&&A(Od)),e===i&&(p.substr(s,7)===po?(e=po,s+=7):(e=i,q===0&&A(Ud)),e===i&&(p.substr(s,7)===vo?(e=vo,s+=7):(e=i,q===0&&A(Rd)),e===i&&(p.substr(s,7)===go?(e=go,s+=7):(e=i,q===0&&A(Nd)),e===i&&(p.substr(s,7)===qo?(e=qo,s+=7):(e=i,q===0&&A(Id))))))),e}function cf(){var e;return p.substr(s,11)===Ao?(e=Ao,s+=11):(e=i,q===0&&A(zd)),e===i&&(p.substr(s,11)===mo?(e=mo,s+=11):(e=i,q===0&&A(Ld)),e===i&&(p.substr(s,11)===bo?(e=bo,s+=11):(e=i,q===0&&A(Wd)),e===i&&(p.substr(s,11)===_o?(e=_o,s+=11):(e=i,q===0&&A(Kd))))),e}function i1(){var e;return p.substr(s,5)===wo?(e=wo,s+=5):(e=i,q===0&&A(jd)),e===i&&(p.substr(s,5)===ko?(e=ko,s+=5):(e=i,q===0&&A(Vd)),e===i&&(p.substr(s,5)===yo?(e=yo,s+=5):(e=i,q===0&&A(Gd)),e===i&&(p.substr(s,5)===$o?(e=$o,s+=5):(e=i,q===0&&A(Qd))))),e}function s1(){var e;return p.substr(s,3)===Co?(e=Co,s+=3):(e=i,q===0&&A(Yd)),e===i&&(p.substr(s,3)===Mo?(e=Mo,s+=3):(e=i,q===0&&A(Hd)),e===i&&(p.substr(s,3)===Eo?(e=Eo,s+=3):(e=i,q===0&&A(Jd)))),e}function a1(){var e;return p.substr(s,11)===To?(e=To,s+=11):(e=i,q===0&&A(Zd)),e===i&&(p.substr(s,11)===So?(e=So,s+=11):(e=i,q===0&&A(Xd))),e}function o1(){var e;return p.substr(s,9)===Po?(e=Po,s+=9):(e=i,q===0&&A(ev)),e===i&&(p.substr(s,9)===Bo?(e=Bo,s+=9):(e=i,q===0&&A(tv))),e}function l1(){var e;return p.substr(s,4)===xo?(e=xo,s+=4):(e=i,q===0&&A(rv)),e===i&&(p.substr(s,4)===Fo?(e=Fo,s+=4):(e=i,q===0&&A(nv))),e}function uf(){var e;return p.substr(s,8)===Do?(e=Do,s+=8):(e=i,q===0&&A(iv)),e===i&&(p.substr(s,8)===Oo?(e=Oo,s+=8):(e=i,q===0&&A(sv)),e===i&&(p.substr(s,8)===Uo?(e=Uo,s+=8):(e=i,q===0&&A(av)),e===i&&(p.substr(s,8)===Ro?(e=Ro,s+=8):(e=i,q===0&&A(ov))))),e}function f1(){var e;return p.substr(s,7)===No?(e=No,s+=7):(e=i,q===0&&A(lv)),e===i&&(p.substr(s,7)===Io?(e=Io,s+=7):(e=i,q===0&&A(fv))),e}function c1(){var e;return p.substr(s,15)===zo?(e=zo,s+=15):(e=i,q===0&&A(cv)),e}function u1(){var e;return p.substr(s,15)===Lo?(e=Lo,s+=15):(e=i,q===0&&A(uv)),e}function h1(){var e;return p.substr(s,11)===Wo?(e=Wo,s+=11):(e=i,q===0&&A(hv)),e}function p1(){var e;return p.substr(s,11)===Ko?(e=Ko,s+=11):(e=i,q===0&&A(pv)),e}function d1(){var e;return p.substr(s,9)===jo?(e=jo,s+=9):(e=i,q===0&&A(dv)),e}function v1(){var e;return p.substr(s,9)===Vo?(e=Vo,s+=9):(e=i,q===0&&A(vv)),e}function hf(){var e;return p.substr(s,5)===Go?(e=Go,s+=5):(e=i,q===0&&A(gv)),e}function pf(){var e;return p.substr(s,10)===Qo?(e=Qo,s+=10):(e=i,q===0&&A(qv)),e}function df(){var e;return p.substr(s,10)===Yo?(e=Yo,s+=10):(e=i,q===0&&A(Av)),e}function L(){var e,o;for(q++,e=[],o=p.charAt(s),vn.test(o)?s++:(o=i,q===0&&A(gn));o!==i;)e.push(o),o=p.charAt(s),vn.test(o)?s++:(o=i,q===0&&A(gn));return q--,o=i,q===0&&A(Cl),e}function mn(){var e,o;if(e=[],o=p.charAt(s),vn.test(o)?s++:(o=i,q===0&&A(gn)),o!==i)for(;o!==i;)e.push(o),o=p.charAt(s),vn.test(o)?s++:(o=i,q===0&&A(gn));else e=i;return e}function g1(){var e,o;if(e=[],o=p.charAt(s),kl.test(o)?s++:(o=i,q===0&&A(Ml)),o!==i)for(;o!==i;)e.push(o),o=p.charAt(s),kl.test(o)?s++:(o=i,q===0&&A(Ml));else e=i;return e}function ts(){var e,o,h;for(e=s,o=[],h=p.charAt(s),yl.test(h)?s++:(h=i,q===0&&A(El));h!==i;)o.push(h),h=p.charAt(s),yl.test(h)?s++:(h=i,q===0&&A(El));return C=e,o=Sq(o),e=o,e}function Xe(){var e;return p.charCodeAt(s)===34?(e=Wi,s++):(e=i,q===0&&A(Qi)),e}function qe(){var e,o,h,c,y;if(e=s,p.charCodeAt(s)===34?(o=Wi,s++):(o=i,q===0&&A(Qi)),o!==i){for(gf(),h=[],c=vf();c!==i;)h.push(c),c=vf();c=gf(),p.charCodeAt(s)===34?(y=Wi,s++):(y=i,q===0&&A(Qi)),y!==i?(C=e,e=Pq(h)):(s=e,e=i)}else s=e,e=i;return e}function vf(){var e,o,h,c;return e=p.charAt(s),Oh.test(e)?s++:(e=i,q===0&&A(mv)),e===i&&(e=s,o=q1(),o!==i?(h=s,p.charCodeAt(s)===92?(c=Ho,s++):(c=i,q===0&&A(Tl)),c!==i&&(C=h,c=Bq()),h=c,h===i&&(h=s,p.charCodeAt(s)===34?(c=Wi,s++):(c=i,q===0&&A(Qi)),c!==i&&(C=h,c=xq()),h=c),h!==i?(C=e,e=Fq(h)):(s=e,e=i)):(s=e,e=i)),e}function gf(){var e,o;for(q++,e=[],o=p.charAt(s),vn.test(o)?s++:(o=i,q===0&&A(gn));o!==i;)e.push(o),o=p.charAt(s),vn.test(o)?s++:(o=i,q===0&&A(gn));return q--,o=i,q===0&&A(Cl),e}function q1(){var e;return p.charCodeAt(s)===92?(e=Ho,s++):(e=i,q===0&&A(Tl)),e}function Vs(){var e,o,h,c,y,x,U,V,pe;return e=s,o=Xe(),o!==i?(h=s,c=p.charAt(s),kr.test(c)?s++:(c=i,q===0&&A(yr)),c!==i?(y=p.charAt(s),kr.test(y)?s++:(y=i,q===0&&A(yr)),y!==i?(x=p.charAt(s),kr.test(x)?s++:(x=i,q===0&&A(yr)),x!==i?(U=p.charAt(s),kr.test(U)?s++:(U=i,q===0&&A(yr)),U!==i?(c=[c,y,x,U],h=c):(s=h,h=i)):(s=h,h=i)):(s=h,h=i)):(s=h,h=i),h!==i?(p.charCodeAt(s)===46?(c=Ki,s++):(c=i,q===0&&A(Yi)),c!==i?(y=s,x=p.charAt(s),kr.test(x)?s++:(x=i,q===0&&A(yr)),x!==i?(U=p.charAt(s),kr.test(U)?s++:(U=i,q===0&&A(yr)),U!==i?(x=[x,U],y=x):(s=y,y=i)):(s=y,y=i),y!==i?(p.charCodeAt(s)===46?(x=Ki,s++):(x=i,q===0&&A(Yi)),x!==i?(U=s,V=p.charAt(s),kr.test(V)?s++:(V=i,q===0&&A(yr)),V!==i?(pe=p.charAt(s),kr.test(pe)?s++:(pe=i,q===0&&A(yr)),pe!==i?(V=[V,pe],U=V):(s=U,U=i)):(s=U,U=i),U!==i?(V=Xe(),V!==i?(C=e,e=Dq(h,y,U)):(s=e,e=i)):(s=e,e=i)):(s=e,e=i)):(s=e,e=i)):(s=e,e=i)):(s=e,e=i)):(s=e,e=i),e}function qf(){var e,o,h,c,y,x,U,V,pe;if(e=s,o=Xe(),o!==i){if(h=[],c=p.charAt(s),Bt.test(c)?s++:(c=i,q===0&&A(xt)),c!==i)for(;c!==i;)h.push(c),c=p.charAt(s),Bt.test(c)?s++:(c=i,q===0&&A(xt));else h=i;if(h!==i)if(p.charCodeAt(s)===58?(c=dn,s++):(c=i,q===0&&A(qn)),c!==i){if(y=[],x=p.charAt(s),Bt.test(x)?s++:(x=i,q===0&&A(xt)),x!==i)for(;x!==i;)y.push(x),x=p.charAt(s),Bt.test(x)?s++:(x=i,q===0&&A(xt));else y=i;if(y!==i)if(p.charCodeAt(s)===58?(x=dn,s++):(x=i,q===0&&A(qn)),x!==i){if(U=[],V=p.charAt(s),Bt.test(V)?s++:(V=i,q===0&&A(xt)),V!==i)for(;V!==i;)U.push(V),V=p.charAt(s),Bt.test(V)?s++:(V=i,q===0&&A(xt));else U=i;U!==i?(V=Af(),V===i&&(V=null),pe=Xe(),pe!==i?(C=e,e=Oq(h,y,U,V)):(s=e,e=i)):(s=e,e=i)}else s=e,e=i;else s=e,e=i}else s=e,e=i;else s=e,e=i}else s=e,e=i;return e}function Af(){var e,o,h,c;if(e=s,p.charCodeAt(s)===46?(o=Ki,s++):(o=i,q===0&&A(Yi)),o!==i){if(h=[],c=p.charAt(s),Bt.test(c)?s++:(c=i,q===0&&A(xt)),c!==i)for(;c!==i;)h.push(c),c=p.charAt(s),Bt.test(c)?s++:(c=i,q===0&&A(xt));else h=i;h!==i?(C=e,e=Uq(h)):(s=e,e=i)}else s=e,e=i;return e}function A1(){var e,o,h,c;return e=s,o=Xe(),o!==i?(h=m1(),h!==i?(c=Xe(),c!==i?(C=e,e=Rq(h)):(s=e,e=i)):(s=e,e=i)):(s=e,e=i),e}function m1(){var e,o,h,c;return e=s,o=b1(),o!==i?(p.charCodeAt(s)===47?(h=Us,s++):(h=i,q===0&&A(Is)),h!==i?(c=bf(),c!==i?(C=e,e=Nq(o,c)):(s=e,e=i)):(s=e,e=i)):(s=e,e=i),e}function b1(){var e;return e=p.charAt(s),Uh.test(e)?s++:(e=i,q===0&&A(bv)),e}function mf(){var e,o,h,c;return e=s,o=Xe(),o!==i?(h=bf(),h!==i?(c=Xe(),c!==i?(C=e,e=Iq(h)):(s=e,e=i)):(s=e,e=i)):(s=e,e=i),e}function bf(){var e,o;return e=s,o=Ef(),o!==i&&(C=e,o=zq(o)),e=o,e}function _1(){var e,o,h,c;return e=s,o=Xe(),o!==i?(h=w1(),c=Xe(),c!==i?(C=e,e=Lq(h)):(s=e,e=i)):(s=e,e=i),e}function w1(){var e,o,h,c,y,x,U;if(e=s,o=s,h=Gs(),h!==i){for(c=[],y=s,p.charCodeAt(s)===58?(x=dn,s++):(x=i,q===0&&A(qn)),x!==i?(U=Gs(),U!==i?(C=y,y=Nl(h,U)):(s=y,y=i)):(s=y,y=i);y!==i;)c.push(y),y=s,p.charCodeAt(s)===58?(x=dn,s++):(x=i,q===0&&A(qn)),x!==i?(U=Gs(),U!==i?(C=y,y=Nl(h,U)):(s=y,y=i)):(s=y,y=i);C=o,o=Wq(h,c)}else s=o,o=i;return o===i&&(o=null),C=e,o=Kq(o),e=o,e}function Gs(){var e,o,h,c,y,x;return e=s,p.charCodeAt(s)===63?(o=Jo,s++):(o=i,q===0&&A(Sl)),o!==i&&(C=e,o=jq()),e=o,e===i&&(e=s,p.charCodeAt(s)===45?(o=ji,s++):(o=i,q===0&&A(Hi)),o!==i&&(C=e,o=Vq()),e=o,e===i&&(e=s,o=Wt(),o!==i?(p.charCodeAt(s)===47?(h=Us,s++):(h=i,q===0&&A(Is)),h!==i?(c=Wt(),c!==i?(p.charCodeAt(s)===43?(y=Rs,s++):(y=i,q===0&&A(zs)),y!==i?(x=Wt(),x!==i?(C=e,e=Gq(o,c,x)):(s=e,e=i)):(s=e,e=i)):(s=e,e=i)):(s=e,e=i)):(s=e,e=i),e===i&&(e=s,o=Wt(),o!==i?(p.charCodeAt(s)===47?(h=Us,s++):(h=i,q===0&&A(Is)),h!==i?(c=Wt(),c!==i?(C=e,e=Qq(o,c)):(s=e,e=i)):(s=e,e=i)):(s=e,e=i),e===i&&(e=s,o=Wt(),o!==i?(p.charCodeAt(s)===43?(h=Rs,s++):(h=i,q===0&&A(zs)),h!==i?(c=Wt(),c!==i?(C=e,e=Yq(o,c)):(s=e,e=i)):(s=e,e=i)):(s=e,e=i),e===i&&(e=s,o=Wt(),o!==i&&(C=e,o=Hq(o)),e=o,e===i&&(e=s,p.charCodeAt(s)===42?(o=Zo,s++):(o=i,q===0&&A(Pl)),o!==i?(h=Wt(),h!==i?(C=e,e=Jq(h)):(s=e,e=i)):(s=e,e=i))))))),e}function k1(){var e,o,h,c;return e=s,o=Xe(),o!==i?(h=_f(),h!==i?(c=Xe(),c!==i?(C=e,e=Zq(h)):(s=e,e=i)):(s=e,e=i)):(s=e,e=i),e}function _f(){var e,o;return e=s,p.substr(s,3)===Xo?(o=Xo,s+=3):(o=i,q===0&&A(_v)),o!==i&&(C=e,o=Xq(o)),e=o,e===i&&(e=s,p.substr(s,3)===el?(o=el,s+=3):(o=i,q===0&&A(wv)),o!==i&&(C=e,o=e0(o)),e=o,e===i&&(e=s,p.substr(s,7)===tl?(o=tl,s+=7):(o=i,q===0&&A(kv)),o!==i&&(C=e,o=t0(o)),e=o,e===i&&(e=s,p.substr(s,3)===rl?(o=rl,s+=3):(o=i,q===0&&A(yv)),o!==i&&(C=e,o=r0()),e=o,e===i&&(e=s,p.charCodeAt(s)===42?(o=Zo,s++):(o=i,q===0&&A(Pl)),o!==i&&(C=e,o=n0(o)),e=o)))),e}function wf(){var e,o,h,c;return e=s,o=Yn(),o!==i&&(C=e,o=i0(o)),e=o,e===i&&(e=s,o=Xe(),o!==i?(p.charCodeAt(s)===45?(h=ji,s++):(h=i,q===0&&A(Hi)),h!==i?(c=Xe(),c!==i?(C=e,e=s0()):(s=e,e=i)):(s=e,e=i)):(s=e,e=i),e===i&&(e=s,o=Xe(),o!==i?(h=Xe(),h!==i?(C=e,e=a0()):(s=e,e=i)):(s=e,e=i))),e}function Yn(){var e,o,h,c;if(e=s,o=Xe(),o!==i){if(h=[],c=p.charAt(s),Bt.test(c)?s++:(c=i,q===0&&A(xt)),c!==i)for(;c!==i;)h.push(c),c=p.charAt(s),Bt.test(c)?s++:(c=i,q===0&&A(xt));else h=i;h!==i?(c=Xe(),c!==i?(C=e,e=o0(h)):(s=e,e=i)):(s=e,e=i)}else s=e,e=i;return e}function Hn(){var e,o,h,c,y,x,U,V,pe,Ce;return e=s,Xi(),o=L(),h=Qs(),h===i&&(h=null),L(),c=D1(),c===i&&(c=null),L(),y=O1(),y!==i?(L(),x=xf(),x===i&&(x=null),U=y1(),U===i&&(U=null),L(),V=Qs(),V===i&&(V=null),L(),pe=Sf(),pe===i&&(pe=null),Ce=Hn(),Ce===i&&(Ce=null),C=e,e=l0(h,c,y,x,U,V,pe,Ce)):(s=e,e=i),e===i&&(e=s,L(),o=$1(),o!==i?(h=L(),C=e,e=f0(o)):(s=e,e=i)),e}function y1(){var e,o,h,c;return e=s,o=Pf(),o!==i?(p.charCodeAt(s)===61?(h=nl,s++):(h=i,q===0&&A(Ls)),h!==i?(c=Bf(),c!==i?(o=[o,h,c],e=o):(s=e,e=i)):(s=e,e=i)):(s=e,e=i),e}function $1(){var e,o;return e=s,o=_f(),o!==i&&(C=e,o=c0(o)),e=o,e}function Qs(){var e,o,h,c,y;if(e=s,o=Ys(),o!==i){for(h=[],c=s,L(),y=Ys(),y!==i?(C=c,c=Il(o,y)):(s=c,c=i);c!==i;)h.push(c),c=s,L(),y=Ys(),y!==i?(C=c,c=Il(o,y)):(s=c,c=i);C=e,e=u0(o,h)}else s=e,e=i;return e}function Ys(){var e,o,h,c;return e=s,o=Cf(),o!==i?(h=Mf(),h!==i?(C=e,e=h0()):(s=e,e=i)):(s=e,e=i),e===i&&(e=s,o=Cf(),o!==i?(h=gt(),h!==i?(c=Mf(),c!==i?(C=e,e=p0(h)):(s=e,e=i)):(s=e,e=i)):(s=e,e=i),e===i&&(e=s,o=C1(),o!==i&&(C=e,o=d0(o)),e=o)),e}function gt(){var e,o,h,c,y,x,U,V,pe,Ce,ve,ee,Le;if(e=s,o=L(),h=Kr(),h!==i)if(p.substr(s,4)===il?(c=il,s+=4):(c=i,q===0&&A($v)),c!==i)if(y=mn(),y!==i)if(x=M1(),x===i&&(x=null),U=L(),V=$r(),V!==i){for(pe=L(),Ce=[],ve=s,ee=gt(),ee!==i&&(C=ve,ee=zl(x,ee)),ve=ee;ve!==i;)Ce.push(ve),ve=s,ee=gt(),ee!==i&&(C=ve,ee=zl(x,ee)),ve=ee;C=e,e=v0(x,Ce)}else s=e,e=i;else s=e,e=i;else s=e,e=i;else s=e,e=i;if(e===i){if(e=s,o=L(),h=Kr(),h!==i)if(p.substr(s,4)===sl?(c=sl,s+=4):(c=i,q===0&&A(Cv)),c!==i)if(y=mn(),y!==i)if(x=E1(),x===i&&(x=null),U=L(),V=$r(),V!==i){for(pe=L(),Ce=[],ve=s,ee=gt(),ee!==i&&(C=ve,ee=Ll(x,ee)),ve=ee;ve!==i;)Ce.push(ve),ve=s,ee=gt(),ee!==i&&(C=ve,ee=Ll(x,ee)),ve=ee;C=e,e=g0(x,Ce)}else s=e,e=i;else s=e,e=i;else s=e,e=i;else s=e,e=i;if(e===i){if(e=s,o=L(),h=Kr(),h!==i)if(p.charCodeAt(s)===37?(c=Ns,s++):(c=i,q===0&&A(Ws)),c!==i)if(y=S1(),y!==i)if(x=mn(),x!==i)if(U=Ef(),U!==i)if(V=L(),pe=$r(),pe!==i){for(Ce=L(),ve=[],ee=s,Le=gt(),Le!==i&&(C=ee,Le=Wl(y,U,Le)),ee=Le;ee!==i;)ve.push(ee),ee=s,Le=gt(),Le!==i&&(C=ee,Le=Wl(y,U,Le)),ee=Le;C=e,e=q0(y,U,ve)}else s=e,e=i;else s=e,e=i;else s=e,e=i;else s=e,e=i;else s=e,e=i;else s=e,e=i;if(e===i){if(e=s,o=L(),h=Kr(),h!==i)if(p.charCodeAt(s)===37?(c=Ns,s++):(c=i,q===0&&A(Ws)),c!==i)if(y=P1(),y!==i)if(x=mn(),x!==i)if(U=B1(),U!==i)if(V=L(),pe=$r(),pe!==i){for(Ce=L(),ve=[],ee=s,Le=gt(),Le!==i&&(C=ee,Le=Kl(y,U,Le)),ee=Le;ee!==i;)ve.push(ee),ee=s,Le=gt(),Le!==i&&(C=ee,Le=Kl(y,U,Le)),ee=Le;C=e,e=A0(y,U,ve)}else s=e,e=i;else s=e,e=i;else s=e,e=i;else s=e,e=i;else s=e,e=i;else s=e,e=i;if(e===i){if(e=s,o=L(),h=Kr(),h!==i)if(p.substr(s,5)===al?(c=al,s+=5):(c=i,q===0&&A(Mv)),c!==i)if(y=mn(),y!==i)if(x=ts(),U=L(),V=$r(),V!==i){for(pe=L(),Ce=[],ve=s,ee=gt(),ee!==i&&(C=ve,ee=jl(x,ee)),ve=ee;ve!==i;)Ce.push(ve),ve=s,ee=gt(),ee!==i&&(C=ve,ee=jl(x,ee)),ve=ee;C=e,e=m0(x,Ce)}else s=e,e=i;else s=e,e=i;else s=e,e=i;else s=e,e=i;if(e===i){if(e=s,o=L(),h=Kr(),h!==i)if(p.charCodeAt(s)===37?(c=Ns,s++):(c=i,q===0&&A(Ws)),c!==i)if(y=ts(),x=mn(),x!==i){if(U=[],V=yf(),V!==i)for(;V!==i;)U.push(V),V=yf();else U=i;if(U!==i)if(V=$r(),V!==i){for(pe=L(),Ce=[],ve=s,ee=gt(),ee!==i&&(C=ve,ee=Vl(y,U,ee)),ve=ee;ve!==i;)Ce.push(ve),ve=s,ee=gt(),ee!==i&&(C=ve,ee=Vl(y,U,ee)),ve=ee;C=e,e=b0(y,U,Ce)}else s=e,e=i;else s=e,e=i}else s=e,e=i;else s=e,e=i;else s=e,e=i;if(e===i){if(e=s,o=[],h=kf(),h!==i)for(;h!==i;)o.push(h),h=kf();else o=i;if(o!==i){for(h=[],c=s,y=L(),x=gt(),x!==i?(C=c,c=Gl(o,x)):(s=c,c=i);c!==i;)h.push(c),c=s,y=L(),x=gt(),x!==i?(C=c,c=Gl(o,x)):(s=c,c=i);C=e,e=_0(o,h)}else s=e,e=i}}}}}}return e}function kf(){var e,o,h,c;return e=s,o=s,q++,p.substr(s,2)===ol?(h=ol,s+=2):(h=i,q===0&&A(Ev)),q--,h===i?o=void 0:(s=o,o=i),o!==i?(h=s,q++,p.charCodeAt(s)===125?(c=ll,s++):(c=i,q===0&&A(Bl)),q--,c===i?h=void 0:(s=h,h=i),h!==i?(p.length>s?(c=p.charAt(s),s++):(c=i,q===0&&A(xl)),c!==i?(C=e,e=w0(c)):(s=e,e=i)):(s=e,e=i)):(s=e,e=i),e}function yf(){var e,o,h;return e=s,o=s,q++,h=$r(),q--,h===i?o=void 0:(s=o,o=i),o!==i?(p.length>s?(h=p.charAt(s),s++):(h=i,q===0&&A(xl)),h!==i?(C=e,e=k0(h)):(s=e,e=i)):(s=e,e=i),e}function C1(){var e,o,h,c;if(e=s,o=T1(),o!==i){for(h=[],c=p.charAt(s),$l.test(c)?s++:(c=i,q===0&&A(Fl));c!==i;)h.push(c),c=p.charAt(s),$l.test(c)?s++:(c=i,q===0&&A(Fl));c=g1(),c!==i?(C=e,e=y0(h)):(s=e,e=i)}else s=e,e=i;return e}function M1(){var e,o,h,c,y,x,U;if(e=s,o=Hs(),o!==i){for(L(),h=[],c=s,p.charCodeAt(s)===44?(y=Vi,s++):(y=i,q===0&&A(Ji)),y!==i?(x=L(),U=Hs(),U!==i?(y=[y,x,U],c=y):(s=c,c=i)):(s=c,c=i);c!==i;)h.push(c),c=s,p.charCodeAt(s)===44?(y=Vi,s++):(y=i,q===0&&A(Ji)),y!==i?(x=L(),U=Hs(),U!==i?(y=[y,x,U],c=y):(s=c,c=i)):(s=c,c=i);C=e,e=$0(o,h)}else s=e,e=i;return e}function Hs(){var e,o,h;return e=s,o=$f(),o!==i?(h=Zs(),h!==i?(C=e,e=C0(o,h)):(s=e,e=i)):(s=e,e=i),e}function E1(){var e,o,h,c,y,x,U;if(e=s,o=Js(),o!==i){for(L(),h=[],c=s,p.charCodeAt(s)===44?(y=Vi,s++):(y=i,q===0&&A(Ji)),y!==i?(x=L(),U=Js(),U!==i?(y=[y,x,U],c=y):(s=c,c=i)):(s=c,c=i);c!==i;)h.push(c),c=s,p.charCodeAt(s)===44?(y=Vi,s++):(y=i,q===0&&A(Ji)),y!==i?(x=L(),U=Js(),U!==i?(y=[y,x,U],c=y):(s=c,c=i)):(s=c,c=i);C=e,e=M0(o,h)}else s=e,e=i;return e}function Js(){var e,o,h,c;return e=s,o=$f(),o!==i?(h=Zs(),h!==i?(c=Zs(),c!==i?(C=e,e=E0(o,h,c)):(s=e,e=i)):(s=e,e=i)):(s=e,e=i),e}function $f(){var e,o;return e=s,p.charCodeAt(s)===89?(o=rh,s++):(o=i,q===0&&A(Tv)),o!==i&&(C=e,o=T0()),e=o,e===i&&(e=s,p.charCodeAt(s)===71?(o=nh,s++):(o=i,q===0&&A(Sv)),o!==i&&(C=e,o=S0()),e=o,e===i&&(e=s,p.charCodeAt(s)===82?(o=ih,s++):(o=i,q===0&&A(Pv)),o!==i&&(C=e,o=P0()),e=o,e===i&&(e=s,p.charCodeAt(s)===66?(o=sh,s++):(o=i,q===0&&A(Bv)),o!==i&&(C=e,o=B0()),e=o,e===i&&(e=s,p.charCodeAt(s)===79?(o=ah,s++):(o=i,q===0&&A(xv)),o!==i&&(C=e,o=x0()),e=o,e===i&&(e=s,p.charCodeAt(s)===67?(o=oh,s++):(o=i,q===0&&A(Fv)),o!==i&&(C=e,o=F0()),e=o))))),e}function Zs(){var e,o,h;return e=s,o=jr(),o!==i?(h=Vr(),h!==i?(C=e,e=D0(o,h)):(s=e,e=i)):(s=e,e=i),e}function Cf(){var e;return p.charCodeAt(s)===123?(e=lh,s++):(e=i,q===0&&A(Dv)),e}function Mf(){var e;return p.charCodeAt(s)===125?(e=ll,s++):(e=i,q===0&&A(Bl)),e}function Kr(){var e;return p.charCodeAt(s)===91?(e=fh,s++):(e=i,q===0&&A(Ov)),e}function $r(){var e;return p.charCodeAt(s)===93?(e=ch,s++):(e=i,q===0&&A(Uv)),e}function T1(){var e;return p.charCodeAt(s)===59?(e=uh,s++):(e=i,q===0&&A(Rv)),e}function S1(){var e,o;return e=s,p.substr(s,3)===fl?(o=fl,s+=3):(o=i,q===0&&A(Nv)),o!==i&&(C=e,o=O0()),e=o,e===i&&(e=s,p.substr(s,3)===cl?(o=cl,s+=3):(o=i,q===0&&A(Iv)),o!==i&&(C=e,o=U0()),e=o,e===i&&(e=s,p.substr(s,3)===ul?(o=ul,s+=3):(o=i,q===0&&A(zv)),o!==i&&(C=e,o=R0()),e=o)),e}function P1(){var e,o;return e=s,p.substr(s,3)===hl?(o=hl,s+=3):(o=i,q===0&&A(Lv)),o!==i&&(C=e,o=N0()),e=o,e}function Ef(){var e,o,h,c,y;return e=s,o=Tf(),o===i&&(o=null),h=Cr(),h!==i?(c=Cr(),c===i&&(c=null),y=Af(),y===i&&(y=null),C=e,e=I0(o,h,c,y)):(s=e,e=i),e}function B1(){var e,o,h,c;return e=s,o=Tf(),o===i&&(o=null),h=Cr(),h!==i?(c=Cr(),c===i&&(c=null),C=e,e=z0(o,h,c)):(s=e,e=i),e}function Tf(){var e,o,h;return e=s,o=x1(),o!==i?(h=F1(),h===i&&(h=null),C=e,e=L0(o,h)):(s=e,e=i),e}function x1(){var e,o,h,c;return e=s,o=Cr(),o!==i?(h=Cr(),h===i&&(h=null),p.charCodeAt(s)===58?(c=dn,s++):(c=i,q===0&&A(qn)),c!==i?(C=e,e=W0(o,h)):(s=e,e=i)):(s=e,e=i),e}function F1(){var e,o,h,c;return e=s,o=Cr(),o!==i?(h=Cr(),h===i&&(h=null),p.charCodeAt(s)===58?(c=dn,s++):(c=i,q===0&&A(qn)),c!==i?(C=e,e=K0(o,h)):(s=e,e=i)):(s=e,e=i),e}function Cr(){var e,o;return e=s,o=p.charAt(s),Bt.test(o)?s++:(o=i,q===0&&A(xt)),o!==i&&(C=e,o=j0(o)),e=o,e}function Sf(){var e,o,h,c,y;return e=s,o=Pf(),o!==i?(h=Hn(),h!==i?(c=Bf(),c!==i?(L(),y=Sf(),y===i&&(y=null),C=e,e=V0(h,y)):(s=e,e=i)):(s=e,e=i)):(s=e,e=i),e}function Pf(){var e;return p.charCodeAt(s)===40?(e=hh,s++):(e=i,q===0&&A(Wv)),e}function Bf(){var e;return p.charCodeAt(s)===41?(e=ph,s++):(e=i,q===0&&A(Kv)),e}function D1(){var e,o,h,c,y,x,U;if(e=s,o=Wt(),o!==i){for(h=[],c=ns();c!==i;)h.push(c),c=ns();for(c=[],y=rs();y!==i;)c.push(y),y=rs();for(y=[],x=ns();x!==i;)y.push(x),x=ns();for(x=[],U=rs();U!==i;)x.push(U),U=rs();C=e,e=G0(o)}else s=e,e=i;return e}function rs(){var e;return p.charCodeAt(s)===46?(e=Ki,s++):(e=i,q===0&&A(Yi)),e}function Wt(){var e,o,h;if(q++,e=s,o=[],h=p.charAt(s),Bt.test(h)?s++:(h=i,q===0&&A(xt)),h!==i)for(;h!==i;)o.push(h),h=p.charAt(s),Bt.test(h)?s++:(h=i,q===0&&A(xt));else o=i;return o!==i&&(C=e,o=Q0(o)),e=o,q--,e===i&&(o=i,q===0&&A(jv)),e}function ns(){var e,o,h;if(e=s,o=[],p.charCodeAt(s)===32?(h=pl,s++):(h=i,q===0&&A(Dl)),h!==i)for(;h!==i;)o.push(h),p.charCodeAt(s)===32?(h=pl,s++):(h=i,q===0&&A(Dl));else o=i;return o!==i&&(C=e,o=Y0()),e=o,e}function O1(){var e,o,h,c,y,x,U,V,pe;return e=s,o=is(),o===i&&(o=null),h=s,q++,c=R1(),q--,c!==i?(s=h,h=void 0):h=i,h!==i?(c=Ff(),c!==i?(y=ea(),y===i&&(y=null),x=jr(),x!==i?(U=Vr(),U!==i?(V=Xs(),V===i&&(V=null),pe=Jn(),pe===i&&(pe=null),L(),p.substr(s,4)===dh?s+=4:q===0&&A(Vv),C=e,e=H0(o,c,y,x,U,V,pe)):(s=e,e=i)):(s=e,e=i)):(s=e,e=i)):(s=e,e=i),e===i&&(e=s,o=is(),o===i&&(o=null),h=jr(),h!==i?(c=Vr(),c!==i?(y=I1(),y===i&&(y=null),x=jr(),x!==i?(U=Vr(),U!==i?(V=Xs(),V===i&&(V=null),pe=Jn(),pe===i&&(pe=null),C=e,e=J0(o,h,c,y,x,U,V,pe)):(s=e,e=i)):(s=e,e=i)):(s=e,e=i)):(s=e,e=i),e===i&&(e=s,o=is(),o===i&&(o=null),h=ea(),h===i&&(h=null),c=jr(),c!==i?(y=Vr(),y!==i?(x=Xs(),x===i&&(x=null),U=Jn(),U===i&&(U=null),C=e,e=Z0(o,h,c,y,x,U)):(s=e,e=i)):(s=e,e=i),e===i&&(e=s,p.substr(s,5)===dl?(o=dl,s+=5):(o=i,q===0&&A(Gv)),o!==i?(h=Jn(),h===i&&(h=null),C=e,e=X0(h)):(s=e,e=i),e===i&&(e=s,p.substr(s,3)===vl?(o=vl,s+=3):(o=i,q===0&&A(Qv)),o!==i?(h=Jn(),h===i&&(h=null),C=e,e=eA(h)):(s=e,e=i),e===i&&(e=s,o=is(),o!==i?(p.charCodeAt(s)===64?(h=vh,s++):(h=i,q===0&&A(Yv)),h!==i?(c=jr(),c!==i?(y=Vr(),y!==i?(C=e,e=tA(o,c,y)):(s=e,e=i)):(s=e,e=i)):(s=e,e=i)):(s=e,e=i),e===i&&(e=s,p.substr(s,2)===gl?(o=gl,s+=2):(o=i,q===0&&A(Hv)),o===i&&(o=s,p.charCodeAt(s)===45?(h=ji,s++):(h=i,q===0&&A(Hi)),h!==i?(p.charCodeAt(s)===45?(c=ji,s++):(c=i,q===0&&A(Hi)),c!==i?(h=[h,c],o=h):(s=o,o=i)):(s=o,o=i)),o!==i&&(C=e,o=rA()),e=o)))))),e}function Jn(){var e,o,h,c;return e=s,o=s,h=s,q++,p.substr(s,2)===Gi?(c=Gi,s+=2):(c=i,q===0&&A(Ol)),q--,c===i?h=void 0:(s=h,h=i),h!==i?(p.charCodeAt(s)===43?(c=Rs,s++):(c=i,q===0&&A(zs)),c!==i?(h=[h,c],o=h):(s=o,o=i)):(s=o,o=i),o!==i&&(C=e,o=nA(o)),e=o,e===i&&(e=s,o=s,h=s,q++,p.substr(s,3)===ql?(c=ql,s+=3):(c=i,q===0&&A(Jv)),q--,c===i?h=void 0:(s=h,h=i),h!==i?(p.charCodeAt(s)===35?(c=gh,s++):(c=i,q===0&&A(Zv)),c!==i?(h=[h,c],o=h):(s=o,o=i)):(s=o,o=i),o!==i&&(C=e,o=iA(o)),e=o),e}function Xs(){var e,o;return e=s,p.charCodeAt(s)===61?s++:q===0&&A(Ls),o=N1(),o!==i?(C=e,e=sA(o)):(s=e,e=i),e}function xf(){var e,o,h;return e=s,o=U1(),o!==i?(L(),h=xf(),h===i&&(h=null),C=e,e=aA(o,h)):(s=e,e=i),e}function U1(){var e,o,h;return e=s,p.charCodeAt(s)===36?(o=qh,s++):(o=i,q===0&&A(Xv)),o!==i?(h=Wt(),h!==i?(C=e,e=oA(h)):(s=e,e=i)):(s=e,e=i),e===i&&(e=s,p.substr(s,2)===Al?(o=Al,s+=2):(o=i,q===0&&A(eg)),o!==i&&(C=e,o=lA()),e=o,e===i&&(e=s,p.substr(s,2)===ml?(o=ml,s+=2):(o=i,q===0&&A(tg)),o!==i&&(C=e,o=fA()),e=o,e===i&&(e=s,p.substr(s,2)===bl?(o=bl,s+=2):(o=i,q===0&&A(rg)),o!==i&&(C=e,o=cA()),e=o,e===i&&(e=s,p.substr(s,2)===_l?(o=_l,s+=2):(o=i,q===0&&A(ng)),o!==i&&(C=e,o=uA()),e=o,e===i&&(e=s,p.charCodeAt(s)===33?(o=Ah,s++):(o=i,q===0&&A(ig)),o!==i&&(C=e,o=hA()),e=o,e===i&&(e=s,p.charCodeAt(s)===63?(o=Jo,s++):(o=i,q===0&&A(Sl)),o!==i&&(C=e,o=pA()),e=o,e===i&&(e=s,p.charCodeAt(s)===8252?(o=mh,s++):(o=i,q===0&&A(sg)),o!==i&&(C=e,o=dA()),e=o,e===i&&(e=s,p.charCodeAt(s)===8263?(o=bh,s++):(o=i,q===0&&A(ag)),o!==i&&(C=e,o=vA()),e=o,e===i&&(e=s,p.charCodeAt(s)===8265?(o=_h,s++):(o=i,q===0&&A(og)),o!==i&&(C=e,o=gA()),e=o,e===i&&(e=s,p.charCodeAt(s)===8264?(o=wh,s++):(o=i,q===0&&A(lg)),o!==i&&(C=e,o=qA()),e=o,e===i&&(e=s,p.charCodeAt(s)===9633?(o=kh,s++):(o=i,q===0&&A(fg)),o!==i&&(C=e,o=AA()),e=o,e===i&&(e=s,p.charCodeAt(s)===61?(o=nl,s++):(o=i,q===0&&A(Ls)),o!==i&&(C=e,o=mA()),e=o,e===i&&(e=s,p.charCodeAt(s)===8734?(o=yh,s++):(o=i,q===0&&A(cg)),o!==i&&(C=e,o=bA()),e=o,e===i&&(e=s,p.charCodeAt(s)===10866?(o=$h,s++):(o=i,q===0&&A(ug)),o!==i&&(C=e,o=_A()),e=o,e===i&&(e=s,p.charCodeAt(s)===10865?(o=Ch,s++):(o=i,q===0&&A(hg)),o!==i&&(C=e,o=wA()),e=o,e===i&&(e=s,p.charCodeAt(s)===177?(o=Mh,s++):(o=i,q===0&&A(pg)),o!==i&&(C=e,o=kA()),e=o,e===i&&(e=s,p.charCodeAt(s)===8723?(o=Eh,s++):(o=i,q===0&&A(dg)),o!==i&&(C=e,o=yA()),e=o,e===i&&(e=s,p.substr(s,2)===Gi?(o=Gi,s+=2):(o=i,q===0&&A(Ol)),o!==i&&(C=e,o=$A()),e=o,e===i&&(e=s,p.substr(s,2)===wl?(o=wl,s+=2):(o=i,q===0&&A(vg)),o!==i&&(C=e,o=CA()),e=o,e===i&&(e=s,p.charCodeAt(s)===10752?(o=Th,s++):(o=i,q===0&&A(gg)),o!==i&&(C=e,o=MA()),e=o,e===i&&(e=s,p.charCodeAt(s)===10227?(o=Sh,s++):(o=i,q===0&&A(qg)),o!==i&&(C=e,o=EA()),e=o,e===i&&(e=s,p.charCodeAt(s)===8594?(o=Ph,s++):(o=i,q===0&&A(Ag)),o!==i&&(C=e,o=TA()),e=o,e===i&&(e=s,p.charCodeAt(s)===8593?(o=Bh,s++):(o=i,q===0&&A(mg)),o!==i&&(C=e,o=SA()),e=o,e===i&&(e=s,p.charCodeAt(s)===8646?(o=xh,s++):(o=i,q===0&&A(bg)),o!==i&&(C=e,o=PA()),e=o,e===i&&(e=s,p.charCodeAt(s)===68?(o=Fh,s++):(o=i,q===0&&A(_g)),o!==i&&(C=e,o=BA()),e=o))))))))))))))))))))))))),e}function Ff(){var e;return e=p.charAt(s),Rh.test(e)?s++:(e=i,q===0&&A(wg)),e}function R1(){var e,o,h,c,y;return e=s,o=Ff(),o!==i?(h=ea(),h===i&&(h=null),c=jr(),c!==i?(y=Vr(),y!==i?(o=[o,h,c,y],e=o):(s=e,e=i)):(s=e,e=i)):(s=e,e=i),e}function is(){var e;return e=p.charAt(s),Nh.test(e)?s++:(e=i,q===0&&A(kg)),e}function N1(){var e;return e=p.charAt(s),Ih.test(e)?s++:(e=i,q===0&&A(yg)),e}function jr(){var e;return e=p.charAt(s),zh.test(e)?s++:(e=i,q===0&&A($g)),e}function Vr(){var e;return e=p.charAt(s),Lh.test(e)?s++:(e=i,q===0&&A(Cg)),e}function ea(){var e;return p.charCodeAt(s)===120?(e=Dh,s++):(e=i,q===0&&A(Mg)),e}function I1(){var e;return e=p.charAt(s),Wh.test(e)?s++:(e=i,q===0&&A(Eg)),e}var ss=[];function yt(e){var o=Object.assign(e,xA());return ss.push(o),o}function ta(e){return parseInt(e.join(""),10)}function Gr(e){return e.join("").match(/\?/)?e.join(""):ta(e)}function Mr(e){var o={};return e.forEach(function(h){for(var c in h)Array.isArray(h[c])?o[c]=o[c]?o[c].concat(h[c]):h[c]:o[c]=o[c]?Of(o[c])+" "+Df(h[c]):h[c]}),o}function Df(e){if(typeof e!="string")return e;var o=/^\s+/;return e.replace(o,"")}function Of(e){if(typeof e!="string")return e;var o=/\s+$/;return e.replace(o,"")}if(Qn=Q(),R.peg$library)return{peg$result:Qn,peg$currPos:s,peg$FAILED:i,peg$maxFailExpected:Zi,peg$maxFailPos:Lt};if(Qn!==i&&s===p.length)return Qn;throw Qn!==i&&s<p.length&&A(DA()),OA(Zi,Lt<p.length?p.charAt(Lt):null,Lt<p.length?Ks(Lt,Lt+1):Ks(Lt,Lt))}return{StartRules:["pgn","tags","game","games"],SyntaxError:F,parse:O}})})(l)),l.exports}var g=d(),v=a(g);function m(N,D){return!D||D.startRule==="games"?E(N,D):_(N,D)}function _(N,D={startRule:"game"}){try{N=N.trim();let F=v.parse(N,D),W={moves:[],messages:[]};return D.startRule==="pgn"?W.moves=F:D.startRule==="tags"?W.tags=F:W=F,$(W,N,D)}catch(F){throw b(N,D,F)}}function b(N,D,F){if(F.location&&F.location.start){const W=F.location.start.line,O=F.location.start.column,p=N.split(`
`),R=Math.max(0,W-3),i=Math.min(p.length,W+2),I=[];for(let K=R;K<i;K++){const Q=K+1;let ie=p[K]||"";Q===W&&(O<=ie.length?ie=ie.substring(0,O-1)+"**"+ie.substring(O-1):ie+="**"),I.push(`${Q}: ${ie}`)}F.errorHint=`Error at line ${W}, column ${O}:
${I.join(`
`)}`}else F.errorHint=`Error parsing PGN (no location information available): ${F.message||"Unknown error"}`;return F}function $(N,D,F){function W(p){if(F.startRule!=="tags"){let R=p.moves[p.moves.length-1];if(typeof R=="string"&&(p.moves.pop(),p.tags)){let i=p.tags.Result;i&&R!==i&&p.messages.push({key:"Result",value:i,message:"Result in tags is different to result in SAN"}),p.tags.Result=R}}return p}function O(p){function R(i){function I(ue){return ue.split(/\s+/)[1]}function K(ue,oe){function fe($e){return $e==="w"?"b":"w"}return ue.turn=oe,ue.variations&&ue.variations.forEach(function($e){let He=oe;$e.forEach(it=>He=K(it,He))}),fe(oe)}let ie=F.fen||i.tags&&i.tags.FEN||"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",G=I(ie);return i.moves.forEach(ue=>G=K(ue,G)),i}return p.moves?R(p):p}return O(W(N))}function E(N,D={startRule:"games"}){function F(O){if(!Array.isArray(O))return[];if(O.length===0)return O;let p=O.pop();return(p.tags!==void 0||p.moves.length>0)&&O.push(p),O}function W(O,p,R={startRule:"games"}){return F(O)}try{const O=Object.assign({startRule:"games"},D);let p=v.parse(N,O);return p?(W(p,N,O),p.forEach(R=>{$(R,N,O)}),p):[]}catch(O){throw b(N,D,O)}}const T=(N,D=`
`)=>N.replace(/\r?\n/g,D);function z(N,D={startRule:"games"}){let F=T(N).split(/\n\n+/),W=[],O={tags:"",pgn:"",all:""};return F.forEach(function(p){if(p.startsWith("["))O.tags=p;else if(p){O.pgn=p;let R=O.tags?O.tags+`

`+O.pgn:O.pgn;O.all=R,W.push(O),O={tags:"",pgn:"",all:""}}}),W}n.parse=m,n.parseGame=_,n.parseGames=E,n.split=z}))})(ni,ni.exports)),ni.exports}var d_=p_();function Yu(t,r,n,a){if(t){for(let l=0;l<t.length;l++){const f=t[l],u=[...r,l],d=n.move(f.notation.notation);if(!d)continue;Object.assign(f,{pgnPath:u,before:d.before,after:d.after,from:d.from,to:d.to,flags:d.flags,san:d.san,promotion:d.promotion?.toUpperCase()??void 0,history:n.history(),isCheck:n.inCheck(),isCheckmate:n.isCheckmate(),isStalemate:n.isStalemate(),isThreefoldRepetition:n.isThreefoldRepetition(),isDraw:n.isDraw()});const g=u.join(",");a.set(g,f),f.variations&&f.variations.forEach((v,m)=>{const _=[...u,"v",m];n.undo(),Yu(v,_,n,a),n.move(f.notation.notation)})}for(let l=0;l<t.length;l++)n.undo()}}function v_(t,r,n,a,l){l.move(t);const f=l.moveNumber();let u;if(r.length===0)u=[0];else{const b=r.at(-1);u=r.with(-1,b+1)}const d=n.get(u.join(",")),g=d&&d.turn===t.color;let v;if(g){d.variations||(d.variations=[]);const b=d.variations.length;v=[...u,"v",b,0]}else v=u;const m=t.san.match(/=([QRBN])/),_={moveNumber:f,notation:{check:t.san.includes("+")?"+":void 0,notation:t.san,fig:t.piece,strike:t.san.includes("x")?"x":null,col:t.to[0],row:t.to[1],promotion:m?m[0]:null},turn:t.color,before:t.before,after:t.after,from:t.from,to:t.to,flags:t.flags,san:t.san,promotion:t.promotion?.toUpperCase()??void 0,variations:[],nag:[],pgnPath:v,history:l.history(),isCheck:l.inCheck(),isCheckmate:l.isCheckmate(),isStalemate:l.isStalemate(),isThreefoldRepetition:l.isThreefoldRepetition(),isDraw:l.isDraw()};if(g){d.variations.push([_]);const $=d.variations.at(-1)[0];n.set(v.join(","),$)}else if(v.length===1){a.push(_);const b=a.at(-1);n.set(v.join(","),b)}else{const b=v.slice(0,-3);if(b.length===0&&v.length>1&&typeof v[1]=="number"){a.push(_);const $=a.at(-1);n.set(v.join(","),$)}else if(b.length>0){const $=n.get(b.join(",")),E=v.at(-2);if($&&$.variations[E]){$.variations[E].push(_);const T=$.variations[E].at(-1);n.set(v.join(","),T)}}else if(v.every($=>typeof $=="number")){a.push(_);const $=a.at(-1);n.set(v.join(","),$)}}return v}const g_="data:image/webp;base64,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",q_="data:image/webp;base64,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",lc="data:image/webp;base64,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",A_="data:image/webp;base64,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",m_="data:image/webp;base64,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";function Hu(t){return t in hi}const hi={$1:["Good move","!",g_],$2:["Poor move","?",A_],$3:["Excellent move","!!",q_],$4:["Blunder","??",lc],$5:["Interesting move","!?"],$6:["Dubious move","?!",m_],$7:["Forced move","+"],$8:["The only move","â¡"],$9:["Worst move","???",lc],$10:["Drawish position","="],$11:["Equal chances, quiet position","="],$12:["Equal chances, active position","â"],$13:["Unclear position","â"],$14:["White has a slight advantage","â©²"],$15:["Black has a slight advantage","â©±"],$16:["White has a moderate advantage","Â±"],$17:["Black has a moderate advantage","â"],$18:["White has a decisive advantage","+-"],$19:["Black has a decisive advantage","-+"],$20:["White has a crushing advantage","+--"],$21:["Black has a crushing advantage","--+"],$22:["White is in zugzwang","â¨"],$23:["Black is in zugzwang","â¨"],$24:["White has a slight space advantage","â"],$25:["Black has a slight space advantage","â"],$26:["White has a moderate space advantage","ââ"],$27:["Black has a moderate space advantage","ââ"],$28:["White has a decisive space advantage","âââ"],$29:["Black has a decisive space advantage","âââ"],$30:["White has a slight development advantage","â»"],$31:["Black has a slight development advantage","âº"],$32:["White has a moderate development advantage","â³"],$33:["Black has a moderate development advantage","â³"],$34:["White has a decisive development advantage","â»â»â»"],$35:["Black has a decisive development advantage","âºâºâº"],$36:["White has the initiative","â"],$37:["Black has the initiative","â"],$38:["White has a lasting initiative","â"],$39:["Black has a lasting initiative","â"],$40:["White has the attack","â"],$41:["Black has the attack","â"],$42:["White has insufficient compensation","â¯"],$43:["Black has insufficient compensation","â¯"],$44:["White has sufficient compensation","=/="],$45:["Black has sufficient compensation","=/="],$46:["White has more than adequate compensation","$"],$47:["Black has more than adequate compensation","$"],$48:["White has a slight center control advantage","â"],$49:["Black has a slight center control advantage","â"],$50:["White has a moderate center control advantage","ââ"],$51:["Black has a moderate center control advantage","ââ"],$52:["White has a decisive center control advantage","âââ"],$53:["Black has a decisive center control advantage","âââ"],$54:["White has a slight kingside control advantage","â§©"],$55:["Black has a slight kingside control advantage","â§©"],$56:["White has a moderate kingside control advantage","â§«"],$57:["Black has a moderate kingside control advantage","â§«"],$58:["White has a decisive kingside control advantage","â"],$59:["Black has a decisive kingside control advantage","â"],$60:["White has a slight queenside control advantage","â§¨"],$61:["Black has a slight queenside control advantage","â§¨"],$62:["White has a moderate queenside control advantage","â§ª"],$63:["Black has a moderate queenside control advantage","â§ª"],$64:["White has a decisive queenside control advantage","â"],$65:["Black has a decisive queenside control advantage","â"],$66:["White has a vulnerable first rank","+"],$67:["Black has a vulnerable first rank","+"],$68:["White has a well protected first rank","+"],$69:["Black has a well protected first rank","+"],$70:["White has a poorly protected king","+"],$71:["Black has a poorly protected king","+"],$72:["White has a well protected king","+"],$73:["Black has a well protected king","+"],$74:["White has a poorly placed king","+"],$75:["Black has a poorly placed king","+"],$76:["White has a well placed king","+"],$77:["Black has a well placed king","+"],$78:["White has a very weak pawn structure","+"],$79:["Black has a very weak pawn structure","+"],$80:["White has a moderately weak pawn structure","+"],$81:["Black has a moderately weak pawn structure","+"],$82:["White has a moderately strong pawn structure","+"],$83:["Black has a moderately strong pawn structure","+"],$84:["White has a very strong pawn structure","+"],$85:["Black has a very strong pawn structure","+"],$86:["White has poor knight placement","+"],$87:["Black has poor knight placement","+"],$88:["White has good knight placement","+"],$89:["Black has good knight placement","+"],$90:["White has poor bishop placement","+"],$91:["Black has poor bishop placement","+"],$92:["White has good bishop placement","â"],$93:["Black has good bishop placement","â"],$94:["White has poor rook placement","+"],$95:["Black has poor rook placement","+"],$96:["White has good rook placement","â"],$97:["Black has good rook placement","â"],$98:["White has poor queen placement","+"],$99:["Black has poor queen placement","+"],$100:["White has good queen placement","+"],$101:["Black has good queen placement","+"],$102:["White has poor piece coordination","+"],$103:["Black has poor piece coordination","+"],$104:["White has good piece coordination","+"],$105:["Black has good piece coordination","+"],$106:["White has played the opening very poorly","+"],$107:["Black has played the opening very poorly","+"],$108:["White has played the opening poorly","+"],$109:["Black has played the opening poorly","+"],$110:["White has played the opening well","+"],$111:["Black has played the opening well","+"],$112:["White has played the opening very well","+"],$113:["Black has played the opening very well","+"],$114:["White has played the middlegame very poorly","+"],$115:["Black has played the middlegame very poorly","+"],$116:["White has played the middlegame poorly","+"],$117:["Black has played the middlegame poorly","+"],$118:["White has played the middlegame well","+"],$119:["Black has played the middlegame well","+"],$120:["White has played the middlegame very well","+"],$121:["Black has played the middlegame very well","+"],$122:["White has played the ending very poorly","+"],$123:["Black has played the ending very poorly","+"],$124:["White has played the ending poorly","+"],$125:["Black has played the ending poorly","+"],$126:["White has played the ending well","+"],$127:["Black has played the ending well","+"],$128:["White has played the ending very well","+"],$129:["Black has played the ending very well","+"],$130:["White has slight counterplay","â"],$131:["Black has slight counterplay","â"],$132:["White has moderate counterplay","ââ"],$133:["Black has moderate counterplay","ââ"],$134:["White has decisive counterplay","âââ"],$135:["Black has decisive counterplay","âââ"],$136:["White has moderate time control pressure","â"],$137:["Black has moderate time control pressure","â"],$138:["White has severe time control pressure","ââ"],$139:["Black has severe time control pressure","ââ"]};function on(t){const r=t;let n;if(!r.length)n=[0];else{let a=r.at(-1);n=r.with(-1,++a)}return n}function ao(t){const r=t;let n=r;if(!r.length)return r;let a=r.at(-1);return a===0?r.length===1?n=[]:(a=r.at(-4),a===0?n=[]:n=[...r.slice(0,-4),--a]):n=r.with(-1,--a),n}function b_(t){return t.split(" ")[1]}function Ju(t,r){const a=new Un(r).moves({verbose:!0});return typeof t=="string"?a.some(l=>l.san===t||l.lan===t):a.some(l=>l.from===t.from&&l.to===t.to&&(!t.promotion||l.promotion===t.promotion))}function __(t,r){return Ju(t,r)?new Un(r).move(t):null}function w_(t,r,n){if(cu.includes(t)){const l=new Un(n).get(t);if(!l||l.type!=="p")return!1;const f=r.charAt(1);if(l.color==="w"&&f==="8"||l.color==="b"&&f==="1")return!0}else console.error("Invalid square passed:",t,r);return!1}function k_(t){function r(l){return typeof l=="object"&&l!==null}const n=new Map,a=new Un(t);return cu.forEach(l=>{const u=a.moves({square:l,verbose:!0}).filter(r);u.length&&n.set(l,u.map(d=>d.to))}),n}const Zu=["$2","$4","$6","$9"],y_=["$3","$1"],$_=["stockfish","stockfishAlt","mainLine","altLine","blunderLine"];function fc(t,r){let n;if(t.nag){const a=t.nag.find(Hu);a&&hi[a][2]&&(n={html:`<image href="${hi[a][2]}" width="50%" height="50%" />`,center:"dest"})}return{orig:t.from,dest:t.to,brush:r,san:t.san,customSvg:n}}function cc(t){const r=t.some(l=>Zu.includes(l)),n=t.some(l=>y_.includes(l));let a=null;return r?a="blunderLine":n&&(a="goodLine"),a}function C_(t){const r=ao(t);return on(r)}function uc(t,r){return t?.turn===r?.turn&&t?.moveNumber===r?.moveNumber&&t?.notation.notation===r?.notation.notation}function M_(t,r,n){const a=[],l=n!=="Puzzle"?on(t):t,f=n!=="Puzzle"?l.join(","):C_(l).join(","),u=r.get(f);if(!u)return a;u.variations&&u.variations.length>0&&u.variations.forEach(m=>{const _=m[0],b=_.nag||[],E=!(n==="Puzzle"&&uc(_,r.get(t.join(","))))?cc(b):"nagOnly";a.push(fc(_,E??"altLine"))});const d=u.nag||[],v=!(n==="Puzzle"&&uc(u,r.get(t.join(","))))?cc(d):"nagOnly";return a.push(fc(u,v??"mainLine")),a}const E_="data:audio/mpeg;base64,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",T_=""+new URL("_castle.mp3",import.meta.url).href,S_=""+new URL("_check.mp3",import.meta.url).href,P_=""+new URL("_checkmate.mp3",import.meta.url).href,B_=""+new URL("_computer-mouse-click.mp3",import.meta.url).href,x_="data:audio/mpeg;base64,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",F_="data:audio/mpeg;base64,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",D_=""+new URL("_promote.mp3",import.meta.url).href,O_=`<script>
  window.CARD_CONFIG = {
    "modelName": "{{Type}}",
    "cardName": "{{Card}}",
  };
  // __USER_CONFIG__
<\/script>
<script type="module" crossorigin src="./_chess3.0__VERSION__.js"><\/script>
<div id="anki-chess-root" data-boardMode="Puzzle"></div>

<div id="anki-pgn" style="display: none;">{{PGN}}</div>
{{#textField}}
<div id="anki-textField" style="display: none;">{{textField}}</div>
{{/textField}}

<script>
  (async () => {
    const attemptMount = () => {
      if (window.mountChess) {
        window.mountChess();
      } else {
        setTimeout(attemptMount, 20);
      }
    };
    attemptMount();
  })();
<\/script>
`,U_=`@import url("./_chess3.0__VERSION__.css");

#content {
margin:0 !important;
}
`,R_=!0,N_=!1,I_=!0,z_=!1,L_=!0,W_=200,K_=2,j_=!1,V_=!1,G_=!1,Q_=!1,Y_=!0,H_=1e4,J_=1e3,Z_=!1,X_=10,ew=1,tw=!1,rw=null,nw=!0,iw={flipBoard:R_,mirror:N_,showDests:I_,disableArrows:z_,singleClickMove:L_,animationTime:W_,handicap:K_,autoAdvance:j_,handicapAdvance:V_,timerAdvance:G_,strictScoring:Q_,acceptVariations:Y_,timer:H_,increment:J_,randomOrientation:Z_,analysisTime:X_,analysisLines:ew,muteAudio:tw,background:rw,frontText:nw};async function sw(t,r,n,a=null){const l="http://127.0.0.1:8765",f=a?`.${a}`:"",u={...iw,...n},d=`window.USER_CONFIG = ${JSON.stringify(u,null,2)};`;let g=O_.replace("// __USER_CONFIG__",d).replaceAll("__VERSION__",f);const v=g.replace('data-boardMode="Puzzle"','data-boardMode="Viewer"'),m=U_.replaceAll("__VERSION__",f);try{const b=await(await fetch(l,{method:"POST",body:JSON.stringify({action:"modelTemplates",version:6,params:{modelName:t}})})).json();if(b.error)throw new Error(`Fetch Model Failed: ${b.error}`);const E=await(await fetch(l,{method:"POST",body:JSON.stringify({action:"updateModelTemplates",version:6,params:{model:{name:t,templates:{[r]:{Front:g,Back:v}},css:m}}})})).json();if(E.error)throw new Error(E.error);console.log(`Updated Template for "${t}" (v=${a})`)}catch(_){console.error("AnkiConnect Template Update Failed:",_)}}class aw{#e=le(!1);get flipBoard(){return w(this.#e)}set flipBoard(r){H(this.#e,r,!0)}#t=le(!1);get mirror(){return w(this.#t)}set mirror(r){H(this.#t,r,!0)}#r=le(!0);get showDests(){return w(this.#r)}set showDests(r){H(this.#r,r,!0)}disableArrows=!1;singleClickMove=!0;animationTime=200;#n=le(1);get handicap(){return w(this.#n)}set handicap(r){H(this.#n,r,!0)}autoAdvance=!1;handicapAdvance=!1;timerAdvance=!1;strictScoring=!1;acceptVariations=!0;#o=le(5e3);get timer(){return w(this.#o)}set timer(r){H(this.#o,r,!0)}#i=le(1e3);get increment(){return w(this.#i)}set increment(r){H(this.#i,r,!0)}randomOrientation=!1;#l=le(4);get analysisTime(){return w(this.#l)}set analysisTime(r){H(this.#l,r,!0)}#s=le(1);get analysisLines(){return w(this.#s)}set analysisLines(r){H(this.#s,r,!0)}#a=le(!1);get muteAudio(){return w(this.#a)}set muteAudio(r){H(this.#a,r,!0)}background=null;#f=le(!0);get frontText(){return w(this.#f)}set frontText(r){H(this.#f,r,!0)}#c=le(0);get boardKey(){return w(this.#c)}set boardKey(r){H(this.#c,r,!0)}#h=le(Vt({}));get lastSavedState(){return w(this.#h)}set lastSavedState(r){H(this.#h,r,!0)}#u=ye(()=>Object.keys(this.lastSavedState).some(r=>this[r]!==void 0&&this[r]!==this.lastSavedState[r]));get saveDue(){return w(this.#u)}set saveDue(r){H(this.#u,r)}constructor(){typeof window<"u"&&window.USER_CONFIG&&(this.applyConfig(window.USER_CONFIG),this.lastSavedState={...window.USER_CONFIG})}applyConfig(r){Object.keys(r).forEach(n=>{this[n]!==void 0&&(this[n]=r[n])})}save(){if(typeof window>"u")return;const r={};Object.keys(this.lastSavedState).forEach(n=>{this[n]!==void 0&&(r[n]=this[n])}),window.USER_CONFIG=r,this.lastSavedState={...r},window.CARD_CONFIG?sw(window.CARD_CONFIG.modelName,window.CARD_CONFIG.cardName,r):console.warn("Cannot save: window.CARD_CONFIG is missing (not inside Anki?)")}}const ae=new aw,hc={checkmate:"checkmate",promote:"promote",castle:"castle",capture:"capture",check:"check",move:"move"},ow=[{event:"checkmate",condition:t=>t.includes("#")},{event:"check",condition:t=>t.includes("+")},{event:"promote",condition:(t,r)=>r.includes("p")},{event:"castle",condition:(t,r)=>r.includes("k")||r.includes("q")},{event:"capture",condition:(t,r)=>r.includes("c")||r.includes("e")}],pc=Object.assign({"/src/assets/audio/_capture.mp3":E_,"/src/assets/audio/_castle.mp3":T_,"/src/assets/audio/_check.mp3":S_,"/src/assets/audio/_checkmate.mp3":P_,"/src/assets/audio/_computer-mouse-click.mp3":B_,"/src/assets/audio/_error.mp3":x_,"/src/assets/audio/_move.mp3":F_,"/src/assets/audio/_promote.mp3":D_});function lw(){const t=["move","checkmate","check","capture","castle","promote","error","computer-mouse-click"],r=new Map;return t.forEach(n=>{const a=Object.keys(pc).find(l=>l.endsWith(`_${n}.mp3`));if(a){const l=pc[a],f=new Audio(l);f.preload="auto",r.set(n,f)}else console.warn(`Audio file for "${n}" not found.`)}),r}const fw=lw();function Rr(t){if(ae.muteAudio)return;const r=fw.get(t);r&&r.cloneNode().play().catch(a=>{a.name==="NotAllowedError"?console.warn(`Audio "${t}" blocked by browser. Waiting for user interaction.`):console.error(`Could not play sound: ${t}`,a)})}function cw(t){if(ae.muteAudio)return;const r=ow.find(a=>a.condition(t.san,t.flags)),n=r?hc[r.event]:hc.move;Rr(n)}function uw(){const t=["original","original_mirror","invert","invert_mirror"],r=Math.floor(Math.random()*t.length);return t[r]}function hw(t){const r=t.split(" ");return r.length<3?!1:r[2]!=="-"}function pw(t){return t.split("").reverse().join("")}function dw(t,r){if(r==="original")return t;const n=t.split(" "),a=n[0],l=n[1],f=n.slice(2).join(" "),u=a.split("/"),d=dc(a.split("").reverse().join("")),g=u.map(pw).join("/"),v=dc(g.split("").reverse().join("")),m=l==="w"?"b":"w";switch(r){case"invert_mirror":return`${v} ${m} ${f}`;case"invert":return`${d} ${m} ${f}`;case"original_mirror":return`${g} ${l} ${f}`;default:return t}}function dc(t){return t.split("").map(r=>r===r.toLowerCase()?r.toUpperCase():r.toLowerCase()).join("")}function pa(t,r){const a={invert_mirror:{q:"q",a:"a",b:"b",c:"c",d:"d",e:"e",f:"f",g:"g",h:"h",1:"8",2:"7",3:"6",4:"5",5:"4",6:"3",7:"2",8:"1"},invert:{q:"q",a:"h",b:"g",c:"f",d:"e",e:"d",f:"c",g:"b",h:"a",1:"8",2:"7",3:"6",4:"5",5:"4",6:"3",7:"2",8:"1"},original_mirror:{q:"q",a:"h",b:"g",c:"f",d:"e",e:"d",f:"c",g:"b",h:"a",1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8"},original:{q:"q",a:"a",b:"b",c:"c",d:"d",e:"e",f:"f",g:"g",h:"h",1:"1",2:"2",3:"3",4:"4",5:"5",6:"6",7:"7",8:"8"}}[r];function l(f){if(f!==void 0)return f.split("").map(u=>a[u]||u).join("")}t.notation.disc=t.notation.disc??l(t.notation.disc),t.notation.col=l(t.notation.col),t.notation.row=t.notation.row??l(t.notation.row),t.notation.notation=l(t.notation.notation)??t.notation.notation}function Xu(t,r,n=null){if(!t||t.length===0)return;for(const u of t)u.variations&&u.variations.forEach(d=>{Xu(d,r,u)});if(!(r==="invert"||r==="invert_mirror")){for(const u of t)pa(u,r);return}let l;t[0].turn==="w"?t.forEach((u,d)=>{pa(u,r),u.turn==="w"?(u.turn="b",d===0?(u.moveNumber--,l=u.moveNumber):delete u.moveNumber):(u.turn="w",u.moveNumber=l+1,l=u.moveNumber)}):(l=n?.moveNumber??t[0].moveNumber??0,t.forEach((u,d)=>{pa(u,r),u.turn==="b"?(u.turn="w",u.moveNumber||(u.moveNumber=d===0?l:l+1),l=u.moveNumber):(u.turn="b",delete u.moveNumber)}))}function vw(t){return 1/(1+Math.pow(10,-t/400))*100}class gw{#e=le(!1);get enabled(){return w(this.#e)}set enabled(r){H(this.#e,r,!0)}#t=le(!1);get isThinking(){return w(this.#t)}set isThinking(r){H(this.#t,r,!0)}#r=le(!1);get loading(){return w(this.#r)}set loading(r){H(this.#r,r,!0)}#n=le(1);get multipv(){return w(this.#n)}set multipv(r){H(this.#n,r,!0)}multipvOptions=[1,2,3,4,5];#o=le("");get evalFen(){return w(this.#o)}set evalFen(r){H(this.#o,r,!0)}#i=le(Vt([]));get analysisLines(){return w(this.#i)}set analysisLines(r){H(this.#i,r,!0)}#l=le(Vt(ae.analysisTime));get analysisThinkingTime(){return w(this.#l)}set analysisThinkingTime(r){H(this.#l,r,!0)}thinkingTimeOptions=[1,5,10,30,60,300];_worker=null;_currentFen="";_pendingFen=null;constructor(){if(typeof window>"u")return;const r=sessionStorage.getItem("chess_multipv")??null;r&&this.setMultiPv(parseInt(r,10));const n=sessionStorage.getItem("chess_analysisTime")??null;n&&(this.analysisThinkingTime=parseInt(n,10)),this.analysisThinkingTime=this._getClosestTime(this.analysisThinkingTime)}#s=ye(()=>{const r=this.analysisLines.find(n=>n.id===1);return!r||!r.firstMove?null:{...r.firstMove,fen:this.evalFen}});get bestMove(){return w(this.#s)}set bestMove(r){H(this.#s,r)}#a=ye(()=>{if(!this.enabled)return[];const r=this.evalFen.split(" ")[1];return[...this.analysisLines].reverse().map(a=>{if(!a.firstMove)return null;let l="stockfish",f="#66AA66";if(!this.isThinking&&a.id===1)f="indianred";else switch(a.id){case 1:l="stockfish",f="#66AA66";break;default:l="stockfishAlt",f="#66AAAA";break}let u=a.winChance;r==="b"&&(u=100-a.winChance);const d=4+u/10;return{orig:a.firstMove.from,dest:a.firstMove.to,san:a.firstMove.san,brush:l,modifiers:{lineWidth:Math.round(d*10)/10,hilite:f}}}).filter(a=>a!==null)});get shapes(){return w(this.#a)}set shapes(r){H(this.#a,r)}setMultiPv(r){r<1&&(r=1),r>5&&(r=5),this.multipv=r,ae.analysisLines=r,typeof window<"u"&&sessionStorage.setItem("chess_multipv",r),this._restart()}setThinkingTime(r){r<1&&(r=1),r>300&&(r=300),ae.analysisTime=r,this.analysisThinkingTime=r,typeof window<"u"&&sessionStorage.setItem("chess_analysisTime",r),this._restart()}async toggle(r){if(this.enabled){this.enabled=!1,this.stop();return}if(this._worker)this.enabled=!0,this.analyze(r);else{this.loading=!0;try{await this._initWorker(),this.enabled=!0,this.loading=!1,this.analyze(r)}catch(n){console.error("Engine failed to initialize",n),this.loading=!1,this.enabled=!1}}}analyze(r){br(()=>{!this.enabled||!this._worker||this.loading||this.isThinking&&this._currentFen===r&&!this._pendingFen||(this._pendingFen=r,this.isThinking?this._worker.postMessage("stop"):this._processPending())})}stop(){this._pendingFen=null,this._worker?.postMessage("stop"),this.isThinking=!1}_restart(){if(this.enabled&&this._currentFen){const r=this._currentFen;this._currentFen="",this.analyze(r)}}_getClosestTime(r){return this.thinkingTimeOptions.reduce((n,a)=>Math.abs(a-r)<Math.abs(n-r)?a:n)}_processPending(){if(!this._pendingFen||!this._worker)return;const r=this._pendingFen;this._pendingFen=null,this._currentFen=r,this.evalFen=r,this.analysisLines=[],this.isThinking=!0,this._worker.postMessage(`position fen ${r}`),this._worker.postMessage(`setoption name MultiPV value ${this.multipv}`),this._worker.postMessage(`go movetime ${this.analysisThinkingTime*1e3}`)}_initWorker(){return new Promise((r,n)=>{this._worker=new Worker("/_stockfish.js"),this._worker.onerror=a=>n(a),this._worker.onmessage=a=>{const l=a.data;l==="uciok"?this._worker?.postMessage("isready"):l==="readyok"&&(this._worker.onmessage=f=>this._handleEngineMessage(f),r())},this._worker.postMessage("uci")})}_handleEngineMessage(r){const n=r.data;typeof n=="string"&&(n.startsWith("info")&&n.includes("pv")?this._parseInfo(n):n.startsWith("bestmove")&&this._parseBestMove(n))}_parseInfo(r){if(!this._pendingFen)try{const n=r.split(" ");let a=1;const l=n.indexOf("multipv");l>-1&&n[l+1]&&(a=parseInt(n[l+1],10));let f=0,u=!1,d=50;const g=this._currentFen.split(" ")[1],v=n.indexOf("mate"),m=n.indexOf("cp");if(v>-1&&n[v+1]){u=!0,f=parseInt(n[v+1],10);const W=f>0;g==="w"?d=W?100:0:d=W?0:100}else if(m>-1&&n[m+1]){f=parseInt(n[m+1],10);const W=vw(f);g==="w"?d=W:d=100-W}const _=g==="w"?f:-f,b=n.indexOf("pv");let $="",E="",T=null;if(b>-1){const W=n.slice(b+1);$=W.join(" ");const O=[],p=new Un(this._currentFen);for(const R of W){if(R.length<4)break;const i=R.substring(0,2),I=R.substring(2,4),K=R.length>4?R.substring(4,5):void 0;try{const Q=p.move({from:i,to:I,promotion:K});Q&&(O.push(Q.san),T||(T={from:i,to:I,san:Q.san}))}catch{break}}E=O.join(" ")}const z={id:a,scoreRaw:f,scoreNormalized:_,isMate:u,winChance:d,pvRaw:$,pvSan:E,firstMove:T},F=[...[...this.analysisLines].filter(W=>W.id!==a),z].sort((W,O)=>W.id-O.id);this.analysisLines=F}catch{}}_parseBestMove(r){this.isThinking=!1,this._pendingFen&&this._processPending()}}const ke=new gw;class qw{#e=le(!1);get isRunning(){return w(this.#e)}set isRunning(r){H(this.#e,r,!0)}#t=le(!1);get isOutOfTime(){return w(this.#t)}set isOutOfTime(r){H(this.#t,r,!0)}#r=le(0);get remainingTime(){return w(this.#r)}set remainingTime(r){H(this.#r,r,!0)}#n=le(0);get totalTime(){return w(this.#n)}set totalTime(r){H(this.#n,r,!0)}#o=le(!1);get visible(){return w(this.#o)}set visible(r){H(this.#o,r,!0)}animationFrameId=null;lastTickTimestamp=null;#i=ye(()=>{if(this.totalTime===0)return 0;const r=100-this.remainingTime/this.totalTime*100;return Math.min(Math.max(r,0),100)});get percent(){return w(this.#i)}set percent(r){H(this.#i,r)}start(r=ae.timer){this.stop(),this.totalTime=r,this.remainingTime=r,this.visible=!0,this.isRunning=!0,this.animationFrameId=requestAnimationFrame(n=>this.loop(n))}stop(){this.isRunning=!1,this.visible=!1,this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.lastTickTimestamp=null}pause(){this.isRunning=!1,this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),this.lastTickTimestamp=null}resume(){this.remainingTime>0&&!this.isRunning&&(this.isRunning=!0,this.animationFrameId=requestAnimationFrame(r=>this.loop(r)))}extend(r=ae.increment,n=ae.animationTime+100){if(!this.visible||!this.isRunning)return;this.pause();const a=this.remainingTime,l=this.totalTime,f=a+r,u=Math.max(l,f),d=performance.now(),g=v=>{const m=v-d,_=Math.min(m/n,1),b=1-Math.pow(1-_,3);this.remainingTime=a+(f-a)*b,this.totalTime=l+(u-l)*b,_<1?this.animationFrameId=requestAnimationFrame(g):(this.remainingTime=f,this.totalTime=u,this.animationFrameId=null,this.resume())};this.animationFrameId=requestAnimationFrame(g)}loop(r){if(!this.isRunning)return;this.lastTickTimestamp||(this.lastTickTimestamp=r);const n=r-this.lastTickTimestamp;this.lastTickTimestamp=r,this.remainingTime=Math.max(0,this.remainingTime-n),this.remainingTime===0?this.handleOutOfTime():this.animationFrameId=requestAnimationFrame(a=>this.loop(a))}handleOutOfTime(){this.isOutOfTime=!0,this.stop()}}const Ot=new qw;class Aw{cg=null;#e=le("");get rawPgn(){return w(this.#e)}set rawPgn(r){H(this.#e,r,!0)}#t=le("");get boardMode(){return w(this.#t)}set boardMode(r){H(this.#t,r,!0)}aiDelayTime=ae.animationTime+100;#r=le(void 0);get rootGame(){return w(this.#r)}set rootGame(r){H(this.#r,r,!0)}#n=le(Vt([]));get pgnPath(){return w(this.#n)}set pgnPath(r){H(this.#n,r,!0)}#o=le("white");get orientation(){return w(this.#o)}set orientation(r){H(this.#o,r,!0)}#i=le(0);get errorCount(){return w(this.#i)}set errorCount(r){H(this.#i,r,!0)}#l=le(void 0);get selectedPiece(){return w(this.#l)}set selectedPiece(r){H(this.#l,r,!0)}startFen=si;chess=this.newChess(this.startFen);playerColor="white";opponentColor="black";#s=le(null);get pendingPromotion(){return w(this.#s)}set pendingPromotion(r){H(this.#s,r,!0)}_mirrorState="original";_puzzleScore=null;_hasMadeMistake=!1;_moveMap=new Map;#a=le(Vt([]));get _displayedShapes(){return w(this.#a)}set _displayedShapes(r){H(this.#a,r,!0)}#f=ye(()=>[...ke.bestMove?.fen===this.fen?ke.shapes:[],...M_(this.pgnPath,this._moveMap,this.boardMode)]);get _rawShapes(){return w(this.#f)}set _rawShapes(r){H(this.#f,r)}constructor(r,n){const a=sessionStorage.getItem("chess_puzzle_score");n!=="Puzzle"&&(this._puzzleScore=a??null),a&&sessionStorage.removeItem("chess_puzzle_score"),this.rawPgn=r,this.boardMode=n;const l=this.parsePGN(r,n);l?.tags?.FEN&&(this.startFen=l.tags.FEN),this.rootGame=l,Yu(this.rootGame.moves,[],this.newChess(this.startFen),this._moveMap),this.rootGame?.moves,$t(()=>{this.boardMode==="Puzzle"&&(this.turn===this.playerColor[0]||!this.pgnPath.length)||(this._displayedShapes=this._rawShapes)})}#c=ye(()=>this.boardMode==="Puzzle"&&!this.hasNext);get isPuzzleComplete(){return w(this.#c)}set isPuzzleComplete(r){H(this.#c,r)}#h=ye(()=>this.pgnPath.join(","));get currentPathKey(){return w(this.#h)}set currentPathKey(r){H(this.#h,r)}#u=ye(()=>this._moveMap.get(this.currentPathKey)||null);get currentMove(){return w(this.#u)}set currentMove(r){H(this.#u,r)}#d=ye(()=>this.currentMove?.after??this.startFen);get fen(){return w(this.#d)}set fen(r){H(this.#d,r)}#p=ye(()=>this.currentMove?this.currentMove.turn==="w"?"b":"w":this.rootGame?b_(this.startFen):"w");get turn(){return w(this.#p)}set turn(r){H(this.#p,r)}next(){this.hasNext&&(this.pgnPath=on(this.pgnPath))}prev(){this.pgnPath.length>0&&(this.pgnPath=ao(this.pgnPath))}reset(){this.pgnPath=[]}replayHistory(){const r=this.newChess(this.startFen);return this.currentMove?.history?.forEach(a=>r.move(a)),r}get hasNext(){const r=on(this.pgnPath);return this._moveMap.has(r.join(","))}get systemShapes(){return this._displayedShapes}get puzzleScore(){return this._puzzleScore?this._puzzleScore:this.boardMode!=="Puzzle"?this._puzzleScore:(!this._hasMadeMistake&&(this.errorCount>0||Ot.isOutOfTime)?(this._hasMadeMistake=!0,ae.strictScoring&&(this._puzzleScore="incorrect")):this.currentMove?.nag?.some(r=>Zu.includes(r))&&this.currentMove?.turn===this.playerColor[0]?this._puzzleScore="incorrect":this.errorCount>ae.handicap?this._puzzleScore="incorrect":this.isPuzzleComplete&&(this._puzzleScore=this._hasMadeMistake||ae.strictScoring?"correct":"perfect"),this._puzzleScore)}get rootMoves(){return this.rootGame?.moves}get dests(){return k_(this.fen)}get inCheck(){return this.currentMove?this.currentMove.isCheck:this.newChess(this.startFen).inCheck()}get isCheckmate(){return this.currentMove?.isCheckmate??!1}get isDraw(){return this.currentMove?.isDraw??!1}get isThreefoldRepetition(){return this.currentMove?.isThreefoldRepetition??!1}get isGameOver(){return this.currentMove?this.currentMove.isCheckmate||this.currentMove.isStalemate||this.currentMove.isDraw:!1}parsePGN(r=this.rawPgn,n=this.boardMode){ae.boardKey++;const a=d_.parse(r,{startRule:"game"});let l=a.tags?.FEN??si;if(n==="Puzzle"&&ae.mirror&&!hw(l))this._mirrorState=uw(),sessionStorage.setItem("chess__mirrorState",this._mirrorState);else if(n!=="Puzzle"){const f=sessionStorage.getItem("chess__mirrorState")??null;f&&(this._mirrorState=f,sessionStorage.removeItem("chess__mirrorState"))}return this._mirrorState!=="original"&&(l=dw(l,this._mirrorState),Xu(a.moves,this._mirrorState)),this.orientation=a?.moves[0]?.turn==="w"?ae.flipBoard?"black":"white":ae.flipBoard?"white":"black",this.playerColor=this.orientation,this.opponentColor=this.playerColor==="white"?"black":"white",a}getMoveByPath(r){const n=r.join(",");return this._moveMap.get(n)||null}toggleOrientation(){this.orientation=this.orientation==="white"?"black":"white",Rr("castle")}addMove(r){if(!this.rootGame)return;const n=this.replayHistory(),a=v_(r,this.pgnPath,this._moveMap,this.rootGame.moves,n);this.pgnPath=a}setPendingPromotion(r,n){this.pendingPromotion={from:r,to:n}}cancelPromotion(){this.pendingPromotion=null,this.pgnPath=[...this.pgnPath]}newChess(r){return new Un(r)}}const mw={Q:"queen",R:"rook",B:"bishop",N:"knight"},eh={w:"white",b:"black"};function ps(t,r,n){r.set({check:t.inCheck,turnColor:t.turn==="w"?"white":"black",movable:{color:t.boardMode==="Puzzle"?t.playerColor:t.turn==="w"?"white":"black",dests:t.dests},lastMove:n?[n.from,n.to]:[]})}function bw(t,r,n){const a=mw[n],l=eh[r.turn];if(t.state.pieces.get(r.to)?.role==="pawn"){t.set({animation:{enabled:!1}}),t.set({fen:r.after}),t.set({animation:{enabled:!0}});return}t.move(r.from,r.to);const u=ae.animationTime;setTimeout(()=>{t.set({animation:{enabled:!1}});const d=new Map;d.set(r.to,{role:a,color:l,promoted:!0}),t.setPieces(d),t.set({animation:{enabled:!0}})},u)}function _w(t,r,n){const a=eh[n.turn];r.set({animation:{enabled:!1}});const l=new Map;l.set(n.to,{role:"pawn",color:a,promoted:!0}),r.setPieces(l),r.set({animation:{enabled:!0},fen:n.before})}function ww(t,r,n){const a=t.pgnPath,l=t.currentMove,f=t.fen;if(n===null){r.set({animation:{enabled:!1}}),r.set({fen:t.fen}),r.set({animation:{enabled:!0}}),ps(t,r,l);return}const u=ao(n);if(n.length>0&&a.length===u.length&&a.every((g,v)=>g===u[v])){Rr("move");const g=t.getMoveByPath(n);g?.promotion?_w(t,r,g):r.set({fen:f})}else{if(!l){n?.length&&Rr("move"),r.set({fen:f}),ps(t,r,l);return}(t.getMoveByPath(n)?.after??t.startFen)===l.before?(cw(l),l.promotion?bw(r,l,l.promotion):r.set({fen:f})):(Rr("castle"),r.set({fen:f}))}ps(t,r,l),r.playPremove()}function da(t,r){return t.from===r.from&&t.to===r.to&&(t.promotion?.toLowerCase()??null)===(r.promotion??null)}function kw(t,r){const n=on(t.pgnPath);if(t.pgnPath.length===0){for(const l of t.rootMoves??[])if(da(l,r))return l.pgnPath}const a=t.getMoveByPath(n);if(!a)return null;if(da(a,r))return n;if(a.variations?.length){for(const l of a.variations)if(da(l[0],r))return l[0].pgnPath}return null}function oo(t,r,n,a,l){let f;f=l?{from:r,to:n,promotion:l}:{from:r,to:n};const u=__(a??f,t.fen);if(!u){t.pgnPath=[...t.pgnPath];return}const d=kw(t,u);d?(t.pgnPath=d,t.boardMode==="Puzzle"&&(Ot.extend(ae.increment,t.aiDelayTime),lo(t,t.aiDelayTime||300))):t.boardMode==="Viewer"?t.addMove(u):(ps(t,t.cg),$w(t,u))}function lo(t,r){setTimeout(()=>{t.errorCount=0;const n=on(t.pgnPath),a=t.getMoveByPath(n);if(a&&a.turn===t.opponentColor[0]){const l=[n];ae.acceptVariations&&a.variations&&a.variations.forEach(u=>{l.push(u[0].pgnPath)});const f=Math.floor(Math.random()*l.length);t.pgnPath=l[f]}},r)}function yw(t,r){setTimeout(()=>{t.cg.set({viewOnly:!1}),Ot.resume();const n=on(t.pgnPath);t.pgnPath=n,lo(t,r)},r)}function $w(t,r){t.errorCount++,t.cg.move(r.from,r.to),t.cg.set({fen:r.before}),Rr("error"),setTimeout(()=>{},t.aiDelayTime),t.errorCount>ae.handicap&&!ae.handicapAdvance&&(t.cg.set({viewOnly:!0}),Ot.pause(),yw(t,t.aiDelayTime))}let Qe;function Cw(t){const r=t;if(Qe.selectedPiece&&r&&Ju({from:Qe.selectedPiece,to:r},Qe.fen)){Qe.cg.set({animation:{enabled:!1}}),Qe.cg.set({fen:Qe.fen}),Qe.cg.set({animation:{enabled:!0}});return}let n=null;const a=Qe.newChess(Qe.fen);let l;for(const f of $_)if(l=Qe.systemShapes.find(u=>u.dest===r&&u.brush===f),l)break;if(l&&Qe.boardMode==="Viewer")l.san&&(n=a.move(l.san));else{const u=a.moves({verbose:!0}).filter(d=>d.to===t);u.length===1&&(n=u[0])}n&&oo(Qe,n.from,n.to,n.san)}function Mw(t,r){const n=t,a=r;if(w_(n,a,Qe.fen)){Qe.cg.move(n,a),Qe.setPendingPromotion(n,a);return}oo(Qe,n,a)}const Ew={stockfish:{key:"stockfish",color:"black",opacity:.4,lineWidth:4},stockfishAlt:{key:"stockfishAlt",color:"black",opacity:.3,lineWidth:4},mainLine:{key:"mainLine",color:"#66AA66",opacity:1,lineWidth:8},altLine:{key:"altLine",color:"#66AAAA",opacity:1,lineWidth:8},goodLine:{key:"goodLine",color:"var(--status-perfect)",opacity:1,lineWidth:8},blunderLine:{key:"blunderLine",color:"var(--status-error)",opacity:1,lineWidth:7},nagOnly:{key:"nagOnly",color:"transparent",opacity:1,lineWidth:7},green:{key:"green",color:"green",opacity:1,lineWidth:7},red:{key:"red",color:"red",opacity:1,lineWidth:7},blue:{key:"blue",color:"blue",opacity:1,lineWidth:7},yellow:{key:"yellow",color:"yellow",opacity:1,lineWidth:7}},Tw={premovable:{enabled:!0},highlight:{check:!0,currentMove:!0},animation:{duration:ae.animationTime},drawable:{enabled:!0,brushes:Ew},events:{select:Cw},movable:{free:!1,showDests:ae.showDests,events:{after:Mw}}};function Sw(t,r){Qe=r;const n={...Tw,fen:Qe.startFen,orientation:Qe.orientation};return c_(t,n)}function vc(t){return Object.prototype.toString.call(t)==="[object Date]"}function Pa(t,r,n,a){if(typeof n=="number"||vc(n)){const l=a-n,f=(n-r)/(t.dt||1/60),u=t.opts.stiffness*l,d=t.opts.damping*f,g=(u-d)*t.inv_mass,v=(f+g)*t.dt;return Math.abs(v)<t.opts.precision&&Math.abs(l)<t.opts.precision?a:(t.settled=!1,vc(n)?new Date(n.getTime()+v):n+v)}else{if(Array.isArray(n))return n.map((l,f)=>Pa(t,r[f],n[f],a[f]));if(typeof n=="object"){const l={};for(const f in n)l[f]=Pa(t,r[f],n[f],a[f]);return l}else throw new Error(`Cannot spring ${typeof n} values`)}}function Pw(t,r={}){const n=o2(t),{stiffness:a=.15,damping:l=.8,precision:f=.01}=r;let u,d,g,v=t,m=t,_=1,b=0,$=!1;function E(z,N={}){m=z;const D=g={};return t==null||N.hard||T.stiffness>=1&&T.damping>=1?($=!0,u=jt.now(),v=z,n.set(t=m),Promise.resolve()):(N.soft&&(b=1/((N.soft===!0?.5:+N.soft)*60),_=0),d||(u=jt.now(),$=!1,d=a2(F=>{if($)return $=!1,d=null,!1;_=Math.min(_+b,1);const W=Math.min(F-u,1e3/30),O={inv_mass:_,opts:T,settled:!0,dt:W*60/1e3},p=Pa(O,v,t,m);return u=F,v=t,n.set(t=p),O.settled&&(d=null),!O.settled})),new Promise(F=>{d.promise.then(()=>{D===g&&F()})}))}const T={set:E,update:(z,N)=>E(z(m,t),N),subscribe:n.subscribe,stiffness:a,damping:l,precision:f};return T}var Bw=re('<div id="board"></div>');function xw(t,r){ar(r,!0);const n=()=>f2($,"$dividerSpring",a),[a,l]=c2(),f=pi("GAME_STORE");let u=null,d;Qa(()=>{d&&(Ot.isRunning=!1,Ot.isOutOfTime=!1,f.boardMode==="Viewer"?ae.flipBoard&&f.next():ke.enabled=!1,f.cg=Sw(d,f),d.focus(),f.boardMode==="Puzzle"?(ae.timer&&Ot.start(),ae.flipBoard&&lo(f)):Ot.stop())});const g={incorrect:"var(--status-error)",correct:"var(--status-correct)",perfect:"var(--status-perfect)"},v=ye(()=>({orientation:f.orientation,viewOnly:f.isPuzzleComplete,movable:{showDests:ae.showDests},drawable:{autoShapes:f.systemShapes}})),m=ye(()=>f.boardMode==="Puzzle"&&!f.isPuzzleComplete?f.playerColor:f.puzzleScore?g[f.puzzleScore]:f.playerColor),_=ye(()=>f.orientation==="white"?"black":"white"),b=ye(()=>f.orientation==="white"?"white":"black"),$=Pw(f.boardMode==="Puzzle"?0:50,{stiffness:.1,damping:.5});let E=50;const T=ye(()=>{if(Ot.visible)return Ot.percent;if(!ke.enabled)return null;const R=ke.analysisLines.find(I=>I.id===1);let i=E;return R||(f.isDraw?i=50:f.isCheckmate&&(i=f.turn==="w"?0:100)),E=R?R.winChance:i,w(_)==="white"?E:100-E});$t(()=>{w(T)!==null&&$.set(w(T))}),$t(()=>{f.cg&&f.cg.set(w(v))}),$t(()=>{f.isPuzzleComplete&&(f.cg?.cancelMove(),Ot.stop())}),$t(()=>{f?.cg&&(ww(f,f.cg,u),u=[...f.pgnPath])}),$t(()=>{ke.enabled&&ke.analyze(f.fen)});let z=le(null),N=0;$t(()=>{f.errorCount>N&&D("incorrect"),N=f.errorCount}),$t(()=>{Ot.isOutOfTime&&D("incorrect")}),$t(()=>{f.isPuzzleComplete&&f.puzzleScore&&D(f.puzzleScore)}),$t(()=>{f.boardMode==="Puzzle"&&f.puzzleScore&&sessionStorage.setItem("chess_puzzle_score",f.puzzleScore)});function D(R){H(z,null),requestAnimationFrame(()=>{H(z,R,!0)})}function F(){!f||!f.cg||f.cg.state.selected!=="a0"&&(f.selectedPiece=f.cg.state.selected)}function W(R){R.deltaY<0?f.next():f.prev()}var O=Bw();O.__pointerdown=F;let p;qs(O,R=>d=R,()=>d),Me(()=>{e2(O,`
    --player-color: ${f.playerColor??""};
    --opponent-color: ${f.opponentColor??""};
    --border-color: ${w(m)??""};
    --border-flash-color: ${g[w(z)]??"transparent"??""};

    /* Interative Border Colors (Engine Analysis/Timer) */
    --bar-top-color: ${w(_)??""};
    --bar-bottom-color: ${w(b)??""};
    --divider: ${n()??""}%;

  `),p=Ye(O,1,"svelte-hm9kbz",null,p,{analysisMode:ke.enabled&&w(T)!==null,timerMode:Ot.visible,"border-flash":f.boardMode==="Puzzle"&&w(z),"view-only":f.isPuzzleComplete})}),_a("wheel",O,function(...R){(f.boardMode==="Viewer"?W:null)?.apply(this,R)}),_a("animationend",O,()=>H(z,null)),Y(t,O),or(),l()}On(["pointerdown"]);function Fw(t,r){const n=a=>{t&&!t.contains(a.target)&&!a.defaultPrevented&&r(a)};return document.addEventListener("click",n,!0),{destroy(){document.removeEventListener("click",n,!0)}}}var Dw=re('<li class="separator svelte-gbzvqm"></li>'),Ow=re('<span class="material-symbols-sharp icon svelte-gbzvqm"> </span>'),Uw=re('<li class="control-item svelte-gbzvqm"><div class="control-label svelte-gbzvqm"><!> <span> </span></div> <label class="switch svelte-gbzvqm"><input type="checkbox" class="svelte-gbzvqm"/> <span class="slider round svelte-gbzvqm"></span></label></li>'),Rw=re('<span class="material-symbols-sharp icon svelte-gbzvqm"> </span>'),Nw=re('<li class="control-item svelte-gbzvqm"><div class="control-label svelte-gbzvqm"><!> <span> </span></div> <div class="number-stepper svelte-gbzvqm"><button class="step-btn svelte-gbzvqm">-</button> <span class="step-val svelte-gbzvqm"> </span> <button class="step-btn svelte-gbzvqm">+</button></div></li>'),Iw=re("<button> </button>"),zw=re('<div class="sel-dropdown svelte-gbzvqm"></div>'),Lw=re('<li class="control-item select-container svelte-gbzvqm"><div class="selector-wrapper svelte-gbzvqm"><div class="sel-label svelte-gbzvqm"> </div> <div class="sel-divider svelte-gbzvqm"></div> <div class="sel-value-section svelte-gbzvqm"><button><span class="curr-val"> </span> <span>â¼</span></button> <!></div></div></li>'),Ww=re('<span class="material-symbols-sharp icon svelte-gbzvqm"> </span>'),Kw=re('<span class="material-symbols-sharp chevron svelte-gbzvqm">chevron_right</span>'),jw=re('<div class="submenu svelte-gbzvqm"><!></div>'),Vw=re('<li class="menu-item-wrapper svelte-gbzvqm"><button><!> <span class="label"> </span> <!></button> <!></li>'),Gw=re('<ul class="menu-list svelte-gbzvqm"></ul>'),Qw=re('<span class="material-symbols-sharp trigger-icon svelte-gbzvqm"> </span>'),Yw=re('<span class="trigger-label"> </span>'),Hw=re("<div><!></div>"),Jw=re('<div class="dropdown-container svelte-gbzvqm"><button><!> <!></button> <!></div>');function Zw(t,r){ar(r,!0);const n=(I,K=Fr)=>{var Q=Gw();Bn(Q,21,K,fi,(ie,G,ue)=>{var oe=Gt(),fe=Pe(oe);{var $e=it=>{var Nt=Dw();Y(it,Nt)},He=it=>{var Nt=Gt(),lr=Pe(Nt);{var _r=St=>{var de=Uw();de.__click=T;var Oe=J(de),Fe=J(Oe);{var ht=Ie=>{var Te=Ow(),ge=J(Te);Me(()=>xe(ge,w(G).icon)),Y(Ie,Te)};he(Fe,Ie=>{w(G).icon&&Ie(ht)})}var De=te(Fe,2),Ee=J(De),Je=te(Oe,2),Ke=J(Je);Ke.__change=Ie=>w(G).onToggle?.(Ie.currentTarget.checked),Me(()=>{xe(Ee,w(G).label),n2(Ke,w(G).checked)}),Y(St,de)},Yt=St=>{var de=Gt(),Oe=Pe(de);{var Fe=De=>{var Ee=Nw();Ee.__click=T;var Je=J(Ee),Ke=J(Je);{var Ie=je=>{var st=Rw(),dt=J(st);Me(()=>xe(dt,w(G).icon)),Y(je,st)};he(Ke,je=>{w(G).icon&&je(Ie)})}var Te=te(Ke,2),ge=J(Te),we=te(Je,2),Se=J(we);Se.__click=()=>w(G).onChange?.(Number(w(G).value)-(w(G).step||1));var Ue=te(Se,2),pt=J(Ue),Re=te(Ue,2);Re.__click=()=>w(G).onChange?.(Number(w(G).value)+(w(G).step||1)),Me(()=>{xe(ge,w(G).label),xe(pt,w(G).value)}),Y(De,Ee)},ht=De=>{var Ee=Gt(),Je=Pe(Ee);{var Ke=Te=>{var ge=Lw();ge.__click=T;var we=J(ge),Se=J(we),Ue=J(Se),pt=te(Se,4),Re=J(pt);let je;Re.__click=()=>H(d,w(d)===ue?null:ue,!0);var st=J(Re),dt=J(st),bt=te(st,2);let at;var Be=te(Re,2);{var ze=_t=>{var fr=zw();Bn(fr,21,()=>w(G).options||[],fi,(Ht,Jt)=>{var cr=Iw();let zr;cr.__click=()=>{w(G).onChange?.(w(Jt)),H(d,null)};var hn=J(cr);Me(()=>{zr=Ye(cr,1,"sel-option svelte-gbzvqm",null,zr,{selected:w(Jt)===w(G).value}),xe(hn,w(Jt))}),Y(Ht,cr)}),Y(_t,fr)};he(Be,_t=>{w(d)===ue&&_t(ze)})}Me(()=>{xe(Ue,w(G).label),je=Ye(Re,1,"sel-trigger svelte-gbzvqm",null,je,{isActive:w(d)===ue}),xe(dt,w(G).value),at=Ye(bt,1,"arrow svelte-gbzvqm",null,at,{open:w(d)===ue})}),Y(Te,ge)},Ie=Te=>{var ge=Vw(),we=J(ge);let Se;we.__click=()=>$(w(G));var Ue=J(we);{var pt=Be=>{var ze=Ww(),_t=J(ze);Me(()=>xe(_t,w(G).icon)),Y(Be,ze)};he(Ue,Be=>{w(G).icon&&Be(pt)})}var Re=te(Ue,2),je=J(Re),st=te(Re,2);{var dt=Be=>{var ze=Kw();Y(Be,ze)};he(st,Be=>{w(G).children&&Be(dt)})}var bt=te(we,2);{var at=Be=>{var ze=jw(),_t=J(ze);n(_t,()=>w(G).children),Y(Be,ze)};he(bt,Be=>{w(G).children&&Be(at)})}Me(()=>{Se=Ye(we,1,"menu-item svelte-gbzvqm",null,Se,{danger:w(G).danger,highlight:w(G).highlight}),we.disabled=w(G).disabled,xe(je,w(G).label)}),Y(Te,ge)};he(Je,Te=>{w(G).type==="select"?Te(Ke):Te(Ie,!1)},!0)}Y(De,Ee)};he(Oe,De=>{w(G).type==="number"?De(Fe):De(ht,!1)},!0)}Y(St,de)};he(lr,St=>{w(G).type==="toggle"?St(_r):St(Yt,!1)},!0)}Y(it,Nt)};he(fe,it=>{w(G).type==="separator"?it($e):it(He,!1)})}Y(ie,oe)}),Y(I,Q)};let a=En(r,"label",3,null),l=En(r,"icon",3,null),f=En(r,"position",3,"bottom-left"),u=le(!1),d=le(null),g=le(void 0),v=le(void 0);function m(I){return document.body.appendChild(I),{destroy(){I.parentNode&&I.parentNode.removeChild(I)}}}$t(()=>{if(w(u)&&w(g)&&w(v)){const I=w(g).getBoundingClientRect();let K=I.bottom+5,Q=I.left;f()==="bottom-right"&&(Q=I.right-w(v).offsetWidth),w(v).style.top=`${K}px`,w(v).style.left=`${Q}px`;const ie=w(v).getBoundingClientRect();ie.right>window.innerWidth&&(w(v).style.left=`${window.innerWidth-ie.width-10}px`)}}),$t(()=>{if(w(u)){const I=()=>b();return window.addEventListener("scroll",I,!0),()=>window.removeEventListener("scroll",I,!0)}});function _(){H(u,!w(u)),w(u)||H(d,null)}function b(){H(u,!1),H(d,null)}function $(I){I.disabled||I.children||(I.action&&I.action(),b())}function E(I){w(g)&&w(g).contains(I.target)||b()}function T(I){I.stopPropagation()}var z=Jw(),N=J(z);let D;N.__click=_;var F=J(N);{var W=I=>{var K=Qw(),Q=J(K);Me(()=>xe(Q,l())),Y(I,K)};he(F,I=>{l()&&I(W)})}var O=te(F,2);{var p=I=>{var K=Yw(),Q=J(K);Me(()=>xe(Q,a())),Y(I,K)};he(O,I=>{a()&&I(p)})}qs(N,I=>H(g,I),()=>w(g));var R=te(N,2);{var i=I=>{var K=Hw();let Q;var ie=J(K);n(ie,()=>r.items),Kf(K,G=>m?.(G)),Kf(K,(G,ue)=>Fw?.(G,ue),()=>E),qs(K,G=>H(v,G),()=>w(v)),Me(()=>Q=Ye(K,1,"menu svelte-gbzvqm",null,Q,{"bottom-left":f()==="bottom-left","bottom-right":f()==="bottom-right"})),Y(I,K)};he(R,I=>{w(u)&&I(i)})}Me(()=>{D=Ye(N,1,"trigger svelte-gbzvqm",null,D,{isActive:w(u)}),Jr(N,"aria-expanded",w(u))}),Y(t,z),or()}On(["click","change"]);var Xw=re('<span class="material-symbols-sharp icon-spin md-small svelte-khztgg">sync</span>'),ek=re('<span class="material-symbols-sharp md-small svelte-khztgg">developer_board</span>'),tk=re('<span class="material-symbols-sharp md-small svelte-khztgg">developer_board_off</span>'),rk=re('<!> <button class="navBtn svelte-khztgg" id="resetBoard"><span class="material-symbols-sharp svelte-khztgg">first_page</span></button> <button class="navBtn svelte-khztgg" id="navBackward"><span class="material-symbols-sharp svelte-khztgg">keyboard_arrow_left</span></button> <button class="navBtn svelte-khztgg" id="navForward"><span class="material-symbols-sharp svelte-khztgg">keyboard_arrow_right</span></button> <button class="navBtn svelte-khztgg" title="Copy FEN to clipboard" id="copyFen"><span class="material-symbols-sharp md-small svelte-khztgg">content_copy</span></button> <button><!></button> <button class="navBtn svelte-khztgg"><span>flip</span></button>',1);function nk(t,r){ar(r,!0);const n=pi("GAME_STORE");let a=ye(()=>n.orientation==="black"),l=ye(()=>n.pgnPath.length>0),f=ye(()=>n.hasNext);async function u(){try{await navigator.clipboard.writeText(n.fen),Rr("computer-mouse-click")}catch(i){console.error("Failed to copy FEN:",i),Rr("error")}}function d(i){switch(i.key){case"ArrowLeft":n.prev();break;case"ArrowRight":n.next();break;case"ArrowDown":n.reset();break}}function g(i){ae[i]=!ae[i]}const v=ye(()=>[{label:"Stockfish",icon:"developer_board",children:[{type:"number",label:"Thinking Time (s)",min:1,max:300,value:ae.analysisTime,onChange:i=>ke.setThinkingTime(i)},{type:"number",label:"Multi Pv",min:1,max:5,value:ae.analysisLines,onChange:i=>ke.setMultiPv(i)}]},{label:"Anki Config",icon:"kid_star",children:[{type:"number",label:"Handicap",min:1,max:10,value:ae.handicap,onChange:i=>ae.handicap=i},{type:"separator"},{type:"number",label:"Timer",min:1,max:60,value:ae.timer/1e3,onChange:i=>ae.timer=i*1e3},{type:"number",label:"Increment",min:1,max:60,value:ae.increment/1e3,onChange:i=>ae.increment=i*1e3},{type:"separator"},{type:"toggle",label:"Front Text",checked:ae.frontText,onToggle:()=>g("frontText")},{type:"toggle",label:"flipBoard",checked:ae.flipBoard,onToggle:()=>g("flipBoard")},{type:"toggle",label:"mirror",checked:ae.mirror,onToggle:()=>g("mirror")},{type:"toggle",label:"showDests",checked:ae.showDests,onToggle:()=>g("showDests")},{type:"toggle",label:"muteAudio",checked:ae.muteAudio,onToggle:()=>g("muteAudio")}]},{type:"separator"},{disabled:!ae.saveDue,label:"Save Config",icon:"save",danger:ae.saveDue,action:()=>ae.save()}]);$t(()=>{ae.flipBoard,br(()=>{n.parsePGN()})});var m=rk();_a("keydown",Aa,d);var _=Pe(m);Zw(_,{icon:"settings",get items(){return w(v)}});var b=te(_,2);b.__click=()=>n.reset();var $=te(b,2);$.__click=()=>n.prev();var E=te($,2);E.__click=()=>n.next();var T=te(E,2);T.__click=u;var z=te(T,2);let N;z.__click=()=>ke.toggle(n.fen);var D=J(z);{var F=i=>{var I=Xw();Y(i,I)},W=i=>{var I=Gt(),K=Pe(I);{var Q=G=>{var ue=ek();Y(G,ue)},ie=G=>{var ue=tk();Y(G,ue)};he(K,G=>{ke.enabled?G(Q):G(ie,!1)},!0)}Y(i,I)};he(D,i=>{ke.loading?i(F):i(W,!1)})}var O=te(z,2);O.__click=()=>n.toggleOrientation();var p=J(O);let R;Me(()=>{b.disabled=!w(l),$.disabled=!w(l),E.disabled=!w(f),N=Ye(z,1,"navBtn svelte-khztgg",null,N,{"active-toggle":ke.enabled}),z.disabled=ke.loading,Jr(z,"title",ke.enabled?"Turn Stockfish Off":"Turn Stockfish On"),R=Ye(p,1,"flipBoardIcon material-symbols-sharp md-small svelte-khztgg",null,R,{flipped:w(a)})}),Y(t,m),or()}On(["click"]);const ik=""+new URL("_wQ.svg",import.meta.url).href,sk="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'%20standalone='no'?%3e%3c!--%20Creator:%20CorelDRAW%20--%3e%3csvg%20xmlns:dc='http://purl.org/dc/elements/1.1/'%20xmlns:cc='http://web.resource.org/cc/'%20xmlns:rdf='http://www.w3.org/1999/02/22-rdf-syntax-ns%23'%20xmlns:svg='http://www.w3.org/2000/svg'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20xmlns:sodipodi='http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd'%20xmlns:inkscape='http://www.inkscape.org/namespaces/inkscape'%20xml:space='preserve'%20width='50mm'%20height='50mm'%20shape-rendering='geometricPrecision'%20text-rendering='geometricPrecision'%20image-rendering='optimizeQuality'%20fill-rule='evenodd'%20clip-rule='evenodd'%20viewBox='0%200%2050%2050'%20id='svg2'%20sodipodi:version='0.32'%20inkscape:version='0.45'%20sodipodi:docname='wr.svg'%20sodipodi:docbase='/home/fkling/2/v0.1.2reduced/PieceThemes/Merida'%20inkscape:output_extension='org.inkscape.output.svg.inkscape'%20sodipodi:modified='true'%3e%3cmetadata%20id='metadata13'%3e%3crdf:RDF%3e%3ccc:Work%20rdf:about=''%3e%3cdc:format%3eimage/svg+xml%3c/dc:format%3e%3cdc:type%20rdf:resource='http://purl.org/dc/dcmitype/StillImage'%20/%3e%3c/cc:Work%3e%3c/rdf:RDF%3e%3c/metadata%3e%3cdefs%20id='defs11'%3e%3clinearGradient%20inkscape:collect='always'%20id='linearGradient2165'%3e%3cstop%20style='stop-color:%23ffffff;stop-opacity:1;'%20offset='0'%20id='stop2167'%20/%3e%3cstop%20style='stop-color:%23ffffff;stop-opacity:0;'%20offset='1'%20id='stop2169'%20/%3e%3c/linearGradient%3e%3clinearGradient%20inkscape:collect='always'%20xlink:href='%23linearGradient2165'%20id='linearGradient2171'%20x1='21.375923'%20y1='37.469288'%20x2='77.641281'%20y2='37.469288'%20gradientUnits='userSpaceOnUse'%20/%3e%3c/defs%3e%3csodipodi:namedview%20inkscape:window-height='625'%20inkscape:window-width='944'%20inkscape:pageshadow='2'%20inkscape:pageopacity='0.0'%20guidetolerance='10.0'%20gridtolerance='10.0'%20objecttolerance='10.0'%20borderopacity='1.0'%20bordercolor='%23666666'%20pagecolor='%23ffffff'%20id='base'%20inkscape:zoom='2.2972888'%20inkscape:cx='92.275155'%20inkscape:cy='88.582678'%20inkscape:window-x='271'%20inkscape:window-y='154'%20inkscape:current-layer='svg2'%20showgrid='true'%20/%3e%3cg%20id='Layer_x0020_1'%3e%3cmetadata%20id='CorelCorpID_0Corel-Layer'%20/%3e%3cpolygon%20fill='%231F1A17'%20points='28.4078,9.22%2032.6242,9.22%2032.6242,5.8249%2039.423,5.8249%2039.423,15.1213%2033.9196,19.3631%2033.9196,31.2249%2038.136,35.4413%2038.136,40.5213%2041.9291,40.5213%2041.9291,46.4479%208.0709,46.4479%208.0709,40.5213%2011.864,40.5213%2011.864,35.4413%2016.1058,31.2249%2016.1058,19.3631%2010.6024,15.1213%2010.6024,5.8249%2017.3758,5.8249%2017.3758,9.22%2021.6176,9.22%2021.6176,5.8249%2028.4078,5.8249%20'%20id='polygon6'%20/%3e%3cpath%20fill='white'%20d='M33.073%2017.6782l3.1496%20-2.5569%20-22.4198%200%203.175%202.5569%2016.0952%200zm7.1966%2024.5279l-30.5138%200%200%202.557%2030.5138%200%200%20-2.557zm-3.8438%20-5.0546l-22.8262%200%200%203.3698%2022.8262%200%200%20-3.3698zm-4.2164%20-17.7884l-14.3934%200%200%2011.8618%2014.3934%200%200%20-11.8618zm5.5033%20-5.9267l0%20-5.9267%20-3.3951%200%200%203.3952%20-7.6454%200%200%20-3.3952%20-3.3444%200%200%203.3952%20-7.62%200%200%20-3.3952%20-3.3951%200%200%205.9267%2025.4%200zm-1.9135%2022.0049l-2.5484%20-2.5316%20-16.4508%200%20-2.5992%202.5316%2021.5984%200z'%20id='path8'%20style='fill-opacity:1.0;fill:url(%23linearGradient2171)'%20/%3e%3c/g%3e%3c/svg%3e",ak=""+new URL("_wB.svg",import.meta.url).href,ok=""+new URL("_wN.svg",import.meta.url).href,lk=""+new URL("_bQ.svg",import.meta.url).href,fk="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'%20standalone='no'?%3e%3c!--%20Creator:%20CorelDRAW%20--%3e%3csvg%20xmlns:dc='http://purl.org/dc/elements/1.1/'%20xmlns:cc='http://web.resource.org/cc/'%20xmlns:rdf='http://www.w3.org/1999/02/22-rdf-syntax-ns%23'%20xmlns:svg='http://www.w3.org/2000/svg'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20xmlns:sodipodi='http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd'%20xmlns:inkscape='http://www.inkscape.org/namespaces/inkscape'%20xml:space='preserve'%20width='50mm'%20height='50mm'%20shape-rendering='geometricPrecision'%20text-rendering='geometricPrecision'%20image-rendering='optimizeQuality'%20fill-rule='evenodd'%20clip-rule='evenodd'%20viewBox='0%200%2050%2050'%20id='svg2'%20sodipodi:version='0.32'%20inkscape:version='0.45'%20sodipodi:docname='br.svg'%20sodipodi:docbase='/home/fkling/2/v0.1.2reduced/PieceThemes/Merida'%20inkscape:output_extension='org.inkscape.output.svg.inkscape'%20sodipodi:modified='true'%3e%3cmetadata%20id='metadata13'%3e%3crdf:RDF%3e%3ccc:Work%20rdf:about=''%3e%3cdc:format%3eimage/svg+xml%3c/dc:format%3e%3cdc:type%20rdf:resource='http://purl.org/dc/dcmitype/StillImage'%20/%3e%3c/cc:Work%3e%3c/rdf:RDF%3e%3c/metadata%3e%3cdefs%20id='defs11'%3e%3clinearGradient%20inkscape:collect='always'%20id='linearGradient2165'%3e%3cstop%20style='stop-color:%23ffffff;stop-opacity:1;'%20offset='0'%20id='stop2167'%20/%3e%3cstop%20style='stop-color:%23ffffff;stop-opacity:0;'%20offset='1'%20id='stop2169'%20/%3e%3c/linearGradient%3e%3clinearGradient%20inkscape:collect='always'%20xlink:href='%23linearGradient2165'%20id='linearGradient2171'%20x1='21.191647'%20y1='37.551861'%20x2='77.736443'%20y2='37.429012'%20gradientUnits='userSpaceOnUse'%20/%3e%3c/defs%3e%3csodipodi:namedview%20inkscape:window-height='625'%20inkscape:window-width='944'%20inkscape:pageshadow='2'%20inkscape:pageopacity='0.0'%20guidetolerance='10.0'%20gridtolerance='10.0'%20objecttolerance='10.0'%20borderopacity='1.0'%20bordercolor='%23666666'%20pagecolor='%23ffffff'%20id='base'%20inkscape:zoom='2.2972888'%20inkscape:cx='107.38781'%20inkscape:cy='88.58268'%20inkscape:window-x='213'%20inkscape:window-y='134'%20inkscape:current-layer='svg2'%20showgrid='true'%20/%3e%3cg%20id='Layer_x0020_1'%3e%3cmetadata%20id='CorelCorpID_0Corel-Layer'%20/%3e%3cpolygon%20fill='%231F1A17'%20points='28.4078,9.22%2032.6242,9.22%2032.6242,5.8249%2039.423,5.8249%2039.423,15.1213%2033.9196,19.3631%2033.9196,31.2249%2038.136,35.4413%2038.136,40.5213%2041.9291,40.5213%2041.9291,46.4479%208.0709,46.4479%208.0709,40.5213%2011.864,40.5213%2011.864,35.4413%2016.1058,31.2249%2016.1058,19.3631%2010.6024,15.1213%2010.6024,5.8249%2017.3758,5.8249%2017.3758,9.22%2021.6176,9.22%2021.6176,5.8249%2028.4078,5.8249%20'%20id='polygon6'%20/%3e%3cpath%20fill='white'%20d='M25.0127%2035.0433l-10.2701%200%20-1.143%201.0668%200%201.4394%2022.8262%200%200%20-1.4394%20-1.143%20-1.0668%20-10.2701%200zm-11.4131%205.08l0%202.5316%2022.8262%200%200%20-2.5316%20-22.8262%200zm11.4131%20-27.0848l-12.7%200%200%201.143%201.8119%201.3631%2021.8016%200%201.7611%20-1.3631%200%20-1.143%20-12.6746%200zm0%204.191l-8.6783%200%201.4816%201.1684%200%201.4139%2014.3934%200%200%20-1.4139%201.4816%20-1.1684%20-8.6783%200zm0%2013.5466l-7.1967%200%200%201.143%20-1.4816%201.4394%2017.3566%200%20-1.4816%20-1.4394%200%20-1.143%20-7.1967%200z'%20id='path8'%20style='fill-opacity:1.0;fill:url(%23linearGradient2171)'%20/%3e%3c/g%3e%3c/svg%3e",ck=""+new URL("_bB.svg",import.meta.url).href,uk=""+new URL("_bN.svg",import.meta.url).href;var hk=re('<div id="promoteButtonsContainer" class="svelte-1uxxdc2"><button class="promoteBtn svelte-1uxxdc2"><img class="promotePiece svelte-1uxxdc2" alt="Promote to Queen"/></button> <button class="promoteBtn svelte-1uxxdc2"><img class="promotePiece svelte-1uxxdc2" alt="Promote to Bishop"/></button> <button class="promoteBtn svelte-1uxxdc2"><img class="promotePiece svelte-1uxxdc2" alt="Promote to Knight"/></button> <button class="promoteBtn svelte-1uxxdc2"><img class="promotePiece svelte-1uxxdc2" alt="Promote to Rook"/></button></div> <div id="overlay" class="svelte-1uxxdc2"></div>',1);function pk(t,r){ar(r,!0);const n=pi("GAME_STORE");let a=ye(()=>n.turn[0]),l=ye(()=>({q:w(a)==="w"?ik:lk,b:w(a)==="w"?ak:ck,n:w(a)==="w"?ok:uk,r:w(a)==="w"?sk:fk}));function f(v){if(!n.pendingPromotion)return;const{from:m,to:_}=n.pendingPromotion;oo(n,m,_,void 0,v),n.pendingPromotion=null}var u=Gt(),d=Pe(u);{var g=v=>{var m=hk(),_=Pe(m),b=J(_);b.__click=()=>f("q");var $=J(b),E=te(b,2);E.__click=()=>f("b");var T=J(E),z=te(E,2);z.__click=()=>f("n");var N=J(z),D=te(z,2);D.__click=()=>f("r");var F=J(D);Me(()=>{Jr($,"src",w(l).q),Jr(T,"src",w(l).b),Jr(N,"src",w(l).n),Jr(F,"src",w(l).r)}),Y(v,m)};he(d,v=>{n.pendingPromotion&&v(g)})}Y(t,u),or()}On(["click"]);const wn=t=>{var r=dk();Y(t,r)},kn=(t,r=Fr)=>{var n=vk(),a=J(n);Me(()=>xe(a,`${r().moveNumber??""}${r().turn==="b"?"...":"."}`)),Y(t,n)};var dk=re('<span class="nullMove svelte-1ke1j8b">|...|</span>'),vk=re('<span class="move-number svelte-1ke1j8b"> </span>'),gk=re('<span class="comment svelte-1ke1j8b"> </span>'),qk=re('<span class="altLineBracket">(</span>'),Ak=re("<!> <!>",1),mk=re('<span class="nagTooltip svelte-1ke1j8b"> </span>'),bk=re("<!> <!>",1),_k=re("<!> <span> </span> <!>",1),wk=re("<div><!></div>"),kk=re('<span class="sub-var-spacing"></span>'),yk=re("<!> <!>",1),$k=re("<div><!></div>"),Ck=re("<!> <!>",1),Mk=re("<!> <!>",1),Ek=re("<!> <!> <!>",1),Tk=re('<!> <!>   <span role="button" tabindex="0"><!> </span> <!> <!> <!>',1),Sk=re('<span class="altLineBracket">)</span>'),Pk=re("<!> <!> <!> <!>",1);function Ba(t,r){ar(r,!0);const n=pi("GAME_STORE");let a=En(r,"gameComment",19,()=>n.rootGame?.gameComment),l=En(r,"isVariation",3,!1),f=En(r,"withBrackets",3,!1),u=ye(()=>r.moves??n.rootMoves);const d=ye(()=>n.currentPathKey);function g(D){n.pgnPath=D}function v(D,F){(D.key==="Enter"||D.key===" ")&&(D.preventDefault(),g(F))}var m=Pk(),_=Pe(m);{var b=D=>{var F=gk(),W=J(F);Me(()=>xe(W,a())),Y(D,F)};he(_,D=>{a()&&D(b)})}var $=te(_,2);{var E=D=>{var F=qk();Y(D,F)};he($,D=>{f()&&D(E)})}var T=te($,2);Bn(T,19,()=>w(u),D=>D.pgnPath.join(","),(D,F,W)=>{const O=ye(()=>w(F).pgnPath.join(",")),p=ye(()=>w(F).nag?.find(Hu)),R=ye(()=>w(p)?hi[w(p)]?.[1]??"":""),i=ye(()=>w(p)?hi[w(p)]?.[0]??"":"");var I=Tk(),K=Pe(I);{var Q=de=>{var Oe=Gt(),Fe=Pe(Oe);{var ht=Ee=>{kn(Ee,()=>w(F))},De=Ee=>{var Je=Ak(),Ke=Pe(Je);kn(Ke,()=>w(F));var Ie=te(Ke,2);wn(Ie),Y(Ee,Je)};he(Fe,Ee=>{l()?Ee(ht):Ee(De,!1)})}Y(de,Oe)};he(K,de=>{w(W)===0&&w(F).turn==="b"&&de(Q)})}var ie=te(K,2);{var G=de=>{kn(de,()=>w(F))};he(ie,de=>{w(F).turn==="w"&&de(G)})}var ue=te(ie,2);let oe;ue.__click=()=>g(w(F).pgnPath),ue.__keydown=de=>v(de,w(F).pgnPath);var fe=J(ue);{var $e=de=>{var Oe=mk(),Fe=J(Oe);Me(()=>xe(Fe,w(i))),Y(de,Oe)};he(fe,de=>{w(i)&&de($e)})}var He=te(fe),it=te(ue,2);{var Nt=de=>{var Oe=_k(),Fe=Pe(Oe);{var ht=Te=>{wn(Te)};he(Fe,Te=>{w(F).turn==="w"&&!l()&&Te(ht)})}var De=te(Fe,2);let Ee;var Je=J(De),Ke=te(De,2);{var Ie=Te=>{var ge=bk(),we=Pe(ge);kn(we,()=>w(F));var Se=te(we,2);wn(Se),Y(Te,ge)};he(Ke,Te=>{w(F).turn==="w"&&w(W)<w(u).length-1&&!l()&&!w(F).variations?.length&&Te(Ie)})}Me(()=>{Ee=Ye(De,1,"comment svelte-1ke1j8b",null,Ee,{"has-variation":w(F).variations?.length>0,lastContainer:w(W)===w(u).length-1}),xe(Je,w(F).commentAfter)}),Y(de,Oe)};he(it,de=>{w(F).commentAfter&&de(Nt)})}var lr=te(it,2);{var _r=de=>{var Oe=Ek();const Fe=ge=>{var we=Gt(),Se=Pe(we);Bn(Se,17,()=>w(F).variations,fi,(Ue,pt,Re)=>{var je=Gt(),st=Pe(je);{var dt=at=>{var Be=wk();Ye(Be,1,`variation-row ${Re>0?"separator":""}`,"svelte-1ke1j8b");var ze=J(Be);Ba(ze,{get moves(){return w(pt)},isVariation:!0,withBrackets:!1}),Y(at,Be)},bt=at=>{var Be=yk(),ze=Pe(Be);Ba(ze,{get moves(){return w(pt)},isVariation:!0,withBrackets:!0});var _t=te(ze,2);{var fr=Ht=>{var Jt=kk();Y(Ht,Jt)};he(_t,Ht=>{Re<w(F).variations.length-1&&Ht(fr)})}Y(at,Be)};he(st,at=>{l()?at(bt,!1):at(dt)})}Y(Ue,je)}),Y(ge,we)};var ht=Pe(Oe);{var De=ge=>{wn(ge)};he(ht,ge=>{w(F).turn==="w"&&!w(F).commentAfter&&!l()&&ge(De)})}var Ee=te(ht,2);{var Je=ge=>{var we=$k();let Se;var Ue=J(we);Fe(Ue),Me(()=>Se=Ye(we,1,"altLine top-level-container svelte-1ke1j8b",null,Se,{lastContainer:w(W)===w(u).length-1})),Y(ge,we)},Ke=ge=>{var we=Ck(),Se=Pe(we);Fe(Se);var Ue=te(Se,2);{var pt=Re=>{var je=Gt(),st=Pe(je);{var dt=bt=>{kn(bt,()=>w(F))};he(st,bt=>{w(F).turn==="w"&&bt(dt)})}Y(Re,je)};he(Ue,Re=>{w(W)<w(u).length-1&&Re(pt)})}Y(ge,we)};he(Ee,ge=>{l()?ge(Ke,!1):ge(Je)})}var Ie=te(Ee,2);{var Te=ge=>{var we=Mk(),Se=Pe(we);kn(Se,()=>w(F));var Ue=te(Se,2);wn(Ue),Y(ge,we)};he(Ie,ge=>{w(F).turn==="w"&&w(W)<w(u).length-1&&!l()&&ge(Te)})}Y(de,Oe)};he(lr,de=>{w(F).variations&&w(F).variations.length>0&&de(_r)})}var Yt=te(lr,2);{var St=de=>{wn(de)};he(Yt,de=>{w(W)===w(u).length-1&&w(F).turn==="w"&&!l()&&!w(F).commentAfter&&(!w(F).variations||w(F).variations.length===0)&&de(St)})}Me(()=>{oe=Ye(ue,1,"move svelte-1ke1j8b",null,oe,{current:w(O)===w(d)}),Jr(ue,"data-path-key",w(O)),xe(He,` ${w(F).notation.notation??""}
    ${w(R)??""}`)}),Y(D,I)});var z=te(T,2);{var N=D=>{var F=Sk();Y(D,F)};he(z,D=>{f()&&D(N)})}Y(t,m),or()}On(["click","keydown"]);function Bk(t,r){ar(r,!0);const n=new Aw(r.pgn,r.boardMode);gm("GAME_STORE",n);var a=Gt(),l=Pe(a);Jm(l,()=>r.children),Y(t,a),or()}var xk=re('<span class="material-symbols-sharp value-icon svelte-xzqds7"> </span>'),Fk=re('<button type="button"> </button>'),Dk=re('<div class="dropdown-list svelte-xzqds7"></div>'),Ok=re('<div class="control-wrapper svelte-xzqds7"><div class="label-section svelte-xzqds7"> </div> <div class="divider svelte-xzqds7"></div> <div class="value-section svelte-xzqds7"><button type="button"><span class="current-value"> </span> <!> <span>â¼</span></button> <!></div></div>');function gc(t,r){ar(r,!0);let n=le(!1),a;function l(){H(n,!w(n))}function f(O){r.onChange(O),H(n,!1)}function u(O){a&&!a.contains(O.target)&&H(n,!1)}Qa(()=>document.addEventListener("click",u)),h2(()=>document.removeEventListener("click",u));var d=Ok(),g=J(d),v=J(g),m=te(g,4),_=J(m);let b;_.__click=l;var $=J(_),E=J($),T=te($,2);{var z=O=>{var p=xk(),R=J(p);Me(()=>xe(R,r.materialSymbol)),Y(O,p)};he(T,O=>{r.materialSymbol&&O(z)})}var N=te(T,2);let D;var F=te(_,2);{var W=O=>{var p=Dk();Bn(p,21,()=>r.options,fi,(R,i)=>{var I=Fk();let K;I.__click=()=>f(w(i));var Q=J(I);Me(()=>{K=Ye(I,1,"option-item svelte-xzqds7",null,K,{selected:w(i)===r.value}),xe(Q,w(i))}),Y(R,I)}),Y(O,p)};he(F,O=>{w(n)&&O(W)})}qs(m,O=>a=O,()=>a),Me(()=>{xe(v,r.label),b=Ye(_,1,"trigger-btn svelte-xzqds7",null,b,{isActive:w(n)}),xe(E,r.value),D=Ye(N,1,"arrow svelte-xzqds7",null,D,{open:w(n)})}),Y(t,d),or()}On(["click"]);var Uk=re("<span>Starting...</span>"),Rk=re('<div> </div> <div class="moves svelte-a0cafg"> </div>',1),Nk=re('<div></div> <div class="moves svelte-a0cafg"> </div>',1),Ik=re("<div><!></div>"),zk=re('<div class="lines"></div>'),Lk=re('<div class="engine-container svelte-a0cafg"><div class="controls svelte-a0cafg"><!> <!></div> <!> <!></div>');function Wk(t,r){ar(r,!0);const n=pi("GAME_STORE"),a=ye(()=>n.isCheckmate?n.turn==="b"?"White Checkmates...":"Black Checkmates...":n.isDraw?"Draw...":"Thinking..."),l=ye(()=>ke.analysisLines[0]?.winChance>50||n.isCheckmate&&n.turn==="b");function f(E){if(E.isMate)return`M${Math.abs(E.scoreNormalized)}`;const T=E.scoreNormalized/100;return T>0?`+${T.toFixed(2)}`:`${T.toFixed(2)}`}var u=Lk(),d=J(u),g=J(d);gc(g,{label:"Lines:",get value(){return ke.multipv},get options(){return ke.multipvOptions},materialSymbol:"arrow_split",onChange:E=>ke.setMultiPv(E)});var v=te(g,2);gc(v,{label:"Thinking Time (s):",get value(){return ke.analysisThinkingTime},get options(){return ke.thinkingTimeOptions},materialSymbol:"search_gear",onChange:E=>ke.setThinkingTime(E)});var m=te(d,2);{var _=E=>{var T=Uk();Y(E,T)};he(m,E=>{ke.loading&&E(_)})}var b=te(m,2);{var $=E=>{var T=zk();Bn(T,21,()=>Array(ke.multipv),fi,(z,N,D)=>{const F=ye(()=>ke.analysisLines[D]);var W=Ik();let O;var p=J(W);{var R=I=>{var K=Rk(),Q=Pe(K);let ie;var G=J(Q),ue=te(Q,2),oe=J(ue);Me(fe=>{ie=Ye(Q,1,"eval svelte-a0cafg",null,ie,{"white-adv":w(l)}),xe(G,fe),xe(oe,w(F).pvSan)},[()=>f(w(F))]),Y(I,K)},i=I=>{var K=Nk(),Q=Pe(K);let ie;Q.textContent=`${D+1}.`;var G=te(Q,2),ue=J(G);Me(()=>{ie=Ye(Q,1,"eval svelte-a0cafg",null,ie,{"white-adv":w(l)}),xe(ue,ke.analysisLines.length===0?w(a):"...")}),Y(I,K)};he(p,I=>{w(F)?I(R):I(i,!1)})}Me(()=>O=Ye(W,1,"line svelte-a0cafg",null,O,{"dummy-line":!w(F)})),Y(z,W)}),Y(E,T)};he(b,E=>{(ke.analysisLines.length>0||ke.enabled)&&E($)})}Y(t,u),or()}var Kk=re('<div id="userTextContainer" class="svelte-1n46o8q"><div id="textField" class="svelte-1n46o8q"><!></div></div>'),jk=re('<div id="buttons-container" class="svelte-1n46o8q"><!></div> <!> <div id="pgnViewer" class="svelte-1n46o8q"><!></div>',1),Vk=re('<div id="commentBox" class="svelte-1n46o8q"><!> <!></div>'),Gk=re('<div id="container" class="svelte-1n46o8q"><!> <div id="board-container" class="svelte-1n46o8q"><!></div></div> <!>',1);function Qk(t,r){ar(r,!0),Bk(t,{get pgn(){return r.pgn},get boardMode(){return r.boardMode},children:(n,a)=>{var l=Gk(),f=Pe(l),u=J(f);{var d=_=>{var b=Vk(),$=J(b);{var E=N=>{var D=Kk(),F=J(D),W=J(F);Hm(W,()=>r.userText),Y(N,D)};he($,N=>{r.userText&&N(E)})}var T=te($,2);{var z=N=>{var D=jk(),F=Pe(D),W=J(F);nk(W,{});var O=te(F,2);{var p=I=>{Wk(I,{})};he(O,I=>{ke.enabled&&I(p)})}var R=te(O,2),i=J(R);Ba(i,{}),Y(N,D)};he(T,N=>{r.boardMode==="Viewer"&&N(z)})}Y(_,b)};he(u,_=>{(r.boardMode==="Viewer"||ae.frontText&&r.userText)&&_(d)})}var g=te(u,2),v=J(g);Gm(v,()=>ae.boardKey,_=>{xw(_,{})});var m=te(f,2);pk(m,{}),Y(n,l)},$$slots:{default:!0}}),or()}let cs=null;const th=()=>{const t=document.getElementById("anki-chess-root")??document.getElementById("chessRs-root");if(t&&(t.innerHTML=""),!t)return;const r=document.getElementById("anki-textField"),n=document.getElementById("anki-pgn"),a=n?n.textContent?.trim():`[Event "?"]
[Site "?"]
[Date "2023.02.13"]
[Round "?"]
[White "White"]
[Black "Black"]
[Result "*"]
[FEN "8/p6p/6k1/1pp2r2/7R/KP4P1/P7/8 w - - 2 31"]
[SetUp "1"]

31. Re4! (31. Rf4?) a5? {EV: 76.0%} 32. Re8 {EV: 27.6%} Rf2 {EV: 73.7%} (32... Rg5? {EV:
71.5%}) *`,l=r?.innerHTML??null,f=t.getAttribute("data-boardMode")||"Viewer";cs&&(Vm(cs),cs=null),cs=Km(Qk,{target:t,props:{pgn:a,boardMode:f,userText:l}})};window.mountChess=th;document.getElementById("chessRs-root")&&th();
